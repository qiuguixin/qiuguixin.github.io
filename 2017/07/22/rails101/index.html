<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans,en,default">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="rails," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.0" />






<meta name="description" content="1-1 前言目标这一份是写给 Rails 新手的中级训练教材。接下来会以一个“讨论版”为主题，实际让同学了解如何“从零打造”手写出一个网站。
这个讨论版会有：

使用者注册以及登录功能
开新讨论区、留言功能
加入讨论区、退出讨论区功能
权限管理功能
热门文章排序功能
了解什么是 RESTful

当你把这次应用程序实作完成，并上线后，你会学会：

怎么把需求变成会动的 Rails 应用程序
如何在">
<meta property="og:type" content="article">
<meta property="og:title" content="rails 简单论坛实战">
<meta property="og:url" content="http://yoursite.com/2017/07/22/rails101/index.html">
<meta property="og:site_name" content="总有一天，你会来看我">
<meta property="og:description" content="1-1 前言目标这一份是写给 Rails 新手的中级训练教材。接下来会以一个“讨论版”为主题，实际让同学了解如何“从零打造”手写出一个网站。
这个讨论版会有：

使用者注册以及登录功能
开新讨论区、留言功能
加入讨论区、退出讨论区功能
权限管理功能
热门文章排序功能
了解什么是 RESTful

当你把这次应用程序实作完成，并上线后，你会学会：

怎么把需求变成会动的 Rails 应用程序
如何在">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hQ9cSDnBQkOAAExdibcC_hello_world.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/kYNRc151TyCxTdv1FCpS_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8A%E5%8D%882.04.25.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/MLm7sjxnQPOlaWs9Mnn0_Screenshot%20at%20Mar%2027%2021-27-16.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Tkg7OkPvRquIB2q7U3sz_Screenshot%20at%20Mar%2028%2013-03-15.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Tkg7OkPvRquIB2q7U3sz_Screenshot%20at%20Mar%2028%2013-03-15.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/p752z2flSXaLR3dXKDIz_Screenshot%20at%20Mar%2028%2013-05-15.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/ybFBTJplTnywlNphU9rj_Screenshot%20at%20Mar%2028%2013-06-31.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DJUJmGSnemGhaiNcMqaQ_Screenshot%20at%20Mar%2028%2013-16-02.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/RCNqxITRVKQ9WrWTZtQI_Screenshot%20at%20Mar%2028%2013-14-18.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DJUJmGSnemGhaiNcMqaQ_Screenshot%20at%20Mar%2028%2013-16-02.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Kg3gQxBPSCOY9QolKyFJ_Screenshot%20at%20Mar%2028%2013-18-43.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n1TTxgIvSHOzoXbuM71H_Screenshot%20at%20Mar%2028%2013-23-17.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/F0iV0CdWSvGRVylzvlge_Screenshot%20at%20Mar%2028%2013-33-25.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tWiXyZ2S6yHFgMByALfX_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%882.54.46.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n1TTxgIvSHOzoXbuM71H_Screenshot%20at%20Mar%2028%2013-23-17.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n1TTxgIvSHOzoXbuM71H_Screenshot%20at%20Mar%2028%2013-23-17.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/4hQ318D1SoKBC2luPXb0_step4.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/umGsHFTeSLWqaJVlgJOK_Screenshot%20at%20Mar%2028%2013-28-47.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/yOgld2FRHOJGtZRVvxtN_goal.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/UlV7qExeS1KECHNlZGDS_Screenshot%20at%20Mar%2028%2013-31-06.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/F0iV0CdWSvGRVylzvlge_Screenshot%20at%20Mar%2028%2013-33-25.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/7w8JHmfNSCOqi5di4GnN_step4.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/zbLTF2HyQ5mYT1CGayvP_Screenshot%20at%20Mar%2028%2013-35-56.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/e5KmLEDKRpeK7hYd4WzN_Screenshot%20at%20Mar%2028%2013-41-39.png">
<meta property="og:image" content="http://user-image.logdown.io/user/3653/blog/15213/post/393245/lv4Fm5lgSyKFLwhka3uC_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-29%20%E4%B8%8B%E5%8D%882.49.51.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/71uhUpUREqB4dKeRyeEA_Screenshot%20at%20Mar%2028%2013-39-47.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tWiXyZ2S6yHFgMByALfX_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%882.54.46.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xrqeAKZS9GL8cfozVPCJ_Screenshot%20at%20Mar%2028%2013-48-45.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/LXaQUOtkTrqZvyDzwI0w_Screenshot%20at%20Mar%2028%2013-49-45.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/eu3DA4QRSYdIBksgBvXg_Screenshot%20at%20Mar%2028%2013-53-53.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/43jZcWHhQFOUTNmZCPzq_Screenshot%20at%20Feb%2024%2017-11-14.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/72EWSleeQeeblyOUGcie_Screenshot%20at%20Mar%2028%2013-54-25.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/M5UtJtBJR3KmK1LTLoor_Screenshot%20at%20Feb%2024%2017-16-01.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/20hmVo9mTS2UjiRJLLvJ_Screenshot%20at%20Mar%2028%2014-07-38.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/20hmVo9mTS2UjiRJLLvJ_Screenshot%20at%20Mar%2028%2014-07-38.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/qhG8fT0yICTvwdE71igI_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%885.45.42.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/cpAc8EKsTRy54IoQtrEQ_Screenshot%20at%20Mar%2028%2014-11-36.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rGUHz08gQriXQbiPLTE4_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%881.29.48.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WJXUF3ISuyzR26tmyNc9_xDdK3FnmSXyZC9mUxjtL_TPgJPeyuQkyNumT3bJGA_RESTful.jpg">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/BEK2JoGTDyQsBLpVzVuZ_Screenshot%20at%20Mar%2028%2014-22-34.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/G5VGS3Qfa0fCYfoCtdtw_Screenshot%20at%20Mar%2028%2014-23-45.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/OPcBS4K1Sc6ugg74McMT_step1.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Pyn1QXERRDitrIsfO7l2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%886.30.38.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/38OJJxJMSPisjGXEoap3_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%886.30.23.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/33c0ooBvQyyFNkJHQkFQ_Screenshot%20at%20Mar%2028%2014-16-22.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/BEK2JoGTDyQsBLpVzVuZ_Screenshot%20at%20Mar%2028%2014-22-34.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/G5VGS3Qfa0fCYfoCtdtw_Screenshot%20at%20Mar%2028%2014-23-45.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/JomTVi8eTUmTKcAgTQb0_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%886.53.02.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/47PSYmIOSxqqvC1El5iR_Screenshot%20at%20Feb%2024%2017-48-19.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/zCXLBKPCTOWsKmTLBghp_Screenshot%20at%20Mar%2028%2014-36-19.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/zqwtQsxhTZGUiUpIaqAI_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%888.18.22.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/HTjkeLsvQlaSLf2ODLA6_Screenshot%20at%20Mar%2028%2014-37-50.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/LP1ACYrS6CteAF6jUbdC_Screenshot%20at%20Mar%2028%2014-38-26.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/mALyeLKkQVSVYkqVWLXG_Screenshot%20at%20Mar%2028%2014-40-48.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/uheHTau6QMS4ALdpjTEG_current_user_index.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/oU7UA4CJQLmCSOPmXpVP_Screenshot%20at%20Mar%2028%2014-42-54.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/GUSD10DsSIyiJpG2XDq8_Screenshot%20at%20Mar%2028%2014-49-58.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rcnnjHjCSEewcX1gA6xG_Screenshot%20at%20Mar%2028%2015-03-21.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/cbnKVjtaT1Cn9rz3mIQB_show_html_erb.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tDOcEw7QFyG41ktvz05g_posts_resources.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/QxlWwWQmR5yUvfzjxkeq_rake_routes.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/IWovsg8Tz2uFiThPPdPj_show_html_erb_%E2%80%94__Users_xdite_Documents_projects_rails101.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/OvoWNvU3QGCbEUDYlGAy_Screenshot%20at%20Mar%2028%2015-16-13.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/nFgVu94tTjutGJ7oJyTw_Screenshot%20at%20Mar%2028%2015-29-10.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/EK40JBOhR064tFYsu7DS_Screenshot%20at%20Mar%2028%2015-29-33.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/v4lsOfKGQHSEvtI2k5FQ_Screenshot%20at%20Mar%2028%2015-31-43.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/7v1Da1qnQNSVGtfqLfdC_Snip20170328_3.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xobRr8CRtyhziXjiL6ea_Snip20170328_1.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/vfnLMIZHRNOCmePjLYcE_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%881.41.16.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/EUQGOyRtTUqA7Dd2SX4T_Screenshot%20at%20Feb%2020%2016-23-44.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/e8a4IxvSTki9XhQpz7WM_Screenshot%20at%20Mar%2028%2015-52-20.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/qm7JgV4oT8WUvDozSpAx_Screenshot%20at%20Mar%2028%2016-37-16.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WhsIyCkUSuigRDg5nJZw_Screenshot%20at%20Mar%2028%2016-37-37.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hTViiKFRQq2Sv3tOELHu_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-12%20%E4%B8%8B%E5%8D%885.22.33.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DSzAOnmYT86HMFtQov0t_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-12%20%E4%B8%8B%E5%8D%885.55.56.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tJ7ki5CfSFWHxNUxJYWX_show_html_erb_%E2%80%94__Users_xdite_projects_rails101.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/GLfoZDC2Tdqw4VW1lO1u_Screenshot%20at%20Feb%2024%2019-39-26.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DWwg5WhCT9ylag9ZKvaR_Screenshot%20at%20Feb%2024%2019-38-35.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/pIO8ANXRS5i8lSjufnhg_step1.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/JY4GDh1fT2KmOZs7QczT_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-12%20%E4%B8%8B%E5%8D%886.16.38.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/8TThycVyTRuE7r434HgM_step1.png">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/006tNbRwjw1fat1hvbvpxj30i30ekabc.jpg">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/qm7JgV4oT8WUvDozSpAx_Screenshot%20at%20Mar%2028%2016-37-16.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WhsIyCkUSuigRDg5nJZw_Screenshot%20at%20Mar%2028%2016-37-37.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/euudzpTdaCt2yOzapOHA_Screenshot%20at%20Feb%2024%2020-17-13.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/MKi6K2blReyF0gswiy3b_Screenshot%20at%20Feb%2024%2020-17-30.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/yd6feSlRWk2yPR2RshPQ_Screenshot%20at%20Feb%2024%2020-18-02.png">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/006tNbRwjw1faswmyfo4fj30la0h1dih.jpg">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/dXEwIjORuWVaCSgz9l17_Screenshot%20at%20Feb%2024%2019-54-56.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/mrqvDb7Q0yFfhFrDH9w4_Screenshot%20at%20Feb%2024%2019-56-35.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/M9hk6bvQRIaGStPovdQF_Screenshot%20at%20Feb%2024%2020-05-47.png">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/006tNbRwjw1faswnssqxoj30la0h1acq.jpg">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rxzXs4siTBi4JtHEvbJo_Screenshot%20at%20Feb%2024%2020-09-38.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/ZKq40ff6RCKx2ebf1OU8_Screenshot%20at%20Feb%2024%2020-11-49.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/QG1xjgv7STu5bpblRr6G_Screenshot%20at%20Feb%2024%2020-13-11.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/c2KMDQzISdOuusAzzsxn_Screenshot%20at%20Feb%2024%2020-31-33.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/4MgLunCAQcG8CNBgZBNm_Screenshot%20at%20Feb%2024%2020-32-44.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/LBd28oG2Rj28vXrnloW2_Screenshot%20at%20Feb%2024%2020-24-46.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WjNnF1gUR8yUCDip7GJq_Screenshot%20at%20Feb%2024%2020-29-35.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/5VHVflEWRkOkVpwhh3o3_render_group_desc.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hTEvvp9kQUe4UvI3lTBS_Screenshot%20at%20Mar%2006%2016-19-41.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Ak1YaMdzRpWprmHSVgQx_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%884.02.53.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/m3p3y1DpRLiXkmfxjxt1_Screenshot%20at%20Feb%2024%2021-01-32.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xVMH02TsSZGgLI4LhTu2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%884.03.42.png">
<meta property="og:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xnFDsNdjSCWKdxvCqlw2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%884.09.04.png">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/006tNbRwjw1fb5t9ep5udj30dc03ydg7.jpg">
<meta property="og:image" content="http://ww3.sinaimg.cn/large/006tNbRwjw1fb5vm23d6wj30ft03zwex.jpg">
<meta property="og:updated_time" content="2017-07-22T14:38:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="rails 简单论坛实战">
<meta name="twitter:description" content="1-1 前言目标这一份是写给 Rails 新手的中级训练教材。接下来会以一个“讨论版”为主题，实际让同学了解如何“从零打造”手写出一个网站。
这个讨论版会有：

使用者注册以及登录功能
开新讨论区、留言功能
加入讨论区、退出讨论区功能
权限管理功能
热门文章排序功能
了解什么是 RESTful

当你把这次应用程序实作完成，并上线后，你会学会：

怎么把需求变成会动的 Rails 应用程序
如何在">
<meta name="twitter:image" content="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hQ9cSDnBQkOAAExdibcC_hello_world.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/07/22/rails101/"/>





  <title> rails 简单论坛实战 | 总有一天，你会来看我 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">总有一天，你会来看我</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/22/rails101/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="邱桂新">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/16093668?v=3&s=460">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="总有一天，你会来看我">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="总有一天，你会来看我" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                rails 简单论坛实战
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-07-22T22:34:07+08:00">
              2017-07-22
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2017-07-22T22:38:01+08:00">
              2017-07-22
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/rails/" itemprop="url" rel="index">
                    <span itemprop="name">rails</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="1-1-前言"><a href="#1-1-前言" class="headerlink" title="1-1 前言"></a>1-1 前言</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>这一份是写给 Rails 新手的中级训练教材。<br>接下来会以一个“讨论版”为主题，实际让同学了解如何“从零打造”手写出一个网站。</p>
<p>这个讨论版会有：</p>
<ul>
<li>使用者注册以及登录功能</li>
<li>开新讨论区、留言功能</li>
<li>加入讨论区、退出讨论区功能</li>
<li>权限管理功能</li>
<li>热门文章排序功能</li>
<li>了解什么是 RESTful</li>
</ul>
<p>当你把这次应用程序实作完成，并上线后，你会学会：</p>
<ul>
<li>怎么把需求变成会动的 Rails 应用程序</li>
<li>如何在 Rails 套版</li>
<li>如何制作使用者登录功能</li>
<li>重要 Rails 观念以及 API<ul>
<li>CRUD</li>
<li>RESTful</li>
<li>member, collection</li>
<li>helper</li>
<li>partial</li>
<li>scope</li>
</ul>
</li>
<li>找到 Rails 第三方 gem 的技巧</li>
<li>要怎么把你的应用程序放到网络上</li>
</ul>
<p>这几乎是一个 Rails 新手应该学的一切了，有了这些基础技巧之后，你再学更难的技巧，或者是要自己做出复杂的东西，就不会那么容易失败了。</p>
<h3 id="时程"><a href="#时程" class="headerlink" title="时程"></a>时程</h3><ul>
<li>约 30 小时 Rails 开发</li>
<li>建议每天使用 4 小时来完成作业（约需5-7天）</li>
<li>重复练习三遍（相信我，你会越练越快的…）</li>
</ul>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>我们会用这些来做：</p>
<ul>
<li>ruby 2.1.2 、2.2.0 、2.3.1用 RVM 安装（Mac 或 Linux）</li>
<li>rails 5.0.0</li>
<li>bundler</li>
<li>Atom编辑器</li>
</ul>
<p>这些应该都要在第一份教材就装好，确定它们都妥妥的。</p>
<h3 id="如何确认一切没问题？"><a href="#如何确认一切没问题？" class="headerlink" title="如何确认一切没问题？"></a>如何确认一切没问题？</h3><p>运行终端机，输入：</p>
<p><code>irb</code></p>
<p>2.3.1 :001 &gt; <code>1 + 2</code><br>=&gt; 3</p>
<p>2.3.1 :002 &gt; <code>require &quot;active_support&quot;</code><br>=&gt; true</p>
<p>2.3.1 :003 &gt; <code>exit</code></p>
<p>这些都可以成功执行的话，就是没问题了。</p>
<p>提示：在 irb 里运行命令的话，最后记得输入 <code>exit</code> 退出。</p>
<h3 id="效能！效率！"><a href="#效能！效率！" class="headerlink" title="效能！效率！"></a>效能！效率！</h3><p>我非常推荐你这样做：</p>
<ul>
<li>打开终端机并开两个标签页：<ul>
<li>一个放着跑 rails s</li>
<li>一个用来做平常的终端机指令</li>
</ul>
</li>
<li>重新打开你的浏览器（推荐chrome），或是把其他窗口关掉<ul>
<li>打开新的窗口并开两个标签页</li>
<li>一个用来看本教学</li>
<li>一个用来测试你的程序</li>
</ul>
</li>
<li>打开Atom编辑器，然后不要关掉它。我们不会中途离开。</li>
<li>把其他应用程序都隐藏起来，关掉facebook 、微信和其他即时通讯软件、别的干扰物。</li>
<li>把跟你互动的东西最少化，可以减少你分心在这些东西的次数与耗费的时间（比方说在浏览器里打开 50 个分页，这会干扰到你并且浪费你的时间）</li>
</ul>
<h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p>每一课的格式都会长这样：</p>
<ul>
<li>目标</li>
</ul>
<p>叙述我们要做什么。</p>
<ul>
<li>步骤</li>
</ul>
<p>跟着做，但是这时候你还不知道原理。</p>
<ul>
<li>解释</li>
</ul>
<p>关于这些步骤实际上做了什么的细节，详述原因与效果。将一切都连在一起。</p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>如果你刚刚完成第二课的初级练习</p>
<ol>
<li>请在终端机运行 rails server 的窗口（或者标签页）中按 ctrl + c 终止运行，然后按 command + q 退出终端机。</li>
<li>请在 Atom 编辑器的界面按 command + w 关闭所有的标签页，然后点击任务栏左上角 Atom &gt; Quit 退出编辑器。</li>
<li>在开始第二遍，第三遍作业时，同样执行以上两个步骤。</li>
</ol>
<h1 id="2-1-本章目标"><a href="#2-1-本章目标" class="headerlink" title="2-1 本章目标"></a>2-1 本章目标</h1><p>这一章的最终目标，是让各位同学在本章结束后，可以得到一个套好 Bootstrap 样式的空项目。</p>
<p>最后成果会长成这样：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hQ9cSDnBQkOAAExdibcC_hello_world.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hQ9cSDnBQkOAAExdibcC_hello_world.png" alt="img"></a></p>
<h1 id="2-2-建立新项目"><a href="#2-2-建立新项目" class="headerlink" title="2-2 建立新项目"></a>2-2 建立新项目</h1><p><code>rails new rails101</code></p>
<p><code>cd rails101</code></p>
<ul>
<li><code>git init</code></li>
<li><code>git add .</code></li>
<li><code>git commit -m &quot;Initial Commit&quot;</code></li>
</ul>
<h1 id="2-3-帮-Rails-项目穿上衣服“Bootstrap”"><a href="#2-3-帮-Rails-项目穿上衣服“Bootstrap”" class="headerlink" title="2-3 帮 Rails 项目穿上衣服“Bootstrap”"></a>2-3 帮 Rails 项目穿上衣服“Bootstrap”</h1><p>git checkout -b ch01</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem &apos;bootstrap-sass&apos;</div></pre></td></tr></table></figure>
<p>bundle install</p>
<p>mv app/assets/stylesheets/application.css app/assets/stylesheets/application.scss</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">import</span> <span class="string">"bootstrap-sprockets"</span>;</div><div class="line">@<span class="keyword">import</span> <span class="string">"bootstrap"</span>;</div></pre></td></tr></table></figure>
<p><code>git add .</code><br><code>git commit -m &quot;add bootstrap to project&quot;</code></p>
<h1 id="2-4-套用-Bootstrap-的-html-样式-（以下内容无需记忆）"><a href="#2-4-套用-Bootstrap-的-html-样式-（以下内容无需记忆）" class="headerlink" title="2-4 套用 Bootstrap 的 html 样式 （以下内容无需记忆）"></a>2-4 套用 Bootstrap 的 html 样式 （以下内容无需记忆）</h1><h2 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h2><ul>
<li>上一节只是“挂上”Bootstrap 使用的 CSS</li>
<li>这一节则是让全站的 HTML 架构，套用 Bootstrap 的制服</li>
</ul>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-新增-app-views-common-文件夹"><a href="#Step-1-新增-app-views-common-文件夹" class="headerlink" title="Step 1. 新增 app/views/common 文件夹"></a>Step 1. 新增 app/views/common 文件夹</h3><p><code>mkdir app/views/common</code></p>
<h3 id="Step-2-新增-navbar"><a href="#Step-2-新增-navbar" class="headerlink" title="Step 2. 新增 navbar"></a>Step 2. 新增 navbar</h3><p><code>touch app/views/common/_navbar.html.erb</code></p>
<p>填入</p>
<p>app/views/common/_navbar.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;nav class=&quot;navbar navbar-default&quot; role=&quot;navigation&quot;&gt;</div><div class="line">    &lt;div class=&quot;container-fluid&quot;&gt;</div><div class="line">        &lt;div class=&quot;navbar-header&quot;&gt;</div><div class="line">            &lt;a class=&quot;navbar-brand&quot; href=&quot;/&quot;&gt;Rails 101&lt;/a&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line"></div><div class="line">        &lt;div class=&quot;collapse navbar-collapse&quot;&gt;</div><div class="line">            &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;</div><div class="line">                &lt;li&gt;</div><div class="line">                    &lt;%= link_to(&quot;登录&quot;, &apos;#&apos;) %&gt;</div><div class="line">                &lt;/li&gt;</div><div class="line">            &lt;/ul&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">&lt;/nav&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-3-新增-footer"><a href="#Step-3-新增-footer" class="headerlink" title="Step 3. 新增 footer"></a>Step 3. 新增 footer</h3><p><code>touch app/views/common/_footer.html.erb</code></p>
<p>填入</p>
<p>app/views/common/<em>footer.html.erb</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;footer class=&quot;container&quot; style=&quot;margin-top: 100px;&quot;&gt;</div><div class="line">    &lt;p class=&quot;text-center&quot;&gt;Copyright ©2017 Rails101</div><div class="line">        &lt;br&gt;Design by</div><div class="line">        &lt;a href=&quot;http://courses.growthschool.com/courses/rails-101/&quot; target=_new&gt;xdite&lt;/a&gt;</div><div class="line">    &lt;/p&gt;</div><div class="line">&lt;/footer&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-4-修改全域-HTML-样式-application-html-erb"><a href="#Step-4-修改全域-HTML-样式-application-html-erb" class="headerlink" title="Step 4. 修改全域 HTML 样式 application.html.erb"></a>Step 4. 修改全域 HTML 样式 application.html.erb</h3><p>app/views/layouts/application.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line">    &lt;head&gt;</div><div class="line">        &lt;title&gt;Rails101&lt;/title&gt;</div><div class="line">        &lt;%= csrf_meta_tags %&gt;</div><div class="line"></div><div class="line">        &lt;%= stylesheet_link_tag    &apos;application&apos;, media: &apos;all&apos;, &apos;data-turbolinks-track&apos;: &apos;reload&apos; %&gt;</div><div class="line">        &lt;%= javascript_include_tag &apos;application&apos;, &apos;data-turbolinks-track&apos;: &apos;reload&apos; %&gt;</div><div class="line">    &lt;/head&gt;</div><div class="line"></div><div class="line">    &lt;body&gt;</div><div class="line"></div><div class="line">        &lt;div class=&quot;container-fluid&quot;&gt;</div><div class="line">            &lt;%= render &quot;common/navbar&quot; %&gt;</div><div class="line">            &lt;%= yield %&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line"></div><div class="line">        &lt;%= render &quot;common/footer&quot; %&gt;</div><div class="line"></div><div class="line">    &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-5-产生一个新的空-Hello-World-页面-（放在-welcome-index"><a href="#Step-5-产生一个新的空-Hello-World-页面-（放在-welcome-index" class="headerlink" title="Step 5. 产生一个新的空 Hello World 页面 （放在 welcome#index)"></a>Step 5. 产生一个新的空 Hello World 页面 （放在 welcome#index)</h3><ul>
<li>新增一个 welcome controller</li>
</ul>
<p><code>rails g controller welcome</code></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/kYNRc151TyCxTdv1FCpS_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8A%E5%8D%882.04.25.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/kYNRc151TyCxTdv1FCpS_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8A%E5%8D%882.04.25.png" alt="img"></a></p>
<ul>
<li>新增一个空的 HelloWorld 页面</li>
</ul>
<p><code>touch app/views/welcome/index.html.erb</code></p>
<p>填入</p>
<p>app/views/welcome/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt; Hello World! &lt;/h1&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-6-将首页指到-welcome-下的-index-html-erb-页面"><a href="#Step-6-将首页指到-welcome-下的-index-html-erb-页面" class="headerlink" title="Step 6. 将首页指到 welcome 下的 index.html.erb 页面"></a>Step 6. 将首页指到 welcome 下的 index.html.erb 页面</h3><p>修改 config/routes.rb，改成以下内容</p>
<p>config/routes.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Rails.application.routes.draw do</div><div class="line">  root &apos;welcome#index&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="Step-7-git-进度存档"><a href="#Step-7-git-进度存档" class="headerlink" title="Step 7. git 进度存档"></a>Step 7. git 进度存档</h3><p><code>git add .</code><br><code>git commit -m &quot;add bootstrap html&quot;</code></p>
<h3 id="Step-8-运行-Rails-Server"><a href="#Step-8-运行-Rails-Server" class="headerlink" title="Step 8. 运行 Rails Server"></a>Step 8. 运行 Rails Server</h3><p><code>rails s</code></p>
<p>最后完成画面：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/MLm7sjxnQPOlaWs9Mnn0_Screenshot%20at%20Mar%2027%2021-27-16.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/MLm7sjxnQPOlaWs9Mnn0_Screenshot%20at%20Mar%2027%2021-27-16.png" alt="img"></a></p>
<h1 id="2-5-制作漂亮的“提示信息”-（以下内容无需记忆）"><a href="#2-5-制作漂亮的“提示信息”-（以下内容无需记忆）" class="headerlink" title="2-5 制作漂亮的“提示信息” （以下内容无需记忆）"></a>2-5 制作漂亮的“提示信息” （以下内容无需记忆）</h1><h2 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h2><ul>
<li>你应该看过一些网站，有这样的提示信息吧？</li>
<li>这一节的目的在于让你学习到，在 Rails 内如何配合 Bootstrap 内建的特效，建立“提示信息”。</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Tkg7OkPvRquIB2q7U3sz_Screenshot%20at%20Mar%2028%2013-03-15.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Tkg7OkPvRquIB2q7U3sz_Screenshot%20at%20Mar%2028%2013-03-15.png" alt="img"></a></p>
<h2 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-将-Bootstrap-的-js-提示套件-bootstrap-alert-“挂”进项目里面"><a href="#Step-1-将-Bootstrap-的-js-提示套件-bootstrap-alert-“挂”进项目里面" class="headerlink" title="Step 1. 将 Bootstrap 的 js 提示套件 bootstrap/alert “挂”进项目里面"></a>Step 1. 将 Bootstrap 的 js 提示套件 bootstrap/alert “挂”进项目里面</h3><p>在 require_tree 上加入 //= require bootstrap/alert</p>
<p>app/assets/javascripts/application.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">... (一堆注解)</div><div class="line">//= require jquery</div><div class="line">//= require jquery_ujs</div><div class="line">//= require turbolinks</div><div class="line">+//= require bootstrap/alert</div><div class="line">//= require_tree .</div></pre></td></tr></table></figure>
<p><strong>+号在这里是新增一行代码的意思，不用复制贴上这个+号本身，只要粘贴后面的代码就可以了</strong></p>
<h3 id="Step-2-新增-app-views-common-flashes-html-erb"><a href="#Step-2-新增-app-views-common-flashes-html-erb" class="headerlink" title="Step 2. 新增 app/views/common/_flashes.html.erb"></a>Step 2. 新增 app/views/common/_flashes.html.erb</h3><p><code>touch app/views/common/_flashes.html.erb</code></p>
<p>填入</p>
<p>app/views/common/_flashes.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;% if flash.any? %&gt;</div><div class="line">  &lt;% user_facing_flashes.each do |key, value| %&gt;</div><div class="line">    &lt;div class=&quot;alert alert-dismissable alert-&lt;%= flash_class(key) %&gt;&quot;&gt;</div><div class="line">      &lt;button class=&quot;close&quot; data-dismiss=&quot;alert&quot;&gt;×&lt;/button&gt;</div><div class="line">      &lt;%= value %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-3-加入-app-helpers-flashes-helper-rb"><a href="#Step-3-加入-app-helpers-flashes-helper-rb" class="headerlink" title="Step 3. 加入 app/helpers/flashes_helper.rb"></a>Step 3. 加入 app/helpers/flashes_helper.rb</h3><p><code>touch app/helpers/flashes_helper.rb</code></p>
<p>加入以下内容：</p>
<p>app/helpers/flashes_helper.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">module FlashesHelper</div><div class="line">  FLASH_CLASSES = &#123; alert: &quot;danger&quot;, notice: &quot;success&quot;, warning: &quot;warning&quot;&#125;.freeze</div><div class="line"></div><div class="line">  def flash_class(key)</div><div class="line">    FLASH_CLASSES.fetch key.to_sym, key</div><div class="line">  end</div><div class="line"></div><div class="line">  def user_facing_flashes</div><div class="line">    flash.to_hash.slice &quot;alert&quot;, &quot;notice&quot;, &quot;warning&quot; </div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="Step-4-在-application-html-erb-内加入-flash-这个-partial"><a href="#Step-4-在-application-html-erb-内加入-flash-这个-partial" class="headerlink" title="Step 4. 在 application.html.erb 内加入 flash 这个 partial"></a>Step 4. 在 application.html.erb 内加入 flash 这个 partial</h3><p>在 &lt;%= yield %&gt; 前加入 &lt;%= render “common/flashes” %&gt;</p>
<p>app/views/layouts/application.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;%= render &quot;common/flashes&quot; %&gt;</div><div class="line">  &lt;%= yield %&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-5-git-存档"><a href="#Step-5-git-存档" class="headerlink" title="Step 5. git 存档"></a>Step 5. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;add bootstrap flash function&quot;</code></p>
<h3 id="Step-6-测试-flash-helper-的功能"><a href="#Step-6-测试-flash-helper-的功能" class="headerlink" title="Step 6: 测试 flash helper 的功能"></a>Step 6: 测试 flash helper 的功能</h3><p>修改 app/controllers/welcome_controller.rb。加入 flash[:notice] = “早安！你好！”。你应该可以看到系统跳出“绿色”提示窗。</p>
<p>app/controllers/welcome_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class WelcomeController &lt; ApplicationController</div><div class="line">  def index</div><div class="line">    flash[:notice] = &quot;早安！你好！&quot;</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Tkg7OkPvRquIB2q7U3sz_Screenshot%20at%20Mar%2028%2013-03-15.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Tkg7OkPvRquIB2q7U3sz_Screenshot%20at%20Mar%2028%2013-03-15.png" alt="img"></a></p>
<p>修改 app/controllers/welcome_controller.rb。加入 flash[:alert] = “晚安！该睡了！”。你应该可以看到系统跳出“红色”提示窗。</p>
<p>app/controllers/welcome_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class WelcomeController &lt; ApplicationController</div><div class="line">  def index</div><div class="line">    flash[:alert] = &quot;晚安！该睡了！&quot;</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/p752z2flSXaLR3dXKDIz_Screenshot%20at%20Mar%2028%2013-05-15.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/p752z2flSXaLR3dXKDIz_Screenshot%20at%20Mar%2028%2013-05-15.png" alt="img"></a></p>
<p>修改 app/controllers/welcome_controller.rb。加入 flash[:warning] = “这是 warning 信息！”。你应该可以看到系统跳出“黄色”提示窗。</p>
<p>app/controllers/welcome_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class WelcomeController &lt; ApplicationController</div><div class="line">  def index</div><div class="line">   flash[:warning] = &quot;这是 warning 信息！&quot;</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/ybFBTJplTnywlNphU9rj_Screenshot%20at%20Mar%2028%2013-06-31.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/ybFBTJplTnywlNphU9rj_Screenshot%20at%20Mar%2028%2013-06-31.png" alt="img"></a></p>
<h1 id="2-6-参考：git-常用指令教学"><a href="#2-6-参考：git-常用指令教学" class="headerlink" title="2-6 参考：git 常用指令教学"></a>2-6 参考：git 常用指令教学</h1><p>这边是一些常用的 git 指令，常用就会自然记起来，不用硬背，你可以在遇到问题的时候再回来看这篇。</p>
<h3 id="存档："><a href="#存档：" class="headerlink" title="存档："></a>存档：</h3><p>最一开始的时候要先执行存档：<br><code>cd 你的项目文件夹名称</code><br><code>git init</code><br><code>git add .</code><br><code>git commit -m &quot;对于修改部分的简要叙述&quot;</code></p>
<h3 id="新增一个分支："><a href="#新增一个分支：" class="headerlink" title="新增一个分支："></a>新增一个分支：</h3><p><code>git checkout -b 你想取的分支名称</code></p>
<p>这样你的存档会自动被保留在这个分支里。<br>如果不小心做烂了，可以直接切回上一个分支去做。</p>
<h3 id="切换分支："><a href="#切换分支：" class="headerlink" title="切换分支："></a>切换分支：</h3><p><code>git checkout 你想要切换到的分支名称</code><br>举例来说，假设你从01开始做，做到02的时候烂掉了<br>你可以 <code>git checkout 01</code> 回到01再重新开始做</p>
<p>那这个烂掉的02要怎么办呢？虽然你可以产生另一个新的02-1，但还是建议把错误的删除掉，这样才不会做到最后变得乱七八糟的。</p>
<h3 id="删除掉branch的方法："><a href="#删除掉branch的方法：" class="headerlink" title="删除掉branch的方法："></a>删除掉branch的方法：</h3><p>先离开你要删除的分支，接着执行 <code>git branch -D 你要删除的分支名称</code><br>就可以了。</p>
<h1 id="3-1-建立讨论群的架构"><a href="#3-1-建立讨论群的架构" class="headerlink" title="3-1 建立讨论群的架构"></a>3-1 建立讨论群的架构</h1><h2 id="目标-3"><a href="#目标-3" class="headerlink" title="目标"></a>目标</h2><p>在这一章，我们要带大家设计出一个讨论群“列表”。我们会完成以下事项：</p>
<ul>
<li>讨论群要有“标题”与“叙述”</li>
<li>使用者要可以看到“讨论群一览表”</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DJUJmGSnemGhaiNcMqaQ_Screenshot%20at%20Mar%2028%2013-16-02.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DJUJmGSnemGhaiNcMqaQ_Screenshot%20at%20Mar%2028%2013-16-02.png" alt="img"></a></p>
<h2 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-0-git-checkout-b-ch02"><a href="#Step-0-git-checkout-b-ch02" class="headerlink" title="Step 0. git checkout -b ch02"></a>Step 0. git checkout -b ch02</h3><p>因为我们现在要实作第二章的内容，新增一个 branch 把实作内容集中在 ch02 是比较合理的。将来回顾就可以比较清楚 在 ch02我们做了哪一些练习。</p>
<p><code>git checkout -b ch02</code></p>
<h3 id="Step-1-设计-Group-的-model-架构"><a href="#Step-1-设计-Group-的-model-架构" class="headerlink" title="Step 1. 设计 Group 的 model 架构"></a>Step 1. 设计 Group 的 model 架构</h3><p>为了做到在讨论群要有“标题”与“叙述”，我们在这里要建立一个 model <strong>Group</strong>，并建立数据表 group 的两个栏位:</p>
<ul>
<li><strong>title</strong> (string 字串属性)</li>
<li><strong>description</strong> (text 文字属性)</li>
</ul>
<p><code>rails g model group title:string description:text</code></p>
<p>将数据库建立起来，并执行 rake db:migrate</p>
<p><code>rake db:migrate</code></p>
<p>提示：每次产生 migration 之后都要运行 <code>rake db:migrate</code> 。</p>
<h3 id="Step-2-产生-groups-controller"><a href="#Step-2-产生-groups-controller" class="headerlink" title="Step 2. 产生 groups controller"></a>Step 2. 产生 groups controller</h3><ul>
<li>接下来我们要建立一个可以展示“讨论群一览表”的功能</li>
<li>这个地方会是 groups_controller 下的 index action</li>
</ul>
<p><code>rails g controller groups</code></p>
<h3 id="Step-3-建立-index-action-以及-index-的-view"><a href="#Step-3-建立-index-action-以及-index-的-view" class="headerlink" title="Step 3. 建立 index action 以及 index 的 view"></a>Step 3. 建立 index action 以及 index 的 view</h3><p>修改 app/controllers/groups_controller.rb</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line">  def index</div><div class="line">    @groups = Group.all</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p><code>touch app/views/groups/index.html.erb</code></p>
<p>app/views/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line">  &lt;div class=&quot;group&quot;&gt;</div><div class="line">    &lt;%= link_to(&quot;New group&quot;, new_group_path, class: &quot;btn btn-primary pull-right&quot;) %&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;table class=&quot;table table-hover&quot;&gt;</div><div class="line">    &lt;thead&gt;</div><div class="line">      &lt;tr&gt;</div><div class="line">        &lt;td&gt;#&lt;/td&gt;</div><div class="line">        &lt;td&gt;Title&lt;/td&gt;</div><div class="line">        &lt;td&gt;Description&lt;/td&gt;</div><div class="line">      &lt;/tr&gt;</div><div class="line">    &lt;/thead&gt;</div><div class="line">    &lt;tbody&gt;</div><div class="line">      &lt;% @groups.each do |group| %&gt;</div><div class="line">        &lt;tr&gt;</div><div class="line">          &lt;td&gt;#&lt;/td&gt;</div><div class="line">          &lt;td&gt;&lt;%= link_to(group.title, group_path(group)) %&gt;&lt;/td&gt;</div><div class="line">          &lt;td&gt;&lt;%= group.description %&gt;&lt;/td&gt;</div><div class="line">          &lt;td&gt;</div><div class="line">              &lt;%= link_to(&quot;Edit&quot;, edit_group_path(group), class: &quot;btn btn-sm btn-default&quot;)%&gt;</div><div class="line">              &lt;%= link_to(&quot;Delete&quot;, group_path(group),    class: &quot;btn btn-sm btn-default&quot;, </div><div class="line">                          method: :delete, data: &#123; confirm: &quot;Are you sure?&quot; &#125; )%&gt;</div><div class="line">          &lt;/td&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">      &lt;% end %&gt;</div><div class="line">    &lt;/tbody&gt;</div><div class="line">  &lt;/table&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-4-在-routing-上挂上-groups"><a href="#Step-4-在-routing-上挂上-groups" class="headerlink" title="Step 4. 在 routing 上挂上 groups"></a>Step 4. 在 routing 上挂上 groups</h3><p>在 root ‘welcome#index’ 前加上一行 resources :groups</p>
<p>config/routes.rb</p>
<figure class="highlight plain"><figcaption><span>[http://localhost:3000/groups](http://localhost:3000/groups) 可以看到以下成果</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Rails.application.routes.draw do</div><div class="line">   resources :groups</div><div class="line">   root &apos;welcome#index&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/RCNqxITRVKQ9WrWTZtQI_Screenshot%20at%20Mar%2028%2013-14-18.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/RCNqxITRVKQ9WrWTZtQI_Screenshot%20at%20Mar%2028%2013-14-18.png" alt="img"></a></p>
<p>当然现在没有东西，空荡荡的。等一下让我们来加一些数据。</p>
<h3 id="Step-5-添加一些数据。"><a href="#Step-5-添加一些数据。" class="headerlink" title="Step 5. 添加一些数据。"></a>Step 5. 添加一些数据。</h3><p>首先，打开 rails console</p>
<p><code>rails console</code></p>
<p>然后再输入</p>
<p><code>Group.create(title: &quot;Board 1&quot;, description: &quot;Board 1 body&quot;)</code><br><code>Group.create(title: &quot;Board 2&quot;, description: &quot;Board 2 body&quot;)</code></p>
<p>再重新打开 <a href="http://localhost:3000/groups" target="_blank" rel="external">http://localhost:3000/groups</a> 可以看到以下成果</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DJUJmGSnemGhaiNcMqaQ_Screenshot%20at%20Mar%2028%2013-16-02.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DJUJmGSnemGhaiNcMqaQ_Screenshot%20at%20Mar%2028%2013-16-02.png" alt="img"></a></p>
<h3 id="Step-6-git-存档"><a href="#Step-6-git-存档" class="headerlink" title="Step 6. git 存档"></a>Step 6. git 存档</h3><p>输入 <code>exit</code> 命令 退出rails console</p>
<p><code>git add .</code><br><code>git commit -m &quot;create groups index&quot;</code></p>
<h1 id="3-2-将首页换成讨论群一览表"><a href="#3-2-将首页换成讨论群一览表" class="headerlink" title="3-2 将首页换成讨论群一览表"></a>3-2 将首页换成讨论群一览表</h1><h2 id="目标-4"><a href="#目标-4" class="headerlink" title="目标"></a>目标</h2><p>在这一节，我们会完成以下事项：</p>
<ul>
<li>使用者在首页，可以直接看到“讨论群一览表”</li>
</ul>
<h2 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-修改-routing"><a href="#Step-1-修改-routing" class="headerlink" title="Step 1. 修改 routing"></a>Step 1. 修改 routing</h3><p>把 root ‘welcome#index’ 删掉，换成 root ‘groups#index’</p>
<p>（记得 <code>+</code> <code>-</code> 不要打进去，他们各代表“加这一行” / “减这一行”的意思。）</p>
<p>config/routes.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Rails.application.routes.draw do</div><div class="line">  resources :groups</div><div class="line">+  root &apos;groups#index&apos;</div><div class="line">-  root &apos;welcome#index&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>然后你就可以在 <a href="http://localhost:3000/" target="_blank" rel="external">http://localhost:3000/</a> 看到 Group 一览表了</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Kg3gQxBPSCOY9QolKyFJ_Screenshot%20at%20Mar%2028%2013-18-43.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Kg3gQxBPSCOY9QolKyFJ_Screenshot%20at%20Mar%2028%2013-18-43.png" alt="img"></a></p>
<h3 id="Step-2-git-存档"><a href="#Step-2-git-存档" class="headerlink" title="Step 2. git 存档"></a>Step 2. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;replace root with groups#index&quot;</code></p>
<h1 id="4-1-本章目标"><a href="#4-1-本章目标" class="headerlink" title="4-1 本章目标"></a>4-1 本章目标</h1><h2 id="目标-5"><a href="#目标-5" class="headerlink" title="目标"></a>目标</h2><ul>
<li>实作看板的“新增” new / create</li>
<li>实作看板的“编辑” edit / update</li>
<li>实作看板的“删除” destroy</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n1TTxgIvSHOzoXbuM71H_Screenshot%20at%20Mar%2028%2013-23-17.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n1TTxgIvSHOzoXbuM71H_Screenshot%20at%20Mar%2028%2013-23-17.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/F0iV0CdWSvGRVylzvlge_Screenshot%20at%20Mar%2028%2013-33-25.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/F0iV0CdWSvGRVylzvlge_Screenshot%20at%20Mar%2028%2013-33-25.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tWiXyZ2S6yHFgMByALfX_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%882.54.46.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tWiXyZ2S6yHFgMByALfX_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%882.54.46.png" alt="img"></a></p>
<p><strong>额外会谈到的主题是：</strong></p>
<ul>
<li>使用 gem “simple_form” 产生表单</li>
<li>限制看板标题“不得为空”</li>
</ul>
<h1 id="4-2-实作讨论群“新增”功能"><a href="#4-2-实作讨论群“新增”功能" class="headerlink" title="4-2 实作讨论群“新增”功能"></a>4-2 实作讨论群“新增”功能</h1><h2 id="目标-6"><a href="#目标-6" class="headerlink" title="目标"></a>目标</h2><ul>
<li>这一章我们要实作 讨论群 的新增功能</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n1TTxgIvSHOzoXbuM71H_Screenshot%20at%20Mar%2028%2013-23-17.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n1TTxgIvSHOzoXbuM71H_Screenshot%20at%20Mar%2028%2013-23-17.png" alt="img"></a></p>
<h2 id="步骤-4"><a href="#步骤-4" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-0-git-checkout-b-ch03"><a href="#Step-0-git-checkout-b-ch03" class="headerlink" title="Step 0. git checkout -b ch03"></a>Step 0. git checkout -b ch03</h3><p>因为我们现在要实作第三章的内容，新增一个 branch 把实作内容集中在 ch03 是比较合理的。将来回顾就可以比较清楚 在 ch03 我们做了哪一些练习。</p>
<p><code>git checkout -b ch03</code></p>
<h3 id="Step-1-建立-new-action"><a href="#Step-1-建立-new-action" class="headerlink" title="Step 1. 建立 new action"></a>Step 1. 建立 new action</h3><p>修改 app/controllers/groups_controller.rb 加入 new action</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line">  def index</div><div class="line">    @groups = Group.all</div><div class="line">  end</div><div class="line"></div><div class="line">+ def new</div><div class="line">+   @group = Group.new</div><div class="line">+ end</div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="Step-2-建立-new-action-的表单"><a href="#Step-2-建立-new-action-的表单" class="headerlink" title="Step 2. 建立 new action 的表单"></a>Step 2. 建立 new action 的表单</h3><p><code>touch app/views/groups/new.html.erb</code></p>
<p>app/views/groups/new.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;</div><div class="line">    &lt;h2&gt;新增讨论版&lt;/h2&gt;</div><div class="line"></div><div class="line">    &lt;hr&gt;</div><div class="line">    &lt;%= form_for @group do |f| %&gt;</div><div class="line"></div><div class="line">    标题</div><div class="line">    &lt;%= f.text_field :title %&gt;</div><div class="line">    &lt;br&gt;</div><div class="line">    叙述</div><div class="line">    &lt;br&gt;</div><div class="line">    &lt;%= f.text_area :description %&gt;</div><div class="line">    &lt;br&gt;</div><div class="line"></div><div class="line">    &lt;%= f.submit &quot;Submit&quot;, :disable_with =&gt; &apos;Submiting...&apos; %&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line"></div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>然后打开 <a href="http://localhost:3000/groups/new" target="_blank" rel="external">http://localhost:3000/groups/new</a>，可以见到成果</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n1TTxgIvSHOzoXbuM71H_Screenshot%20at%20Mar%2028%2013-23-17.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/n1TTxgIvSHOzoXbuM71H_Screenshot%20at%20Mar%2028%2013-23-17.png" alt="img"></a></p>
<h3 id="Step-3-git-存档"><a href="#Step-3-git-存档" class="headerlink" title="Step 3. git 存档"></a>Step 3. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;implement groups#new&quot;</code></p>
<h3 id="Step-4-建立-create-action，接收数据并储存"><a href="#Step-4-建立-create-action，接收数据并储存" class="headerlink" title="Step 4. 建立 create action，接收数据并储存"></a>Step 4. 建立 create action，接收数据并储存</h3><p>目前还只是个表单画面，无法将数据送出后成功建立出一笔讨论版的数据，缺了 action create。如果此时你按下 Submit，会看到这样的画面：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/4hQ318D1SoKBC2luPXb0_step4.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/4hQ318D1SoKBC2luPXb0_step4.png" alt="img"></a></p>
<p>所以这时候，我们要实作 create action，接收 new 里的表单送出的信息，变成一笔存在数据库里的数据。</p>
<p>修改 app/controllers/groups_controller.rb</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line">  def index</div><div class="line">    @groups = Group.all</div><div class="line">  end</div><div class="line"></div><div class="line">  def new</div><div class="line">    @group = Group.new</div><div class="line">  end</div><div class="line"></div><div class="line">+ def create</div><div class="line">+   @group = Group.new(group_params)</div><div class="line">+   @group.save</div><div class="line">+</div><div class="line">+     redirect_to groups_path</div><div class="line">+ end</div><div class="line">+</div><div class="line">+ private</div><div class="line">+</div><div class="line">+ def group_params</div><div class="line">+   params.require(:group).permit(:title, :description)</div><div class="line">+ end</div><div class="line">  </div><div class="line">end</div></pre></td></tr></table></figure>
<p>完成后再送一次即可成功建立数据，可以多建几笔数据测试功能。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/umGsHFTeSLWqaJVlgJOK_Screenshot%20at%20Mar%2028%2013-28-47.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/umGsHFTeSLWqaJVlgJOK_Screenshot%20at%20Mar%2028%2013-28-47.png" alt="img"></a></p>
<h3 id="Step-5-git-存档-1"><a href="#Step-5-git-存档-1" class="headerlink" title="Step 5. git 存档"></a>Step 5. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;implement groups#create&quot;</code></p>
<h1 id="4-3-实作讨论群“浏览”功能"><a href="#4-3-实作讨论群“浏览”功能" class="headerlink" title="4-3 实作讨论群“浏览”功能"></a>4-3 实作讨论群“浏览”功能</h1><h2 id="目标-7"><a href="#目标-7" class="headerlink" title="目标"></a>目标</h2><ul>
<li>这一章我们要实作 讨论群 的浏览功能</li>
</ul>
<p>这时候如果直接点 index 上的 title 连结, 会跳出下面的错误信息：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/yOgld2FRHOJGtZRVvxtN_goal.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/yOgld2FRHOJGtZRVvxtN_goal.png" alt="img"></a></p>
<p>我们要修正这个问题，让使用者可以浏览这个页面</p>
<h2 id="步骤-5"><a href="#步骤-5" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step1-建立-show-action"><a href="#Step1-建立-show-action" class="headerlink" title="Step1: 建立 show action"></a>Step1: 建立 show action</h3><p>在 app/controllers/groups_controller.rb 加入 show action</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line">  def index</div><div class="line">    @groups = Group.all</div><div class="line">  end</div><div class="line"></div><div class="line">+ def show</div><div class="line">+   @group = Group.find(params[:id])</div><div class="line">+ end</div><div class="line"></div><div class="line">  def new</div><div class="line">    @group = Group.new</div><div class="line">  end</div><div class="line"></div><div class="line">  def create</div><div class="line">    @group = Group.new(group_params)</div><div class="line">    @group.save</div><div class="line">  </div><div class="line">    redirect_to groups_path</div><div class="line">  end</div><div class="line"></div><div class="line">  private</div><div class="line"></div><div class="line">  def group_params</div><div class="line">    params.require(:group).permit(:title, :description)</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="Step-2-加入-app-views-groups-show-html-erb"><a href="#Step-2-加入-app-views-groups-show-html-erb" class="headerlink" title="Step 2: 加入 app/views/groups/show.html.erb"></a>Step 2: 加入 app/views/groups/show.html.erb</h3><p><code>touch app/views/groups/show.html.erb</code></p>
<p>加入以下内容</p>
<p>app/views/groups/show.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line">  &lt;div class=&quot;group&quot;&gt;</div><div class="line">    &lt;%= link_to(&quot;Edit&quot;, edit_group_path(@group), class: &quot;btn btn-primary pull-right&quot;)%&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;h2&gt;&lt;%= @group.title %&gt;&lt;/h2&gt;</div><div class="line">  &lt;p&gt;&lt;%= @group.description %&gt;&lt;/p&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>然后，当你浏览 <a href="http://localhost:3000/groups/1" target="_blank" rel="external">http://localhost:3000/groups/1</a> 时，页面就会长这样</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/UlV7qExeS1KECHNlZGDS_Screenshot%20at%20Mar%2028%2013-31-06.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/UlV7qExeS1KECHNlZGDS_Screenshot%20at%20Mar%2028%2013-31-06.png" alt="img"></a></p>
<h3 id="Step-3-git-存档-1"><a href="#Step-3-git-存档-1" class="headerlink" title="Step 3 : git 存档"></a>Step 3 : git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;implement groups#show&quot;</code></p>
<h1 id="4-4-实作讨论群“编辑”功能"><a href="#4-4-实作讨论群“编辑”功能" class="headerlink" title="4-4 实作讨论群“编辑”功能"></a>4-4 实作讨论群“编辑”功能</h1><h2 id="目标-8"><a href="#目标-8" class="headerlink" title="目标"></a>目标</h2><ul>
<li>这一节我们要实作 讨论群 的编辑功能</li>
</ul>
<h2 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h2><h3 id="Step-1-建立-edit-action"><a href="#Step-1-建立-edit-action" class="headerlink" title="Step 1. 建立 edit action"></a>Step 1. 建立 edit action</h3><p>修改 app/controllers/groups_controller.rb 加入 edit action</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line"></div><div class="line">  # 略 ...</div><div class="line"></div><div class="line">  </div><div class="line">  def show</div><div class="line">    @group = Group.find(params[:id])</div><div class="line">  end</div><div class="line"></div><div class="line">+ def edit</div><div class="line">+  @group = Group.find(params[:id])</div><div class="line">+ end</div><div class="line"></div><div class="line">  # 略 ...</div><div class="line"></div><div class="line"> </div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="Step-2-建立-edit-action-的表单"><a href="#Step-2-建立-edit-action-的表单" class="headerlink" title="Step 2. 建立 edit action 的表单"></a>Step 2. 建立 edit action 的表单</h3><p>新增 app/views/groups/edit.html.erb</p>
<p><code>touch app/views/groups/edit.html.erb</code></p>
<p>app/views/groups/edit.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;</div><div class="line">    &lt;h2&gt;编辑讨论版&lt;/h2&gt;</div><div class="line"></div><div class="line">    &lt;hr&gt;</div><div class="line">    &lt;%= form_for @group do |f| %&gt;</div><div class="line"></div><div class="line">    标题</div><div class="line">    &lt;%= f.text_field :title %&gt;</div><div class="line">    &lt;br&gt;</div><div class="line">    叙述</div><div class="line">    &lt;br&gt;</div><div class="line">    &lt;%= f.text_area :description %&gt;</div><div class="line">    &lt;br&gt;</div><div class="line"></div><div class="line">    &lt;%= f.submit &quot;Submit&quot;, :disable_with =&gt; &apos;Submiting...&apos; %&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line"></div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>然后打开 <a href="http://localhost:3000/groups/1/edit" target="_blank" rel="external">http://localhost:3000/groups/1/edit</a>，可以见到成果</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/F0iV0CdWSvGRVylzvlge_Screenshot%20at%20Mar%2028%2013-33-25.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/F0iV0CdWSvGRVylzvlge_Screenshot%20at%20Mar%2028%2013-33-25.png" alt="img"></a></p>
<h3 id="Step-3-git-存档-2"><a href="#Step-3-git-存档-2" class="headerlink" title="Step 3. git 存档"></a>Step 3. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;implement groups#edit &quot;</code></p>
<h3 id="Step-4-实作-update-action"><a href="#Step-4-实作-update-action" class="headerlink" title="Step 4. 实作 update action"></a>Step 4. 实作 update action</h3><p>这时候我们可以尝试修改里面的数据，并试着送出。但是我们发现会跳出错误信息，提醒我们 update 还没实作：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/7w8JHmfNSCOqi5di4GnN_step4.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/7w8JHmfNSCOqi5di4GnN_step4.png" alt="img"></a></p>
<p>所以这时候，我们要实作 update action，接收 edit 里的表单送出的信息，真正更新存在数据库里的数据。</p>
<p>修改 app/controllers/groups_controller.rb</p>
<p>app/controller/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line"></div><div class="line">    # ... 略</div><div class="line"></div><div class="line">  def create</div><div class="line">    @group = Group.new(group_params)</div><div class="line">    @group.save</div><div class="line"></div><div class="line">    redirect_to groups_path</div><div class="line">  end</div><div class="line"></div><div class="line">+  def update</div><div class="line">+    @group = Group.find(params[:id])</div><div class="line">+</div><div class="line">+    @group.update(group_params)</div><div class="line">+</div><div class="line">+    redirect_to groups_path, notice: &quot;Update Success&quot;</div><div class="line">+  end</div><div class="line"></div><div class="line">    # ... 略</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
<p>然后试着更新一下数据，成功画面应该会有“绿色”提示信息。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/zbLTF2HyQ5mYT1CGayvP_Screenshot%20at%20Mar%2028%2013-35-56.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/zbLTF2HyQ5mYT1CGayvP_Screenshot%20at%20Mar%2028%2013-35-56.png" alt="img"></a></p>
<h3 id="Step-5-git-存档-2"><a href="#Step-5-git-存档-2" class="headerlink" title="Step 5. git 存档"></a>Step 5. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;implement groups#update &quot;</code></p>
<h1 id="4-5-实作讨论群“删除”功能"><a href="#4-5-实作讨论群“删除”功能" class="headerlink" title="4-5 实作讨论群“删除”功能"></a>4-5 实作讨论群“删除”功能</h1><h2 id="目标-9"><a href="#目标-9" class="headerlink" title="目标"></a>目标</h2><ul>
<li>这一节我们要实作 讨论群 的删除功能</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/e5KmLEDKRpeK7hYd4WzN_Screenshot%20at%20Mar%2028%2013-41-39.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/e5KmLEDKRpeK7hYd4WzN_Screenshot%20at%20Mar%2028%2013-41-39.png" alt="img"></a></p>
<p>当我们点击 delete 按钮的时候, 会跳出下面的错误信息</p>
<p><a href="http://user-image.logdown.io/user/3653/blog/15213/post/393245/lv4Fm5lgSyKFLwhka3uC_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-29%20%E4%B8%8B%E5%8D%882.49.51.png" target="_blank" rel="external"><img src="http://user-image.logdown.io/user/3653/blog/15213/post/393245/lv4Fm5lgSyKFLwhka3uC_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202015-12-29%20%E4%B8%8B%E5%8D%882.49.51.png" alt="img"></a></p>
<h2 id="步骤：-1"><a href="#步骤：-1" class="headerlink" title="步骤："></a>步骤：</h2><h3 id="Step1-建立-delete-action"><a href="#Step1-建立-delete-action" class="headerlink" title="Step1. 建立 delete action"></a>Step1. 建立 delete action</h3><p>app/controllers/groups_controller.rb  </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">  # .... 略</div><div class="line">  def update</div><div class="line">    @group = Group.find(params[:id])</div><div class="line"></div><div class="line">    @group.update(group_params)</div><div class="line"></div><div class="line">    redirect_to groups_path, notice: &quot;Update Success&quot;</div><div class="line">  end</div><div class="line"></div><div class="line">+  def destroy</div><div class="line">+    @group = Group.find(params[:id])</div><div class="line">+    @group.destroy</div><div class="line">+    flash[:alert] = &quot;Group deleted&quot;</div><div class="line">+    redirect_to groups_path</div><div class="line">+  end</div><div class="line"></div><div class="line">  # .... 略</div></pre></td></tr></table></figure>
<p>然后，按下删除键之后，就可以把该笔记录删除。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/71uhUpUREqB4dKeRyeEA_Screenshot%20at%20Mar%2028%2013-39-47.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/71uhUpUREqB4dKeRyeEA_Screenshot%20at%20Mar%2028%2013-39-47.png" alt="img"></a></p>
<p>如果成功的话，可以看到显示“红色”的信息。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tWiXyZ2S6yHFgMByALfX_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%882.54.46.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tWiXyZ2S6yHFgMByALfX_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%882.54.46.png" alt="img"></a></p>
<h3 id="Step-2-git-存档-1"><a href="#Step-2-git-存档-1" class="headerlink" title="Step 2. git 存档"></a>Step 2. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;implement groups#destroy &quot;</code></p>
<h1 id="4-6-限制“标题为空”的Group，不能被新增"><a href="#4-6-限制“标题为空”的Group，不能被新增" class="headerlink" title="4-6 限制“标题为空”的Group，不能被新增"></a>4-6 限制“标题为空”的Group，不能被新增</h1><h2 id="目标-10"><a href="#目标-10" class="headerlink" title="目标"></a>目标</h2><ul>
<li>有时候我们会遇到使用者手残，直接送出全空的表单，结果就出现空文章</li>
<li>因此我们要加上一个限制，让使用者不能送出“空标题”文章才对</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xrqeAKZS9GL8cfozVPCJ_Screenshot%20at%20Mar%2028%2013-48-45.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xrqeAKZS9GL8cfozVPCJ_Screenshot%20at%20Mar%2028%2013-48-45.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/LXaQUOtkTrqZvyDzwI0w_Screenshot%20at%20Mar%2028%2013-49-45.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/LXaQUOtkTrqZvyDzwI0w_Screenshot%20at%20Mar%2028%2013-49-45.png" alt="img"></a></p>
<h2 id="步骤-6"><a href="#步骤-6" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-在-Group-model-加入“标题限制”"><a href="#Step-1-在-Group-model-加入“标题限制”" class="headerlink" title="Step 1: 在 Group model 加入“标题限制”"></a>Step 1: 在 Group model 加入“标题限制”</h3><p>修改 app/models/group.rb 让它长得像这样</p>
<p>app/models/group.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class Group &lt; ApplicationRecord</div><div class="line"> validates :title, presence: true</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这样一来，就算送出了空的表单，也不会产生任何纪录。</p>
<p>但我们真正希望达到的效果是像这样子的，送出了空表单，使用者能够确切地知道，自己是因为什么错误被拦下：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/eu3DA4QRSYdIBksgBvXg_Screenshot%20at%20Mar%2028%2013-53-53.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/eu3DA4QRSYdIBksgBvXg_Screenshot%20at%20Mar%2028%2013-53-53.png" alt="img"></a></p>
<h3 id="Step-2-在-groups-controller-里面加入储存失败的判断"><a href="#Step-2-在-groups-controller-里面加入储存失败的判断" class="headerlink" title="Step 2: 在 groups_controller 里面加入储存失败的判断"></a>Step 2: 在 groups_controller 里面加入储存失败的判断</h3><p>修改 app/controllers/groups_controller.rb</p>
<p>将 create action 修改成这样：</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">def create</div><div class="line">    @group = Group.new(group_params)</div><div class="line"></div><div class="line">    if @group.save</div><div class="line">      redirect_to groups_path</div><div class="line">    else</div><div class="line">      render :new</div><div class="line">    end</div><div class="line">  end</div></pre></td></tr></table></figure>
<p>然后修改 app/views/groups/new.html.erb</p>
<p>在 form_for 下方加入这一段：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/43jZcWHhQFOUTNmZCPzq_Screenshot%20at%20Feb%2024%2017-11-14.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/43jZcWHhQFOUTNmZCPzq_Screenshot%20at%20Feb%2024%2017-11-14.png" alt="img"></a></p>
<p>app/views/groups/new.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;% if @group.errors.any? %&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">  &lt;% @group.errors.full_messages.each do |msg| %&gt;</div><div class="line">    &lt;li&gt;&lt;%= msg %&gt;&lt;/li&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>然后就可以产生这样的效果</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/72EWSleeQeeblyOUGcie_Screenshot%20at%20Mar%2028%2013-54-25.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/72EWSleeQeeblyOUGcie_Screenshot%20at%20Mar%2028%2013-54-25.png" alt="img"></a></p>
<h3 id="Step-3-git-存档-3"><a href="#Step-3-git-存档-3" class="headerlink" title="Step 3 : git 存档"></a>Step 3 : git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;add validation to title&quot;</code></p>
<h3 id="Step-4-修改-edit-action"><a href="#Step-4-修改-edit-action" class="headerlink" title="Step 4 : 修改 edit action"></a>Step 4 : 修改 edit action</h3><p>还有一种情况是，在修改时，把标题改成空白的。<br>所以我们也要避免这样的情况发生。</p>
<p>修改 app/controllers/groups_controller.rb，的 update action 让他长得像这样</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">def update</div><div class="line">    @group = Group.find(params[:id])</div><div class="line">    if @group.update(group_params)</div><div class="line">      redirect_to groups_path, notice: &quot;Update Success&quot;</div><div class="line">    else</div><div class="line">      render :edit</div><div class="line">    end</div><div class="line">  end</div></pre></td></tr></table></figure>
<p>然后修改 app/views/groups/edit.html.erb</p>
<p>也在 form_for 下方加入这一段：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/M5UtJtBJR3KmK1LTLoor_Screenshot%20at%20Feb%2024%2017-16-01.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/M5UtJtBJR3KmK1LTLoor_Screenshot%20at%20Feb%2024%2017-16-01.png" alt="img"></a></p>
<p>app/views/groups/edit.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;% if @group.errors.any? %&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">  &lt;% @group.errors.full_messages.each do |msg| %&gt;</div><div class="line">    &lt;li&gt;&lt;%= msg %&gt;&lt;/li&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>这样，在“编辑”时，也有一样的效果。</p>
<h3 id="Step-5-git-存档-3"><a href="#Step-5-git-存档-3" class="headerlink" title="Step 5 : git 存档"></a>Step 5 : git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;add validation to title apply to edit/update&quot;</code></p>
<h4 id="本节常见问题"><a href="#本节常见问题" class="headerlink" title="本节常见问题"></a>本节常见问题</h4><h5 id="validates-title-presence-true-是什么意思"><a href="#validates-title-presence-true-是什么意思" class="headerlink" title="validates :title, presence: true 是什么意思"></a>validates :title, presence: true 是什么意思</h5><ul>
<li>这是 Rails 的 Model 内建的“验证”函式。意思是“不得为空”。</li>
<li>其实 Rails 还有很多内建验质函式，你可以看这里：<a href="http://guides.rubyonrails.org/active_record_validations.html" target="_blank" rel="external">http://guides.rubyonrails.org/active_record_validations.html</a></li>
</ul>
<h1 id="4-7-共用“表单”"><a href="#4-7-共用“表单”" class="headerlink" title="4-7 共用“表单”"></a>4-7 共用“表单”</h1><h2 id="目标-11"><a href="#目标-11" class="headerlink" title="目标"></a>目标</h2><ul>
<li>把 new 与 edit 重复的表单代码，抽成一个共用文件</li>
</ul>
<p>我们观察到，new 与 edit 都有相同的“表单代码”，显得相当累赘。在这里我们可以利用一个 Rails 内建的架构 partial去整理设计。</p>
<h2 id="步骤-7"><a href="#步骤-7" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-产生-app-views-groups-form-html-erb"><a href="#Step-1-产生-app-views-groups-form-html-erb" class="headerlink" title="Step 1: 产生 app/views/groups/_form.html.erb"></a>Step 1: 产生 app/views/groups/_form.html.erb</h3><p><code>touch app/views/groups/_form.html.erb</code></p>
<p>填入以下内容：</p>
<p>app/views/groups/_form.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;%= form_for @group do |f| %&gt;</div><div class="line">&lt;% if @group.errors.any? %&gt;</div><div class="line">&lt;ul&gt;</div><div class="line">  &lt;% @group.errors.full_messages.each do |msg| %&gt;</div><div class="line">    &lt;li&gt;&lt;%= msg %&gt;&lt;/li&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line">&lt;% end %&gt;</div><div class="line">标题</div><div class="line">&lt;%= f.text_field :title %&gt;</div><div class="line">&lt;br&gt;</div><div class="line">叙述</div><div class="line">&lt;br&gt;</div><div class="line">&lt;%= f.text_area :description %&gt;</div><div class="line">&lt;br&gt;</div><div class="line"></div><div class="line">&lt;%= f.submit &quot;Submit&quot;, :disable_with =&gt; &apos;Submiting...&apos; %&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-2-修改-app-views-groups-new-html-erb"><a href="#Step-2-修改-app-views-groups-new-html-erb" class="headerlink" title="Step 2: 修改 app/views/groups/new.html.erb"></a>Step 2: 修改 app/views/groups/new.html.erb</h3><p>修改 app/views/groups/new.html.erb，把原先重复的表单代码“整段删掉”，改成 &lt;%= render “form” %&gt;</p>
<p>app/views/groups/new.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;</div><div class="line">    &lt;h2&gt;新增讨论版&lt;/h2&gt;</div><div class="line"></div><div class="line">    &lt;hr&gt;</div><div class="line"></div><div class="line">    &lt;%= render &quot;form&quot; %&gt;</div><div class="line"></div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-3-修改-app-views-groups-edit-html-erb"><a href="#Step-3-修改-app-views-groups-edit-html-erb" class="headerlink" title="Step 3: 修改 app/views/groups/edit.html.erb"></a>Step 3: 修改 app/views/groups/edit.html.erb</h3><p>修改 app/views/groups/edit.html.erb，把原先重复的表单源代码“整段删掉”，改成 &lt;%= render “form” %&gt;</p>
<p>app/views/groups/edit.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;</div><div class="line">    &lt;h2&gt;编辑讨论版&lt;/h2&gt;</div><div class="line">    &lt;hr&gt;</div><div class="line"></div><div class="line">    &lt;%= render &quot;form&quot; %&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<h3 id="Step-4-git-存档"><a href="#Step-4-git-存档" class="headerlink" title="Step 4: git 存档"></a>Step 4: git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;move form to partial&quot;</code></p>
<h4 id="本节常见问题-1"><a href="#本节常见问题-1" class="headerlink" title="本节常见问题"></a>本节常见问题</h4><h5 id="教材里的render-“form”是什么意思？"><a href="#教材里的render-“form”是什么意思？" class="headerlink" title="教材里的render “form”是什么意思？"></a>教材里的render “form”是什么意思？</h5><p>其实这是 &lt;%= render :partial =&gt; “form” %&gt; 的“缩写”，意思是我要引用 Partial (局部）页面的方式。因为我们发现有很大量的程式码重复，所以可以用这样的方式收纳。<br>它的规则是同目录底下的 <code>_xxxx.html.erb</code></p>
<h1 id="4-8-将表单换为-Bootstrap-提供的版型"><a href="#4-8-将表单换为-Bootstrap-提供的版型" class="headerlink" title="4-8 将表单换为 Bootstrap 提供的版型"></a>4-8 将表单换为 Bootstrap 提供的版型</h1><h2 id="目标-12"><a href="#目标-12" class="headerlink" title="目标"></a>目标</h2><ul>
<li>将表单换为 Bootstrap 提供的版型</li>
</ul>
<p>虽然我们已经有看起来还可以的表单，但是 Bootstrap 本身提供的表单版型更棒。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/20hmVo9mTS2UjiRJLLvJ_Screenshot%20at%20Mar%2028%2014-07-38.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/20hmVo9mTS2UjiRJLLvJ_Screenshot%20at%20Mar%2028%2014-07-38.png" alt="img"></a></p>
<p>这一章，我们要示范怎么换成 Bootstrap 的表单版型。</p>
<h2 id="步骤-8"><a href="#步骤-8" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-修改-app-views-groups-form-html-erb"><a href="#Step-1-修改-app-views-groups-form-html-erb" class="headerlink" title="Step 1: 修改 app/views/groups/_form.html.erb"></a>Step 1: 修改 app/views/groups/_form.html.erb</h3><p>修改 app/views/groups/_form.html.erb，换成以下内容</p>
<p>app/views/groups/_form.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;%= form_for @group do |f| %&gt;</div><div class="line"></div><div class="line">&lt;div class=&quot;form-group&quot;&gt;</div><div class="line">    &lt;div class=&quot;form-group string optional&quot;&gt;</div><div class="line">        &lt;%= f.label &quot;title&quot;, :class =&gt; &quot;string optional control-label&quot; %&gt;</div><div class="line">        &lt;%= f.text_field :title, :class =&gt; &quot;string optional form-control&quot; %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line"></div><div class="line">    &lt;div class=&quot;form-group string optional&quot;&gt;</div><div class="line">        &lt;%= f.label &quot;description&quot;, :class =&gt; &quot;string optional control-label&quot; %&gt;</div><div class="line">        &lt;%= f.text_area :description, :class =&gt; &quot;string optional form-control&quot; %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line"></div><div class="line">&lt;/div&gt;</div><div class="line">&lt;%= f.submit &quot;Submit&quot;, class: &quot;btn btn-primary&quot;, data: &#123; disable_with: &quot;Submiting...&quot; &#125; %&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>然后打开 <a href="http://localhost:3000/groups/new" target="_blank" rel="external">http://localhost:3000/groups/new</a> 就可以看到这样的成果了</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/20hmVo9mTS2UjiRJLLvJ_Screenshot%20at%20Mar%2028%2014-07-38.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/20hmVo9mTS2UjiRJLLvJ_Screenshot%20at%20Mar%2028%2014-07-38.png" alt="img"></a></p>
<h3 id="Step-2：-git-存档"><a href="#Step-2：-git-存档" class="headerlink" title="Step 2： git 存档"></a>Step 2： git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;style form with bootstrap&quot;</code></p>
<h3 id="Step-3-使用-SimpleForm-简化"><a href="#Step-3-使用-SimpleForm-简化" class="headerlink" title="Step 3: 使用 SimpleForm 简化"></a>Step 3: 使用 SimpleForm 简化</h3><p>在这张新的表单 HTML 中，我们见到很啰唆的语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;form-group string optional&quot;&gt;</div><div class="line">    &lt;%= f.label &quot;title&quot;, :class =&gt; &quot;string optional control-label&quot; %&gt;</div><div class="line">    &lt;%= f.text_field :title, :class =&gt; &quot;string optional form-control&quot; %&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>然后每一个栏位，都必须要用 bootstrap 指定的样式，重新装潢。但是如此一来，要是在栏位很多时，要写的 HTML 就要写上不少。有没有方法可以简化呢？</p>
<p>这边我们要介绍一个 gem 叫做 simple_form，它可以帮你简化复杂的表单这件事。</p>
<p>首先我们要来安装 simple_form</p>
<p>打开 Gemfile，然后新增一行 gem ‘simple_form’</p>
<p>Gemfile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gem &apos;bootstrap-sass&apos;</div><div class="line">+ gem &apos;simple_form&apos;</div></pre></td></tr></table></figure>
<p>然后执行</p>
<p><code>bundle install</code></p>
<p>安装 gem。</p>
<h3 id="Step-4-安装-simple-form-for-bootstrap-的设定"><a href="#Step-4-安装-simple-form-for-bootstrap-的设定" class="headerlink" title="Step 4: 安装 simple_form for bootstrap 的设定"></a>Step 4: 安装 simple_form for bootstrap 的设定</h3><p>执行：</p>
<p><code>rails generate simple_form:install --bootstrap</code></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/qhG8fT0yICTvwdE71igI_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%885.45.42.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/qhG8fT0yICTvwdE71igI_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%885.45.42.png" alt="img"></a></p>
<p>然后重开 rails server（ 按 ctrl＋c 终止 rails server， 再运行 <code>rails s</code>）</p>
<p>这个指令会产生两个文件</p>
<ul>
<li>config/initializers/simple_form.rb</li>
<li>config/initializers/simple_form_bootstrap.rb （这个是 Bootstrap 表单的“布景”)</li>
</ul>
<h3 id="Step-5-修改-app-views-groups-form-html-erb"><a href="#Step-5-修改-app-views-groups-form-html-erb" class="headerlink" title="Step 5: 修改 app/views/groups/_form.html.erb"></a>Step 5: 修改 app/views/groups/_form.html.erb</h3><p>把内容改成</p>
<p>app/views/groups/_form.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;%= simple_form_for @group do |f| %&gt;</div><div class="line">  &lt;div class=&quot;form-group&quot;&gt;</div><div class="line">    &lt;%= f.input :title, input_html: &#123; class: &quot;form-control&quot;&#125; %&gt;</div><div class="line">    &lt;%= f.input :description, input_html: &#123; class: &quot;form-control&quot;&#125; %&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;%= f.submit &quot;Submit&quot;, class: &quot;btn btn-primary&quot;, data: &#123; disable_with: &quot;Submiting...&quot; &#125; %&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>然后打开 <a href="http://localhost:3000/groups/new" target="_blank" rel="external">http://localhost:3000/groups/new</a> 就可以看到这样的成果了。更棒的是 simple_form 提供的错误信息，直接是在栏位旁边的。更明显更直观。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/cpAc8EKsTRy54IoQtrEQ_Screenshot%20at%20Mar%2028%2014-11-36.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/cpAc8EKsTRy54IoQtrEQ_Screenshot%20at%20Mar%2028%2014-11-36.png" alt="img"></a></p>
<h3 id="Step-6-git-存档-1"><a href="#Step-6-git-存档-1" class="headerlink" title="Step 6: git 存档"></a>Step 6: git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;replace form with simple_form bootstrap template&quot;</code></p>
<h4 id="本节常见问题-2"><a href="#本节常见问题-2" class="headerlink" title="本节常见问题"></a>本节常见问题</h4><h5 id="为什么装完-gem-后要重开？"><a href="#为什么装完-gem-后要重开？" class="headerlink" title="为什么装完 gem 后要重开？"></a>为什么装完 gem 后要重开？</h5><p>* 因为 gem 不是动态载入 Rails 环境的，只有“你在 app/ 下开发的程式码”是动态载入，所以当有 <code>app</code> 外的档案被修改，你都应该“重开”治百病。</p>
<h1 id="4-9（解说）Rails-的-CRUD-与-RESTful"><a href="#4-9（解说）Rails-的-CRUD-与-RESTful" class="headerlink" title="4-9（解说）Rails 的 CRUD 与 RESTful"></a>4-9（解说）Rails 的 CRUD 与 RESTful</h1><p>如果你还在做第一遍练习时，请跳过这整章解说，否则你大脑会乱掉！<br>如果你还在做第一遍练习时，请跳过这整章解说，否则你大脑会乱掉！<br>如果你还在做第一遍练习时，请跳过这整章解说，否则你大脑会乱掉！</p>
<ul>
<li>叫你滚出去还不明白吗？</li>
<li>叫你滚出去还不明白吗？</li>
<li>叫你滚出去还不明白吗？</li>
</ul>
<p>好。我现在确定你应该已经是做第二遍了，才看这一篇解说的。</p>
<h2 id="HTTP-请求-Request）与-HTTP-动作-Verb）"><a href="#HTTP-请求-Request）与-HTTP-动作-Verb）" class="headerlink" title="HTTP 请求( Request）与 HTTP 动作 ( Verb）"></a>HTTP 请求( Request）与 HTTP 动作 ( Verb）</h2><p>一般网页的运作原理是这样的：</p>
<ol>
<li>使用者在浏览器输入了某个网址，点击了某个连结。这都叫发出 HTTP 请求 ( Request）。</li>
<li>而浏览器回应之后：产生页面，或者是重新导向。这都叫 HTTP 回应（ Response）。</li>
</ol>
<p>一般来说，使用者最常使用的是两种类型 / 动作 ( Verb )的请求： GET 与 POST。</p>
<ul>
<li>GET ：输入网址，点击某些网址。这都是 GET。</li>
<li>POST：送出表单。这叫做 POST</li>
</ul>
<h2 id="RESTful-的基础概念"><a href="#RESTful-的基础概念" class="headerlink" title="RESTful 的基础概念"></a>RESTful 的基础概念</h2><p>因为 CRUD 是常见的操作行为，但是大家实作的方式、与网址设计方式不一样。造成很多维护上的困扰。</p>
<p>后来就有人发明 RESTful 这个概念，希望用 HTTP 的动作 ( Verb）一起去封装 CRUD 的行为。所以又多加了两个动作：</p>
<ul>
<li>PUT : 更新 ( update )</li>
<li>DELETE : 删除 ( delete）</li>
</ul>
<p>而 Rails 的 Routing 也是依循这样的理念去设计。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rGUHz08gQriXQbiPLTE4_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%881.29.48.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rGUHz08gQriXQbiPLTE4_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%881.29.48.png" alt="img"></a></p>
<h2 id="Rails-的基础-RESTful概念"><a href="#Rails-的基础-RESTful概念" class="headerlink" title="Rails 的基础 RESTful概念"></a>Rails 的基础 RESTful概念</h2><p>由于RESTful是个新手不容易一下子理解的概念，号称学 Ruby on Rails 初期最大障碍。</p>
<p>在本篇尽量用浅显易懂的方式解释。如果看不懂也没关系，用背的！！</p>
<p>一定要背起来！</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WJXUF3ISuyzR26tmyNc9_xDdK3FnmSXyZC9mUxjtL_TPgJPeyuQkyNumT3bJGA_RESTful.jpg" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WJXUF3ISuyzR26tmyNc9_xDdK3FnmSXyZC9mUxjtL_TPgJPeyuQkyNumT3bJGA_RESTful.jpg" alt="img"></a></p>
<h2 id="以下例子以-第三章，-做出-CRUD-功能的讨论版来解释："><a href="#以下例子以-第三章，-做出-CRUD-功能的讨论版来解释：" class="headerlink" title="以下例子以 第三章， 做出 CRUD 功能的讨论版来解释："></a>以下例子以 第三章， 做出 CRUD 功能的讨论版来解释：</h2><ul>
<li>讨论版有个群组叫： groups。在 Restful 的概念里把这个 groups 叫做 resources，“一组资源”的意思。</li>
</ul>
<p>为了要控制它的运作，我们会创建一个新的 Controller文件 叫做 groups_controller.rb</p>
<p>HTTP Verb 有四种：</p>
<ul>
<li>新增 (create，使用 POST )</li>
<li>读取 (read，使用 GET )</li>
<li>更新 (update，使用 PUT )</li>
<li>删除 (destroy，使用 DELETE)</li>
</ul>
<p>在这组 controller 当中，我们会实作 7 个 Action ，4 张页面。</p>
<ul>
<li>首页( index )：用来列出所有的讨论版，可以选择各个单版 （使用 GET )</li>
<li>各个讨论版专属页面(show)：显示讨论版版名跟简介 (使用 GET )</li>
<li>新增页面(new)：里面会有表单，填完以后可以送出 (使用 GET )</li>
<li>产生数据（create) ：new 送出来的表单到 create 这个 action，新增一笔数据 ( 使用 POST )</li>
<li>编辑页面(edit)：里面会有表单呈现现有数据来，填完数据后可以送出 (使用 GET )</li>
<li>更新数据（update)：edit 送出来的表单可以到 update 这个 action，更新该笔数据 (使用 PUT )</li>
<li>删除数据：送出删除请求，删除该笔数据（使用 DELETE）</li>
</ul>
<p>这七个 action ，是每个CRUD功能里最基本的动作。只要我们在 controller.rb 里定义 (def) 好这七个方法当作动作 (action)。其他的部分 Rails 就会帮我们处理了。</p>
<p>像是设定 Routing (路由) 只需要简单一行:</p>
<p>config/routes.rb<code>resources :groups</code></p>
<p>这样不管浏览器端跑来什么样的请求 (request) ，Routing都会聪明地帮我们导向正确的 action 去运作后续流程。</p>
<h2 id="网址对应关系"><a href="#网址对应关系" class="headerlink" title="网址对应关系"></a>网址对应关系</h2><p>对于网址跟对应的Action与页面来说</p>
<ul>
<li>/groups/ 一定就是 index，首页，对应Routes路径： groups_path</li>
<li>/groups/123 一定就是 show，名字为123的讨论版个版页面，对应Routes路径： group_path(123)</li>
<li>/groups/123/edit 一定就是 edit，编辑讨论版123的表单页面，对应Routes路径：edit_group_path(123)</li>
<li>/groups/new 一定就是 new，新增讨论版的表单页面，对应Routes路径(或称为helper)：new_group_path</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>所以制作一个 RESTful 风格的讨论版，我们仅需在Routes设定一行代码即可</p>
<h1 id="5-1-本章目标"><a href="#5-1-本章目标" class="headerlink" title="5-1 本章目标"></a>5-1 本章目标</h1><h2 id="本章目标"><a href="#本章目标" class="headerlink" title="本章目标:"></a>本章目标:</h2><ul>
<li>安装“会员系统”（使用 devise）</li>
<li>在 navbar 安装登录/退出按钮</li>
<li>只有登录了的使用者，才可以建立群组</li>
<li>只有群组的建立者，才可以 编辑 / 删除群组</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/BEK2JoGTDyQsBLpVzVuZ_Screenshot%20at%20Mar%2028%2014-22-34.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/BEK2JoGTDyQsBLpVzVuZ_Screenshot%20at%20Mar%2028%2014-22-34.png" alt="img"></a></p>
<p><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/G5VGS3Qfa0fCYfoCtdtw_Screenshot%20at%20Mar%2028%2014-23-45.png" alt=""></p>
<h1 id="5-2-安装-devise-gem"><a href="#5-2-安装-devise-gem" class="headerlink" title="5-2 安装 devise gem"></a>5-2 安装 devise gem</h1><h2 id="目标-13"><a href="#目标-13" class="headerlink" title="目标"></a>目标</h2><ul>
<li>做会员系统似乎很困难？让我告诉你，在 Rails 内一点都不会！</li>
<li>利用 devise 实作会员系统</li>
</ul>
<h2 id="步骤-9"><a href="#步骤-9" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-0-git-checkout-b-ch04"><a href="#Step-0-git-checkout-b-ch04" class="headerlink" title="Step 0. git checkout -b ch04"></a>Step 0. git checkout -b ch04</h3><p>因为我们现在要实作第四章的内容，新增一个 branch 把实作内容集中在 ch04 是比较合理的。将来回顾就可以比较清楚 在 ch04 我们做了哪一些练习。</p>
<p><code>git checkout -b ch04</code></p>
<h3 id="Step-1-安装登录系统"><a href="#Step-1-安装登录系统" class="headerlink" title="Step 1: 安装登录系统"></a>Step 1: 安装登录系统</h3><p>Devise 是一个 Rails 内热门的 gem，专门用来快速实作“登录系统”。在这一章我们会用 devise 实作登录功能。</p>
<p>Gemfile 新增一行 gem ‘devise’</p>
<p>Gemfile<code>gem &#39;devise&#39;</code></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/OPcBS4K1Sc6ugg74McMT_step1.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/OPcBS4K1Sc6ugg74McMT_step1.png" alt="img"></a></p>
<p>然后执行</p>
<p><code>bundle install</code></p>
<h3 id="Step-2-产生会员系统的必要文件"><a href="#Step-2-产生会员系统的必要文件" class="headerlink" title="Step 2 : 产生会员系统的必要文件"></a>Step 2 : 产生会员系统的必要文件</h3><p>执行</p>
<p><code>rails g devise:install</code><br><code>rails g devise user</code><br><code>rake db:migrate</code></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Pyn1QXERRDitrIsfO7l2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%886.30.38.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Pyn1QXERRDitrIsfO7l2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%886.30.38.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/38OJJxJMSPisjGXEoap3_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%886.30.23.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/38OJJxJMSPisjGXEoap3_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%886.30.23.png" alt="img"></a></p>
<p>然后重开 rails server</p>
<h3 id="Step-3-在-groups-controller-限制-“新增讨论群”必须先登录"><a href="#Step-3-在-groups-controller-限制-“新增讨论群”必须先登录" class="headerlink" title="Step 3: 在 groups_controller 限制 “新增讨论群”必须先登录"></a>Step 3: 在 groups_controller 限制 “新增讨论群”必须先登录</h3><p>在 app/controllers/groups_controller.rb 加入一行 before_action :authenticate_user! , only: [:new]</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line">  before_action :authenticate_user! , only: [:new]</div></pre></td></tr></table></figure>
<p>然后这时候当你要访问 <a href="http://localhost:3000/groups/new" target="_blank" rel="external">http://localhost:3000/groups/new</a> 时，就会出现“登录画面”阻挡。可以注册一个账户试试效果。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/33c0ooBvQyyFNkJHQkFQ_Screenshot%20at%20Mar%2028%2014-16-22.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/33c0ooBvQyyFNkJHQkFQ_Screenshot%20at%20Mar%2028%2014-16-22.png" alt="img"></a></p>
<h3 id="Step-4-git-存档-1"><a href="#Step-4-git-存档-1" class="headerlink" title="Step 4: git 存档"></a>Step 4: git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;install devise&quot;</code></p>
<h4 id="本节常见问题-3"><a href="#本节常见问题-3" class="headerlink" title="本节常见问题"></a>本节常见问题</h4><h5 id="devise-帮我们做了什么？"><a href="#devise-帮我们做了什么？" class="headerlink" title="devise 帮我们做了什么？"></a>devise 帮我们做了什么？</h5><ul>
<li>在这一阶段的细节，你不太需要知道他是怎么运作？（事实上也很复杂）<br>* 你只要知道 <code>before_action :authenticate_user!</code> 可以帮你做出“限制使用者必须登入”的功能。</li>
</ul>
<h5 id="before-action-又是什么呢？"><a href="#before-action-又是什么呢？" class="headerlink" title="before_action 又是什么呢？"></a>before_action 又是什么呢？</h5><p><code>before_action</code> 后面加的往往是一个 controller 内的 method，在这里 <code>:authenticate_user!</code> 是 devise 提供的内建功能。</p>
<ul>
<li><code>before_action :authenticate_user! , only: [:new]</code>，表示“只有 new 需要登入”</li>
<li><code>before_action :authenticate_user!</code> 后面不加任何东西，表示这个 controller 下的所有 action 都要登入。<br>* 你可以把 <code>before_action</code> 想像成“先过我这一关”的“拦截器”</li>
</ul>
<h1 id="5-3-让这个网站有实际“登录”、“退出”的功能"><a href="#5-3-让这个网站有实际“登录”、“退出”的功能" class="headerlink" title="5-3 让这个网站有实际“登录”、“退出”的功能"></a>5-3 让这个网站有实际“登录”、“退出”的功能</h1><h2 id="目标-14"><a href="#目标-14" class="headerlink" title="目标"></a>目标</h2><ul>
<li>让右上角的“登录”可以实际有：“登录” / “退出的效果”</li>
</ul>
<h2 id="步骤-10"><a href="#步骤-10" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-修改-app-views-common-navbar-html-erb"><a href="#Step-1-修改-app-views-common-navbar-html-erb" class="headerlink" title="Step 1: 修改 app/views/common/_navbar.html.erb"></a>Step 1: 修改 app/views/common/_navbar.html.erb</h3><p>app/views/common/_navbar.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">-                &lt;li&gt; </div><div class="line">-                  &lt;%= link_to(&quot;登录&quot;, &apos;#&apos;) %&gt;   </div><div class="line">-                &lt;/li&gt;</div><div class="line">+                &lt;% if !current_user %&gt;</div><div class="line">+                  &lt;li&gt;&lt;%= link_to(&quot;注册&quot;, new_user_registration_path) %&gt; &lt;/li&gt;</div><div class="line">+                  &lt;li&gt;&lt;%= link_to(&quot;登录&quot;, new_user_session_path) %&gt;&lt;/li&gt;</div><div class="line">+                &lt;% else %&gt;</div><div class="line">+                  &lt;li class=&quot;dropdown&quot;&gt;</div><div class="line">+                    &lt;a href=&quot;#&quot; class=&quot;dropdown-toggle&quot; data-toggle=&quot;dropdown&quot;&gt;</div><div class="line">+                        Hi!, &lt;%= current_user.email %&gt;</div><div class="line">+                        &lt;b class=&quot;caret&quot;&gt;&lt;/b&gt;</div><div class="line">+                    &lt;/a&gt;</div><div class="line">+                    &lt;ul class=&quot;dropdown-menu&quot;&gt;</div><div class="line">+                        &lt;li&gt; &lt;%= link_to(&quot;退出&quot;, destroy_user_session_path, method: :delete) %&gt; &lt;/li&gt;</div><div class="line">+                    &lt;/ul&gt;</div><div class="line">+                  &lt;/li&gt;</div><div class="line">+                &lt;% end %&gt;</div></pre></td></tr></table></figure>
<p><strong>（+号代表新增的意思，复制贴上的时候请删掉它，-号代表删除的意思）</strong></p>
<h3 id="Step-2-修改-app-assets-javascripts-application-js"><a href="#Step-2-修改-app-assets-javascripts-application-js" class="headerlink" title="Step 2: 修改 app/assets/javascripts/application.js"></a>Step 2: 修改 app/assets/javascripts/application.js</h3><p>加入 //= require bootstrap/dropdown</p>
<p>app/assets/javascripts/application.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//= require bootstrap/alert</div><div class="line">+ //= require bootstrap/dropdown</div></pre></td></tr></table></figure>
<p><strong>（+号代表新增的意思，复制贴上的时候请删掉它）</strong></p>
<p>成果应该会是这样的效果。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/BEK2JoGTDyQsBLpVzVuZ_Screenshot%20at%20Mar%2028%2014-22-34.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/BEK2JoGTDyQsBLpVzVuZ_Screenshot%20at%20Mar%2028%2014-22-34.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/G5VGS3Qfa0fCYfoCtdtw_Screenshot%20at%20Mar%2028%2014-23-45.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/G5VGS3Qfa0fCYfoCtdtw_Screenshot%20at%20Mar%2028%2014-23-45.png" alt="img"></a></p>
<h3 id="Step-3-git-储存"><a href="#Step-3-git-储存" class="headerlink" title="Step 3: git 储存"></a>Step 3: git 储存</h3><p><code>git add .</code><br><code>git commit -m &quot;user can login/logout/signup&quot;</code></p>
<h4 id="本节常见问题-4"><a href="#本节常见问题-4" class="headerlink" title="**本节常见问题"></a>**本节常见问题</h4><h5 id="current-user-是什么？"><a href="#current-user-是什么？" class="headerlink" title="current_user 是什么？"></a>current_user 是什么？</h5><p><code>current_user</code> 是 Devise 提供的“正在登入的当前用户”，你可以在 controller 或 view 里面使用它。</p>
<h5 id="current-user-又是什么"><a href="#current-user-又是什么" class="headerlink" title="!current_user 又是什么"></a>!current_user 又是什么</h5><p><code>!</code> 表示不等于。<code>!current_user</code> 表示“现在没有登入的用户”（不在登入的状态）</p>
<h1 id="5-4-让“群组”与“使用者”产生关联"><a href="#5-4-让“群组”与“使用者”产生关联" class="headerlink" title="5-4 让“群组”与“使用者”产生关联"></a>5-4 让“群组”与“使用者”产生关联</h1><h2 id="目标-15"><a href="#目标-15" class="headerlink" title="目标"></a>目标</h2><ul>
<li>我们要让“群组”记录是“被谁开的”。</li>
<li>并且在看板一览表显示出来“开设者的名称”</li>
</ul>
<h2 id="步骤-11"><a href="#步骤-11" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-新增-user-id-到-group-的-table-里"><a href="#Step-1-新增-user-id-到-group-的-table-里" class="headerlink" title="Step 1: 新增 user_id 到 group 的 table 里"></a>Step 1: 新增 user_id 到 group 的 table 里</h3><p>执行</p>
<p><code>rails g migration add_user_id_to_group</code></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/JomTVi8eTUmTKcAgTQb0_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%886.53.02.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/JomTVi8eTUmTKcAgTQb0_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%886.53.02.png" alt="img"></a></p>
<p>然后打开刚刚新增的 migration 档，修改让它长得像这样</p>
<p>db/migrate/一串数字_add_user_id_to_group</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class AddUserIdToGroup &lt; ActiveRecord::Migration[5.0]</div><div class="line">  def change</div><div class="line">    add_column :groups, :user_id, :integer</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>然后，执行</p>
<p><code>rake db:migrate</code></p>
<h3 id="Step-2-连结-user-与-group-的双向关系"><a href="#Step-2-连结-user-与-group-的双向关系" class="headerlink" title="Step 2: 连结 user 与 group 的双向关系"></a>Step 2: 连结 user 与 group 的双向关系</h3><p>修改 app/models/user.rb 加入 has_many :groups</p>
<p>app/models/user.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class User &lt; ApplicationRecord</div><div class="line">  # Include default devise modules. Others available are:</div><div class="line"></div><div class="line">  # :confirmable, :lockable, :timeoutable and :omniauthable</div><div class="line"></div><div class="line">  devise :database_authenticatable, :registerable,</div><div class="line">         :recoverable, :rememberable, :trackable, :validatable</div><div class="line"></div><div class="line">  has_many :groups</div><div class="line">end</div></pre></td></tr></table></figure>
<p>修改 app/models/group.rb 加入 belongs_to :user</p>
<p>app/models/group.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Group &lt; ApplicationRecord</div><div class="line">  belongs_to :user</div><div class="line">  validates :title, presence: true</div><div class="line">end</div></pre></td></tr></table></figure>
<p>Step 3: 在新增看板时，记录谁是群组的建立者</p>
<p>修改 app/controllers/groups_controller.rb，在需要“登入验证”的 action 列表再加入 create。</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line">  before_action :authenticate_user! , only: [:new, :create]</div></pre></td></tr></table></figure>
<p>修改 app/controllers/groups_controller.rb，在 create 中，多加入一行 @group.user = current_user。</p>
<p>变成以下内容：</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">def create</div><div class="line">    @group = Group.new(group_params)</div><div class="line">    @group.user = current_user</div><div class="line">    </div><div class="line">    if @group.save</div><div class="line">      redirect_to groups_path</div><div class="line">    else</div><div class="line">      render :new</div><div class="line">    end</div><div class="line">  end</div></pre></td></tr></table></figure>
<h3 id="Step-4-git-储存"><a href="#Step-4-git-储存" class="headerlink" title="Step 4 : git 储存"></a>Step 4 : git 储存</h3><p><code>git add .</code><br><code>git commit -m &quot;add user_id to group&quot;</code></p>
<h3 id="Step-5-修改-group-列表，将-user-的名字列上去"><a href="#Step-5-修改-group-列表，将-user-的名字列上去" class="headerlink" title="Step 5 : 修改 group 列表，将 user 的名字列上去"></a>Step 5 : 修改 group 列表，将 user 的名字列上去</h3><p>修改 app/views/groups/index.html.erb 然后把 Creator 的信息加进去。（代码如下）</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/47PSYmIOSxqqvC1El5iR_Screenshot%20at%20Feb%2024%2017-48-19.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/47PSYmIOSxqqvC1El5iR_Screenshot%20at%20Feb%2024%2017-48-19.png" alt="img"></a></p>
<p>app/views/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line">  &lt;div class=&quot;group&quot;&gt;</div><div class="line">    &lt;%= link_to(&quot;New group&quot;, new_group_path, class: &quot;btn btn-primary pull-right&quot;) %&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;table class=&quot;table table-hover&quot;&gt;</div><div class="line">    &lt;thead&gt;</div><div class="line">      &lt;tr&gt;</div><div class="line">        &lt;td&gt;#&lt;/td&gt;</div><div class="line">        &lt;td&gt;Title&lt;/td&gt;</div><div class="line">        &lt;td&gt;Description&lt;/td&gt;</div><div class="line">+       &lt;td&gt;Creator &lt;/td&gt;</div><div class="line">      &lt;/tr&gt;</div><div class="line">    &lt;/thead&gt;</div><div class="line">    &lt;tbody&gt;</div><div class="line">      &lt;% @groups.each do |group| %&gt;</div><div class="line">        &lt;tr&gt;</div><div class="line">          &lt;td&gt;#&lt;/td&gt;</div><div class="line">          &lt;td&gt;&lt;%= link_to(group.title, group_path(group)) %&gt;&lt;/td&gt;</div><div class="line">          &lt;td&gt;&lt;%= group.description %&gt;&lt;/td&gt;</div><div class="line">+         &lt;td&gt; &lt;%= group.user.email %&gt; &lt;/td&gt;</div><div class="line">          &lt;td&gt;</div><div class="line">              &lt;%= link_to(&quot;Edit&quot;, edit_group_path(group), class: &quot;btn btn-sm btn-default&quot;)%&gt;</div><div class="line">              &lt;%= link_to(&quot;Delete&quot;, group_path(group),    class: &quot;btn btn-sm btn-default&quot;,</div><div class="line">                          method: :delete, data: &#123; confirm: &quot;Are you sure?&quot; &#125; )%&gt;</div><div class="line">          &lt;/td&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">      &lt;% end %&gt;</div><div class="line">    &lt;/tbody&gt;</div><div class="line">  &lt;/table&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>做完之后，打开 <a href="http://localhost:3000/" target="_blank" rel="external">http://localhost:3000/</a> 会发现，首页怎么爆炸了。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/zCXLBKPCTOWsKmTLBghp_Screenshot%20at%20Mar%2028%2014-36-19.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/zCXLBKPCTOWsKmTLBghp_Screenshot%20at%20Mar%2028%2014-36-19.png" alt="img"></a></p>
<p>别担心，这是因为我们之前创造的“群组”都是“无主”的。只要把这些“无主”的群组，通通删掉就行了。既然我们也进不去首页删群组了，我们就从 console 删吧。</p>
<h3 id="Step-6-删除所有“无主”的群组"><a href="#Step-6-删除所有“无主”的群组" class="headerlink" title="Step 6: 删除所有“无主”的群组"></a>Step 6: 删除所有“无主”的群组</h3><p>执行</p>
<p><code>rails console</code></p>
<p>然后输入</p>
<p><code>Group.delete_all</code></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/zqwtQsxhTZGUiUpIaqAI_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%888.18.22.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/zqwtQsxhTZGUiUpIaqAI_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-11%20%E4%B8%8B%E5%8D%888.18.22.png" alt="img"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exit</div></pre></td></tr></table></figure>
<p>然后再打开 <a href="http://localhost:3000/" target="_blank" rel="external">http://localhost:3000/</a> 就正常了。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/HTjkeLsvQlaSLf2ODLA6_Screenshot%20at%20Mar%2028%2014-37-50.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/HTjkeLsvQlaSLf2ODLA6_Screenshot%20at%20Mar%2028%2014-37-50.png" alt="img"></a></p>
<p>这时候我们再新增一笔数据，就会显示 creator 的信息了。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/LP1ACYrS6CteAF6jUbdC_Screenshot%20at%20Mar%2028%2014-38-26.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/LP1ACYrS6CteAF6jUbdC_Screenshot%20at%20Mar%2028%2014-38-26.png" alt="img"></a></p>
<h3 id="Step-7-git-存档"><a href="#Step-7-git-存档" class="headerlink" title="Step 7 : git 存档"></a>Step 7 : git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;show group&#39;s creator info &quot;</code></p>
<h4 id="本节常见问题-5"><a href="#本节常见问题-5" class="headerlink" title="**本节常见问题"></a>**本节常见问题</h4><h5 id="has-many-与-belongs-to-是什么意思？"><a href="#has-many-与-belongs-to-是什么意思？" class="headerlink" title="has_many 与 belongs_to 是什么意思？"></a>has_many 与 belongs_to 是什么意思？</h5><p>has_many 拥有很多<br>belongs_to 属于<br>就是这么直观！记得你一定要帮他们加上关联！</p>
<h1 id="5-5-只有群组的“创始者”可以“编辑”“删除”群组资讯"><a href="#5-5-只有群组的“创始者”可以“编辑”“删除”群组资讯" class="headerlink" title="5-5 只有群组的“创始者”可以“编辑”“删除”群组资讯"></a>5-5 只有群组的“创始者”可以“编辑”“删除”群组资讯</h1><h2 id="目标-16"><a href="#目标-16" class="headerlink" title="目标"></a>目标</h2><ul>
<li>路人不应该可以看到“编辑”“删除”按钮</li>
<li>只有群组的“创始者”可以实际执行“编辑”“删除”群组资讯</li>
</ul>
<h2 id="步骤-12"><a href="#步骤-12" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-路人不应该可以看到“编辑”“删除”按钮"><a href="#Step-1-路人不应该可以看到“编辑”“删除”按钮" class="headerlink" title="Step 1: 路人不应该可以看到“编辑”“删除”按钮"></a>Step 1: 路人不应该可以看到“编辑”“删除”按钮</h3><p>让我们登出系统，在这里我们察觉一个严重的问题：明明是路人，怎么能看到“编辑”“删除”按钮的资讯呢？</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/mALyeLKkQVSVYkqVWLXG_Screenshot%20at%20Mar%2028%2014-40-48.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/mALyeLKkQVSVYkqVWLXG_Screenshot%20at%20Mar%2028%2014-40-48.png" alt="img"></a></p>
<p>所以在这里我们要把“编辑”“删除”这两个按钮藏起来，限定</p>
<ul>
<li>只有登入模式下</li>
<li>而且还必须是群组“创始者”</li>
</ul>
<p>才能看得到这个两个按钮，否则路人是看不到的。</p>
<p>修改 app/views/groups/index.html.erb</p>
<p>加入 &lt;% if current_user &amp;&amp; current_user == group.user %&gt; 的判断式</p>
<p>app/views/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;td&gt;</div><div class="line">+            &lt;% if current_user &amp;&amp; current_user == group.user %&gt;</div><div class="line">             &lt;%= link_to(&quot;Edit&quot;, edit_group_path(group), class: &quot;btn btn-sm btn-default&quot;)%&gt;</div><div class="line">             &lt;%= link_to(&quot;Delete&quot;, group_path(group),    class: &quot;btn btn-sm btn-default&quot;,</div><div class="line">                         method: :delete, data: &#123; confirm: &quot;Are you sure?&quot; &#125; )%&gt;</div><div class="line">+            &lt;% end %&gt;</div><div class="line">          &lt;/td&gt;</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/uheHTau6QMS4ALdpjTEG_current_user_index.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/uheHTau6QMS4ALdpjTEG_current_user_index.png" alt="img"></a></p>
<p>重新刷新首页，路人现在就看不到按钮了。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/oU7UA4CJQLmCSOPmXpVP_Screenshot%20at%20Mar%2028%2014-42-54.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/oU7UA4CJQLmCSOPmXpVP_Screenshot%20at%20Mar%2028%2014-42-54.png" alt="img"></a></p>
<h3 id="Step-2-git-存档-2"><a href="#Step-2-git-存档-2" class="headerlink" title="Step 2: git 存档"></a>Step 2: git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;people can&#39;t see edit button unless he is group owner&quot;</code></p>
<h3 id="Step-3-路人不应该也可以“直接输入网址”去存取-edit-update-destroy-action"><a href="#Step-3-路人不应该也可以“直接输入网址”去存取-edit-update-destroy-action" class="headerlink" title="Step 3: 路人不应该也可以“直接输入网址”去存取 edit / update / destroy action"></a>Step 3: 路人不应该也可以“直接输入网址”去存取 edit / update / destroy action</h3><p>除了将按钮对路人隐藏外，我们还要考虑到一个情形，假设这个路人是知道 Rails 规则的，那么他可能输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:3000/groups/某笔数据的ID/edit</div></pre></td></tr></table></figure>
<p>网址，就直接可以编辑数据。</p>
<p>我们也要在 controller 做权限判断，滤掉这种人。</p>
<p>首先，我们先限定 edit / update / destroy 这三个操作动作，必须要是“登入”的使用者才能存取。</p>
<p>修改 app/controllers/groups_controller.rb 在 before_action :authenticate_user! 列表中，加入 :edit, :update, :destroy</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line">    before_action :authenticate_user! , only: [:new, :create, :edit, :update, :destroy]</div></pre></td></tr></table></figure>
<p>这样“没登录”的路人，就进不来了。但这只是第一步。</p>
<h3 id="Step-4-必须要是-group-拥有人，才能进入-edit，否则会被重导至首页，并显示错误信息。"><a href="#Step-4-必须要是-group-拥有人，才能进入-edit，否则会被重导至首页，并显示错误信息。" class="headerlink" title="Step 4: 必须要是 group 拥有人，才能进入 edit，否则会被重导至首页，并显示错误信息。"></a>Step 4: 必须要是 group 拥有人，才能进入 edit，否则会被重导至首页，并显示错误信息。</h3><p>修改 app/controllers/groups_controller.rb 加入权限，如果不是“创始者”去存取，会显示没有权限的错误信息。</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">def edit</div><div class="line">    @group = Group.find(params[:id])</div><div class="line"></div><div class="line">    if current_user != @group.user</div><div class="line">      redirect_to root_path, alert: &quot;You have no permission.&quot;</div><div class="line">    end</div><div class="line">  end</div></pre></td></tr></table></figure>
<p>这样当其他人，试图输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:3000/groups/某笔数据的ID/edit</div></pre></td></tr></table></figure>
<p>这样的网址，想要编辑数据，就会被挡住。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/GUSD10DsSIyiJpG2XDq8_Screenshot%20at%20Mar%2028%2014-49-58.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/GUSD10DsSIyiJpG2XDq8_Screenshot%20at%20Mar%2028%2014-49-58.png" alt="img"></a></p>
<h3 id="Step-5-依样画葫芦的把“权限检查”的代码，套用到-update-destroy-上"><a href="#Step-5-依样画葫芦的把“权限检查”的代码，套用到-update-destroy-上" class="headerlink" title="Step 5: 依样画葫芦的把“权限检查”的代码，套用到 update / destroy 上"></a>Step 5: 依样画葫芦的把“权限检查”的代码，套用到 update / destroy 上</h3><p>修改 app/controllers/groups_controller.rb 中的 update 与 destroy 部分。</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">def update</div><div class="line">   @group = Group.find(params[:id])</div><div class="line"></div><div class="line">   if current_user != @group.user</div><div class="line">     redirect_to root_path, alert: &quot;You have no permission.&quot;</div><div class="line">   end</div><div class="line"></div><div class="line">   if @group.update(group_params)</div><div class="line">     redirect_to groups_path, notice: &quot;Update Success&quot;</div><div class="line">   else</div><div class="line">     render :edit</div><div class="line">   end</div><div class="line"> end</div><div class="line"></div><div class="line"> def destroy</div><div class="line">   @group = Group.find(params[:id])</div><div class="line"></div><div class="line">   if current_user != @group.user</div><div class="line">     redirect_to root_path, alert: &quot;You have no permission.&quot;</div><div class="line">   end</div><div class="line">       </div><div class="line">   @group.destroy</div><div class="line">   redirect_to groups_path, alert: &quot;Group deleted&quot;</div><div class="line"> end</div></pre></td></tr></table></figure>
<h3 id="Step-6-git-存档-2"><a href="#Step-6-git-存档-2" class="headerlink" title="Step 6: git 存档"></a>Step 6: git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;check owner permission when access edit/update/destroy&quot;</code></p>
<h3 id="Step-7-制作-find-group-and-check-permission"><a href="#Step-7-制作-find-group-and-check-permission" class="headerlink" title="Step 7: 制作 find_group_and_check_permission"></a>Step 7: 制作 find_group_and_check_permission</h3><p>我们发现 edit、update、destroy 这三个 action 都有一样的代码，看起来有点冗。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@group = Group.find(params[:id])</div><div class="line"></div><div class="line">if current_user != @group.user</div><div class="line">  redirect_to root_path, alert: &quot;You have no permission.&quot;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>其实我们可以透过把它包装成一个函式的方式 find_group_and_check_permission 去省略这段冗余代码。</p>
<p>打开 app/controllers/groups_controller.rb 在 private 下，新增一个 find_group_and_check_permission</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">private</div><div class="line"></div><div class="line">  def find_group_and_check_permission</div><div class="line">    @group = Group.find(params[:id])</div><div class="line"></div><div class="line">    if current_user != @group.user</div><div class="line">      redirect_to root_path, alert: &quot;You have no permission.&quot;</div><div class="line">    end</div><div class="line">  end</div><div class="line"></div><div class="line">  def group_params</div><div class="line">    params.require(:group).permit(:title, :description)</div><div class="line">  end</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
<p>再修正 edit</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def edit</div><div class="line">    find_group_and_check_permission</div><div class="line">  end</div></pre></td></tr></table></figure>
<p>修正 update</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">def update</div><div class="line"></div><div class="line">    find_group_and_check_permission</div><div class="line"></div><div class="line">    if @group.update(group_params)</div><div class="line">      redirect_to groups_path, notice: &quot;Update Success&quot;</div><div class="line">    else</div><div class="line">      render :edit</div><div class="line">    end</div><div class="line">  end</div></pre></td></tr></table></figure>
<p>修正 destroy</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">def destroy</div><div class="line">   find_group_and_check_permission</div><div class="line">   </div><div class="line">   @group.destroy</div><div class="line">   redirect_to groups_path, alert: &quot;Group deleted&quot;</div><div class="line"> end</div></pre></td></tr></table></figure>
<h3 id="Step-8-把-find-group-and-check-permission-挂到-before-action"><a href="#Step-8-把-find-group-and-check-permission-挂到-before-action" class="headerlink" title="Step 8: 把 find_group_and_check_permission 挂到 before_action"></a>Step 8: 把 find_group_and_check_permission 挂到 before_action</h3><p>开发到这里你会发现一件事，find_group_and_check_permission 其实都是在这三个 action 的最前面开头执行的，所以你甚至可以这样写，把 find_group_and_check_permission 挂到 before_action</p>
<p>app/controllers/groups_controller.rb </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line"></div><div class="line">  before_action :authenticate_user! , only: [:new, :create, :edit, :update, :destroy]</div><div class="line">  before_action :find_group_and_check_permission, only: [:edit, :update, :destroy]</div></pre></td></tr></table></figure>
<p>然后再把 edit update destroy 里的 find_group_and_check_permission 砍掉。变成这样：</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">def edit</div><div class="line">  end</div><div class="line"></div><div class="line">  def update</div><div class="line">    if @group.update(group_params)</div><div class="line">      redirect_to groups_path, notice: &quot;Update Success&quot;</div><div class="line">    else</div><div class="line">      render :edit</div><div class="line">    end</div><div class="line">  end</div><div class="line"></div><div class="line">  def destroy</div><div class="line">    @group.destroy</div><div class="line">    redirect_to groups_path, alert: &quot;Group deleted&quot;</div><div class="line">  end</div></pre></td></tr></table></figure>
<h3 id="Step-9-git-存档"><a href="#Step-9-git-存档" class="headerlink" title="Step 9: git 存档"></a>Step 9: git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;use before_action to find_group_and_check_permission&quot;</code></p>
<h3 id="Step-10-修掉-show-里面的-Edit-按钮"><a href="#Step-10-修掉-show-里面的-Edit-按钮" class="headerlink" title="Step 10 : 修掉 show 里面的 Edit 按钮"></a>Step 10 : 修掉 show 里面的 Edit 按钮</h3><p>做到这里，我们还发现一个地方，我们漏了改，那就是 show.html.erb 上面，还有一个 Edit 按钮我们还没有拔掉。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rcnnjHjCSEewcX1gA6xG_Screenshot%20at%20Mar%2028%2015-03-21.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rcnnjHjCSEewcX1gA6xG_Screenshot%20at%20Mar%2028%2015-03-21.png" alt="img"></a></p>
<p>修改 app/views/groups/show.html.erb ，然后加入</p>
<p>加入 &lt;% if current_user &amp;&amp; current_user == @group.user %&gt; 的判断式</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/cbnKVjtaT1Cn9rz3mIQB_show_html_erb.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/cbnKVjtaT1Cn9rz3mIQB_show_html_erb.png" alt="img"></a></p>
<p>app/views/groups/show.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;group&quot;&gt;</div><div class="line">   &lt;% if current_user &amp;&amp; current_user == @group.user %&gt;</div><div class="line">     &lt;%= link_to(&quot;Edit&quot;, edit_group_path(@group), class: &quot;btn btn-primary pull-right&quot;)%&gt;</div><div class="line">   &lt;% end %&gt;</div><div class="line"> &lt;/div&gt;</div></pre></td></tr></table></figure>
<p>如此按钮就被修掉了。</p>
<h3 id="Step-11-git-存档"><a href="#Step-11-git-存档" class="headerlink" title="Step 11: git 存档"></a>Step 11: git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;add permission check on show page&quot;</code></p>
<h4 id="本节常见问题-6"><a href="#本节常见问题-6" class="headerlink" title="**本节常见问题"></a>**本节常见问题</h4><h5 id="与-与-他们三者是什么？"><a href="#与-与-他们三者是什么？" class="headerlink" title="= 与 == 与 != 他们三者是什么？"></a>= 与 == 与 != 他们三者是什么？</h5><ul>
<li><code>=</code> 是指派。<code>@groups = Group.all</code>，把 <code>Group.all</code> 数值 指派给 <code>@groups</code> 的意思。</li>
<li><p><code>==</code> “等于”</p>
</li>
<li><p><code>!=</code> “不等于”</p>
</li>
</ul>
<h1 id="6-1-本章目标"><a href="#6-1-本章目标" class="headerlink" title="6-1 本章目标"></a>6-1 本章目标</h1><h2 id="本章目标："><a href="#本章目标：" class="headerlink" title="本章目标："></a>本章目标：</h2><ul>
<li>可以在群组里面新增 / 编辑 / 删除文章</li>
<li>文章必须要有“内容”，否则不允许被发表</li>
</ul>
<h1 id="6-2-建立文章的架构"><a href="#6-2-建立文章的架构" class="headerlink" title="6-2 建立文章的架构"></a>6-2 建立文章的架构</h1><h2 id="目标-17"><a href="#目标-17" class="headerlink" title="目标"></a>目标</h2><p>在这一章，我们要带大家在群里面可以发文章。我们会完成以下事项：</p>
<ul>
<li>文章 Post 要有“内容”、“所属讨论群组”、“叙述”</li>
<li>发文网址是在 <a href="http://localhost:3000/groups/1/posts/new" target="_blank" rel="external">http://localhost:3000/groups/1/posts/new</a></li>
</ul>
<h2 id="步骤-13"><a href="#步骤-13" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-0-git-checkout-b-ch05"><a href="#Step-0-git-checkout-b-ch05" class="headerlink" title="Step 0. git checkout -b ch05"></a>Step 0. git checkout -b ch05</h3><p>因为我们现在要实作第五章的内容，新增一个 branch 把实作内容集中在 ch05 是比较合理的。将来回顾就可以比较清楚 在 ch05 我们做了哪一些练习。</p>
<p><code>git checkout -b ch05</code></p>
<h3 id="Step-1-设计-Post-的-model-架构"><a href="#Step-1-设计-Post-的-model-架构" class="headerlink" title="Step 1. 设计 Post 的 model 架构"></a>Step 1. 设计 Post 的 model 架构</h3><ul>
<li>文章内容要有“内容”、“所属讨论群组”、“叙述”</li>
<li>我们在这里要建立一个 model <strong>Post</strong>，并建立数据表 post 的三个栏位: content ( text 文字属性) 、group_id (integer 数字属性)、 user_id ( integer 数字属性）</li>
</ul>
<p><code>rails g model post content:text group_id:integer user_id:integer</code></p>
<p>将数据库建立起来，并执行 rake db:migrate</p>
<p><code>rake db:migrate</code></p>
<h3 id="Step-2-建立-Group-Post-User-三者间的关系"><a href="#Step-2-建立-Group-Post-User-三者间的关系" class="headerlink" title="Step 2. 建立 Group / Post / User 三者间的关系"></a>Step 2. 建立 Group / Post / User 三者间的关系</h3><ul>
<li>Group has_many posts</li>
</ul>
<p>app/models/group.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class Group &lt; ApplicationRecord</div><div class="line">  belongs_to :user</div><div class="line">  has_many :posts</div><div class="line">  validates :title, presence: true</div><div class="line">end</div></pre></td></tr></table></figure>
<ul>
<li>User has_many posts</li>
</ul>
<p>app/models/user.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class User &lt; ApplicationRecord</div><div class="line">  # Include default devise modules. Others available are:</div><div class="line"></div><div class="line">  # :confirmable, :lockable, :timeoutable and :omniauthable</div><div class="line"></div><div class="line">  devise :database_authenticatable, :registerable,</div><div class="line">         :recoverable, :rememberable, :trackable, :validatable</div><div class="line"></div><div class="line">  has_many :groups</div><div class="line">  has_many :posts</div><div class="line">end</div></pre></td></tr></table></figure>
<ul>
<li>Post belongs_to User</li>
<li>Post belongs_to Group</li>
</ul>
<p>app/models/post.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Post &lt; ApplicationRecord</div><div class="line">  belongs_to :user</div><div class="line">  belongs_to :group</div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="Step-3-git-存档-4"><a href="#Step-3-git-存档-4" class="headerlink" title="Step 3. git 存档"></a>Step 3. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;add post and hook group/user relation&quot;</code></p>
<h3 id="Step-4-建立-Post-Controller"><a href="#Step-4-建立-Post-Controller" class="headerlink" title="Step 4. 建立 Post Controller"></a>Step 4. 建立 Post Controller</h3><p><code>rails g controller posts</code></p>
<h3 id="Step-5-设立-routing"><a href="#Step-5-设立-routing" class="headerlink" title="Step 5. 设立 routing"></a>Step 5. 设立 routing</h3><p>修改 config/routes.rb</p>
<p>将 resources :posts 加入 resources :groups 内。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tDOcEw7QFyG41ktvz05g_posts_resources.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tDOcEw7QFyG41ktvz05g_posts_resources.png" alt="img"></a></p>
<p>config/routes.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Rails.application.routes.draw do</div><div class="line">  devise_for :users</div><div class="line">  resources :groups do</div><div class="line">    resources :posts</div><div class="line">  end</div><div class="line">  root &apos;groups#index&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>做了这件事后，执行</p>
<p><code>rake routes</code></p>
<p>然后你就会发现， routing 列表内产生了 /groups/:group_id/posts/new 这样的网址支援。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/QxlWwWQmR5yUvfzjxkeq_rake_routes.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/QxlWwWQmR5yUvfzjxkeq_rake_routes.png" alt="img"></a></p>
<h3 id="Step-6-git-存档-3"><a href="#Step-6-git-存档-3" class="headerlink" title="Step 6. git 存档"></a>Step 6. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;add posts nested route&quot;</code></p>
<h3 id="Step-7-在-groups-show-新增-“发表文章”按钮"><a href="#Step-7-在-groups-show-新增-“发表文章”按钮" class="headerlink" title="Step 7. 在 groups#show 新增 “发表文章”按钮"></a>Step 7. 在 groups#show 新增 “发表文章”按钮</h3><p>修改 app/views/groups/show.html.erb</p>
<p>然后加入一行</p>
<p>app/views/groups/show.html.erb</p>
<p><code>&lt;%= link_to(&quot;Write a Post&quot;, new_group_post_path(@group), class: &quot;btn btn-default pull-right&quot;)%&gt;</code></p>
<p>在权限判断的位置上面：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/IWovsg8Tz2uFiThPPdPj_show_html_erb_%E2%80%94__Users_xdite_Documents_projects_rails101.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/IWovsg8Tz2uFiThPPdPj_show_html_erb_%E2%80%94__Users_xdite_Documents_projects_rails101.png" alt="img"></a></p>
<p>我们就得到了一颗可以新增文章的按钮</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/OvoWNvU3QGCbEUDYlGAy_Screenshot%20at%20Mar%2028%2015-16-13.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/OvoWNvU3QGCbEUDYlGAy_Screenshot%20at%20Mar%2028%2015-16-13.png" alt="img"></a></p>
<h3 id="Step-8-git-存档"><a href="#Step-8-git-存档" class="headerlink" title="Step 8. git 存档"></a>Step 8. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;add post button&quot;</code></p>
<h1 id="6-3-实际发表文章"><a href="#6-3-实际发表文章" class="headerlink" title="6-3 实际发表文章"></a>6-3 实际发表文章</h1><h2 id="目标："><a href="#目标：" class="headerlink" title="目标："></a>目标：</h2><ul>
<li>实际把文章发在群里面</li>
<li>使用者可以在群里面看到文章一览表</li>
</ul>
<h2 id="步骤：-2"><a href="#步骤：-2" class="headerlink" title="步骤："></a>步骤：</h2><h3 id="Step-1-实作-new-create-action"><a href="#Step-1-实作-new-create-action" class="headerlink" title="Step 1: 实作 new / create action"></a>Step 1: 实作 new / create action</h3><p>新增 new 与 create action 在 posts_controller</p>
<p>app/controllers/posts_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">class PostsController &lt; ApplicationController</div><div class="line"></div><div class="line">  before_action :authenticate_user!, :only =&gt; [:new, :create]</div><div class="line"></div><div class="line">  def new</div><div class="line">    @group = Group.find(params[:group_id])</div><div class="line">    @post = Post.new</div><div class="line">  end</div><div class="line"></div><div class="line">  def create</div><div class="line">    @group = Group.find(params[:group_id])</div><div class="line">    @post = Post.new(post_params)</div><div class="line">    @post.group = @group</div><div class="line">    @post.user = current_user</div><div class="line"></div><div class="line">    if @post.save</div><div class="line">      redirect_to group_path(@group)</div><div class="line">    else</div><div class="line">      render :new</div><div class="line">    end</div><div class="line">  end</div><div class="line"></div><div class="line"></div><div class="line">  private</div><div class="line"></div><div class="line">  def post_params</div><div class="line">    params.require(:post).permit(:content)</div><div class="line">  end</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="Step-2-新增-app-views-posts-new-html-erb"><a href="#Step-2-新增-app-views-posts-new-html-erb" class="headerlink" title="Step 2. 新增 app/views/posts/new.html.erb"></a>Step 2. 新增 app/views/posts/new.html.erb</h3><p><code>touch app/views/posts/new.html.erb</code></p>
<p>app/views/posts/new.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;h2 class=&quot;text-center&quot;&gt;新增文章&lt;/h2&gt;</div><div class="line"></div><div class="line">&lt;div class=&quot;col-md-4 col-md-offset-4&quot;&gt;</div><div class="line">  &lt;%= simple_form_for [@group,@post] do |f| %&gt;</div><div class="line">    &lt;div class=&quot;form-group&quot;&gt;</div><div class="line">      &lt;%= f.input :content, input_html: &#123; class: &quot;form-control&quot;&#125; %&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;div class=&quot;form-actions&quot;&gt;</div><div class="line">      &lt;%= f.submit &quot;Submit&quot;, disable_with: &quot;Submiting...&quot;, class: &quot;btn btn-primary&quot;%&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>Step 3. 修改 groups_controller 中的 show action</p>
<p>修改 app/controllers/groups_controller.rb</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">def show</div><div class="line">    @group = Group.find(params[:id])</div><div class="line">    @posts = @group.posts</div><div class="line">  end</div></pre></td></tr></table></figure>
<h3 id="Step-4-修改-groups-show-html-erb"><a href="#Step-4-修改-groups-show-html-erb" class="headerlink" title="Step 4. 修改 groups/show.html.erb"></a>Step 4. 修改 groups/show.html.erb</h3><p>我们要修改 app/views/groups/show.html.erb，让文章能够显示出来，在&lt;%= @group.description %&gt;下，我们多加了一个表格做这件事。</p>
<p>app/views/groups/show.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">...（略）</div><div class="line">  &lt;p&gt;&lt;%= @group.description %&gt;&lt;/p&gt;</div><div class="line"></div><div class="line">+  &lt;table class=&quot;table&quot;&gt;</div><div class="line">+    &lt;thead&gt;</div><div class="line">+     &lt;tr&gt;</div><div class="line">+        &lt;th&gt;文章内容&lt;/th&gt;</div><div class="line">+        &lt;th&gt;发表者&lt;/th&gt;</div><div class="line">+        &lt;th&gt;发表时间&lt;/th&gt;</div><div class="line">+      &lt;/tr&gt;</div><div class="line">+    &lt;/thead&gt;</div><div class="line">+    &lt;tbody&gt;</div><div class="line">+      &lt;% @posts.each do |post| %&gt;</div><div class="line">+        &lt;tr&gt;</div><div class="line">+          &lt;td&gt;&lt;%= post.content %&gt;&lt;/td&gt;</div><div class="line">+          &lt;td&gt;&lt;%= post.user.email %&gt;&lt;/td&gt;</div><div class="line">+          &lt;td&gt;&lt;%= post.created_at %&gt;&lt;/td&gt;</div><div class="line">+        &lt;/tr&gt;</div><div class="line">+      &lt;% end %&gt;</div><div class="line">+    &lt;/tbody&gt;</div><div class="line">+  &lt;/table&gt;</div></pre></td></tr></table></figure>
<p>新增几笔文章试看看！</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/nFgVu94tTjutGJ7oJyTw_Screenshot%20at%20Mar%2028%2015-29-10.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/nFgVu94tTjutGJ7oJyTw_Screenshot%20at%20Mar%2028%2015-29-10.png" alt="img"></a></p>
<h3 id="Step-5-对-Post-加上-validation"><a href="#Step-5-对-Post-加上-validation" class="headerlink" title="Step 5: 对 Post 加上 validation"></a>Step 5: 对 Post 加上 validation</h3><p>这时候我们发现，刚刚有文章不小心没填内容，就发出去变成空的。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/EK40JBOhR064tFYsu7DS_Screenshot%20at%20Mar%2028%2015-29-33.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/EK40JBOhR064tFYsu7DS_Screenshot%20at%20Mar%2028%2015-29-33.png" alt="img"></a></p>
<p>为了防止这样的情形，我们还是要限制 post 的 content 要是为空，就不得送出。</p>
<p>修改 app/models/post.rb 加入 validates :content, presence: true</p>
<p>app/models/post.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">class Post &lt; ApplicationRecord</div><div class="line">  belongs_to :user</div><div class="line">  belongs_to :group</div><div class="line"></div><div class="line">  validates :content, presence: true</div><div class="line">    </div><div class="line">end</div></pre></td></tr></table></figure>
<p>之后要是再有使用者，送出空的内容，就会被挡下来。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/v4lsOfKGQHSEvtI2k5FQ_Screenshot%20at%20Mar%2028%2015-31-43.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/v4lsOfKGQHSEvtI2k5FQ_Screenshot%20at%20Mar%2028%2015-31-43.png" alt="img"></a></p>
<h3 id="Step-6-git-存档-4"><a href="#Step-6-git-存档-4" class="headerlink" title="Step 6. git 存档"></a>Step 6. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;implement post create function&quot;</code></p>
<h1 id="6-4-文章应该按照发表时间倒序排列"><a href="#6-4-文章应该按照发表时间倒序排列" class="headerlink" title="6-4 文章应该按照发表时间倒序排列"></a>6-4 文章应该按照发表时间倒序排列</h1><h2 id="目标-18"><a href="#目标-18" class="headerlink" title="目标"></a>目标</h2><ul>
<li>在文章列表上，应该让文章按照发表时间“倒序”排列，我们应该让最近发表的文章在“最上面”。</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/7v1Da1qnQNSVGtfqLfdC_Snip20170328_3.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/7v1Da1qnQNSVGtfqLfdC_Snip20170328_3.png" alt="img"></a></p>
<h2 id="步骤-14"><a href="#步骤-14" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-修改-groups-controller"><a href="#Step-1-修改-groups-controller" class="headerlink" title="Step 1. 修改 groups_controller"></a>Step 1. 修改 groups_controller</h3><p>修改 app/controllers/groups_controller.rb 的 show，让它最后长成以下样子：</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">def show</div><div class="line">    @group = Group.find(params[:id])</div><div class="line">    @posts = @group.posts.order(&quot;created_at DESC&quot;)</div><div class="line">  end</div></pre></td></tr></table></figure>
<p>重新刷新，看板列表就会变成，按照发表时间“倒序”排列</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xobRr8CRtyhziXjiL6ea_Snip20170328_1.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xobRr8CRtyhziXjiL6ea_Snip20170328_1.png" alt="img"></a></p>
<h3 id="Step-2-git-储存"><a href="#Step-2-git-储存" class="headerlink" title="Step 2. git 储存"></a>Step 2. git 储存</h3><p><code>git add .</code><br><code>git commit -m &quot;add order by created_at to group&#39;s post&quot;</code></p>
<h3 id="Step-3-使用-scope-替代直接-order"><a href="#Step-3-使用-scope-替代直接-order" class="headerlink" title="Step 3. 使用 scope 替代直接 order"></a>Step 3. 使用 scope 替代直接 order</h3><p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">def show</div><div class="line">    @group = Group.find(params[:id])</div><div class="line">    @posts = @group.posts.order(&quot;created_at DESC&quot;)</div><div class="line">  end</div></pre></td></tr></table></figure>
<p>这里的 order(“created_at DESC”) 是“程序语句”，但不是“功能叙述”。我们作为旁观者，只能猜测这是要按照“最近的时序排列”。</p>
<p>如果能改成 @group.posts.recent 可能在维护性上更直观。</p>
<p>这里我们还可以用 Rails 里面的一个内建 API scope 让代码更直观一些。 scope 可以用来包装一些查询式，如果我们这里想要让最后的代码变成 @group.posts.recent 的话，作法如下：</p>
<p>修改 app/models/post.rb，加入一行 scope :recent, -&gt; { order(“created_at DESC”)}</p>
<p>app/models/post.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">class Post &lt; ApplicationRecord</div><div class="line"></div><div class="line">    # ... 略</div><div class="line"></div><div class="line"></div><div class="line">  scope :recent, -&gt; &#123; order(&quot;created_at DESC&quot;)&#125;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>然后修改 app/controllers/groups_controller.rb 中的 show，变成</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">def show</div><div class="line">    @group = Group.find(params[:id])</div><div class="line">    @posts = @group.posts.recent</div><div class="line">  end</div></pre></td></tr></table></figure>
<p>这样就可以了。</p>
<h3 id="Step-4-git-储存-1"><a href="#Step-4-git-储存-1" class="headerlink" title="Step 4. git 储存"></a>Step 4. git 储存</h3><p><code>git add .</code><br><code>git commit -m &quot;using scope to write order by created_at to group&#39;s post&quot;</code></p>
<h2 id="解说"><a href="#解说" class="headerlink" title="解说"></a>解说</h2><h3 id="order-“created-at-DESC”-是什么？"><a href="#order-“created-at-DESC”-是什么？" class="headerlink" title="order(“created_at DESC”) 是什么？"></a>order(“created_at DESC”) 是什么？</h3><p>实际上呢，Model 里面的所有语句，看起来是“Ruby 语句”，实际上是 Rails 帮我们“翻译”成为了数据库语句。（这一套叫 ActiveRecord 框架）</p>
<p>如果有兴趣的话，Rails 的 Log 都有显示的。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/vfnLMIZHRNOCmePjLYcE_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%881.41.16.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/vfnLMIZHRNOCmePjLYcE_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%881.41.16.png" alt="img"></a></p>
<p>比如说：</p>
<p>Post.all 真正的数据库语句是 SELECT “posts”.<em> FROM “posts”<br>@group.posts.order(“created_at DESC”) 是 SELECT “posts”.</em> FROM “posts” WHERE “posts”.”group_id” = ? ORDER BY created_at DESC</p>
<p>因为数据库语句也是个“巨坑”，Rails 开发的目的，在于希望程序员专注于“产品”的逻辑设计，而花上少一点时间去纠缠非常底层的细节。</p>
<p>在刚开始学习过程中，其实你是不太需要去纠结数据库语句的，大部份你想要捞的数据，ActiveRecord 都能帮你搞定，而且可以“形容”的非常“口语”。</p>
<h3 id="scope-又是什么呢？"><a href="#scope-又是什么呢？" class="headerlink" title="scope 又是什么呢？"></a>scope 又是什么呢？</h3><p>你可以想像成，拿来包装“常用 query”的方法。理解到这里就可以了。</p>
<p>更多 scope 的用法：<a href="http://guides.rubyonrails.org/active_record_querying.html" target="_blank" rel="external">http://guides.rubyonrails.org/active_record_querying.html</a></p>
<h1 id="6-5-加入文章分页功能"><a href="#6-5-加入文章分页功能" class="headerlink" title="6-5 加入文章分页功能"></a>6-5 加入文章分页功能</h1><h2 id="目标-19"><a href="#目标-19" class="headerlink" title="目标"></a>目标</h2><ul>
<li>为文章列表加入分页功能。</li>
<li>一页 5 篇文章。</li>
</ul>
<h2 id="步骤-15"><a href="#步骤-15" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-安装-will-paginate"><a href="#Step-1-安装-will-paginate" class="headerlink" title="Step 1: 安装 will_paginate"></a>Step 1: 安装 will_paginate</h3><p>Rails 社群内有很多“分页”功能的 gem 可以办到这件事，其中最热门的 gem 叫 <strong>will_paginate</strong>，使用这些 gem ，一下子就会把功能做完了。</p>
<p>修改 Gemfile，加入 will_paginate,</p>
<p>gem ‘will_paginate’</p>
<p>Gemfile</p>
<p><code>gem &#39;will_paginate&#39;</code></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/EUQGOyRtTUqA7Dd2SX4T_Screenshot%20at%20Feb%2020%2016-23-44.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/EUQGOyRtTUqA7Dd2SX4T_Screenshot%20at%20Feb%2020%2016-23-44.png" alt="img"></a></p>
<p>然后执行</p>
<p><code>bundle install</code></p>
<p>然后重开 <code>rails server</code></p>
<h3 id="Step-2-修改-groups-controller"><a href="#Step-2-修改-groups-controller" class="headerlink" title="Step 2: 修改 groups_controller"></a>Step 2: 修改 groups_controller</h3><p>修改 app/controllers/groups_controller.rb 中的 show</p>
<p>加入分页代码，变成</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">def show</div><div class="line">    @group = Group.find(params[:id])</div><div class="line">    @posts = @group.posts.recent.paginate(:page =&gt; params[:page], :per_page =&gt; 5)</div><div class="line">  end</div></pre></td></tr></table></figure>
<h3 id="Step-3-修改-groups-show-html-erb"><a href="#Step-3-修改-groups-show-html-erb" class="headerlink" title="Step 3: 修改 groups/show.html.erb"></a>Step 3: 修改 groups/show.html.erb</h3><p>修改 app/views/groups/show.html.erb 在最下面 <code>&lt;/table&gt;</code> 下加入以下三行代码：</p>
<p>app/views/groups/show.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> &lt;/tbody&gt;</div><div class="line">&lt;/table&gt;</div><div class="line"></div><div class="line">+    &lt;div class=&quot;text-center&quot;&gt;</div><div class="line">+      &lt;%= will_paginate @posts %&gt;</div><div class="line">+    &lt;/div&gt;</div></pre></td></tr></table></figure>
<p>如果你的群组内，超过 5 篇文章（现在就去新增！！），就可以看到分页功能出现了。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/e8a4IxvSTki9XhQpz7WM_Screenshot%20at%20Mar%2028%2015-52-20.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/e8a4IxvSTki9XhQpz7WM_Screenshot%20at%20Mar%2028%2015-52-20.png" alt="img"></a></p>
<h3 id="Step-4-git-储存-2"><a href="#Step-4-git-储存-2" class="headerlink" title="Step 4: git 储存"></a>Step 4: git 储存</h3><p><code>git add .</code><br><code>git commit -m &quot;implement posts pagination with will_paginate&quot;</code></p>
<h4 id="本节常见问题-7"><a href="#本节常见问题-7" class="headerlink" title="**本节常见问题"></a>**本节常见问题</h4><h5 id="要去哪里才能知道，我想要的功能要用什么-gem-呢？"><a href="#要去哪里才能知道，我想要的功能要用什么-gem-呢？" class="headerlink" title="要去哪里才能知道，我想要的功能要用什么 gem 呢？"></a>要去哪里才能知道，我想要的功能要用什么 gem 呢？</h5><p>*各种功能的gem一览： <a href="https://www.ruby-toolbox.com/" target="_blank" rel="external">“RubyToolbox”</a></p>
<h1 id="7-1-本章目标"><a href="#7-1-本章目标" class="headerlink" title="7-1 本章目标"></a>7-1 本章目标</h1><h2 id="本章目标：-1"><a href="#本章目标：-1" class="headerlink" title="本章目标："></a>本章目标：</h2><ul>
<li>一个使用者可以选择“加入”、“退出”讨论群</li>
<li>群的创始者，创群一开始就应该加在群组里</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/qm7JgV4oT8WUvDozSpAx_Screenshot%20at%20Mar%2028%2016-37-16.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/qm7JgV4oT8WUvDozSpAx_Screenshot%20at%20Mar%2028%2016-37-16.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WhsIyCkUSuigRDg5nJZw_Screenshot%20at%20Mar%2028%2016-37-37.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WhsIyCkUSuigRDg5nJZw_Screenshot%20at%20Mar%2028%2016-37-37.png" alt="img"></a></p>
<h1 id="7-2-建立“群成员”数据表"><a href="#7-2-建立“群成员”数据表" class="headerlink" title="7-2 建立“群成员”数据表"></a>7-2 建立“群成员”数据表</h1><h2 id="目标-20"><a href="#目标-20" class="headerlink" title="目标"></a>目标</h2><ul>
<li>建立群成员的关系表</li>
</ul>
<h2 id="步骤-16"><a href="#步骤-16" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-0-git-checkout-b-ch06"><a href="#Step-0-git-checkout-b-ch06" class="headerlink" title="Step 0. git checkout -b ch06"></a>Step 0. git checkout -b ch06</h3><p>因为我们现在要实作第六章的内容，新增一个 branch 把实作内容集中在 ch06 是比较合理的。将来回顾就可以比较清楚 在 ch06 我们做了哪一些练习。</p>
<p><code>git checkout -b ch06</code></p>
<h3 id="Step-1-建立-GroupRelationship"><a href="#Step-1-建立-GroupRelationship" class="headerlink" title="Step 1: 建立 GroupRelationship"></a>Step 1: 建立 GroupRelationship</h3><p>我们在这里要建立一个新的 model 叫 GroupRelationship。这个数据表里面只有两个栏位：</p>
<ul>
<li>group_id ( integer )</li>
<li>user_id ( integer)</li>
</ul>
<p>记录了“谁”参加了“哪个群组”。</p>
<p>输入</p>
<p><code>rails g model group_relationship group_id:integer user_id:integer</code></p>
<p>执行</p>
<p><code>rake db:migrate</code></p>
<h3 id="Step-2-设定-Group-与-User-之间的关系-使用者参与的所有群）"><a href="#Step-2-设定-Group-与-User-之间的关系-使用者参与的所有群）" class="headerlink" title="Step 2: 设定 Group 与 User 之间的关系 ( 使用者参与的所有群）"></a>Step 2: 设定 Group 与 User 之间的关系 ( 使用者参与的所有群）</h3><p>在这之前，在 User model 已经有一行：has_many :groups</p>
<p>app/models/user.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">class User &lt; ApplicationRecord</div><div class="line"></div><div class="line"># .. 略</div><div class="line"></div><div class="line">  has_many :groups</div><div class="line"># .. 略</div><div class="line"></div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
<p>user.groups 会捞出这个使用者“创造过的所有群”。那我们要如何撰写 “参与的所有群”呢？</p>
<p>首先，修改 app/models/user.rb 加入以下两行</p>
<p>app/models/user.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class User &lt; ApplicationRecord</div><div class="line"></div><div class="line"># .. 略</div><div class="line"></div><div class="line"></div><div class="line">+  has_many :group_relationships</div><div class="line">+  has_many :participated_groups, :through =&gt; :group_relationships, :source =&gt; :group</div><div class="line">end</div></pre></td></tr></table></figure>
<p>然后修改 app/models/group_relationship.rb，加入这两行</p>
<p>app/models/group_relationship.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class GroupRelationship &lt; ApplicationRecord</div><div class="line">+  belongs_to :group</div><div class="line">+  belongs_to :user</div><div class="line">end</div></pre></td></tr></table></figure>
<p>“参与的所有群”。</p>
<h3 id="Step-3-设定-Group-与-User-之间的关系-群组内的所有会员-）"><a href="#Step-3-设定-Group-与-User-之间的关系-群组内的所有会员-）" class="headerlink" title="Step 3: 设定 Group 与 User 之间的关系 ( 群组内的所有会员 ）"></a>Step 3: 设定 Group 与 User 之间的关系 ( 群组内的所有会员 ）</h3><p>修改 app/models/group.rb，加入这两行</p>
<p>app/models/group.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class Group &lt; ApplicationRecord</div><div class="line"></div><div class="line">    # ... 略</div><div class="line"></div><div class="line">  </div><div class="line">+  has_many :group_relationships</div><div class="line">+  has_many :members, through: :group_relationships, source: :user</div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="Step-4-动手测看看"><a href="#Step-4-动手测看看" class="headerlink" title="Step 4: 动手测看看"></a>Step 4: 动手测看看</h3><p>打开 <code>rails console</code></p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">u = User.first</div><div class="line">g = Group.first</div><div class="line">g.members &lt;&lt; u</div><div class="line">g.members</div><div class="line">u.participated_groups</div></pre></td></tr></table></figure>
<p>看看会出现什么结果。<br>最后执行<code>exit</code>退出</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hTViiKFRQq2Sv3tOELHu_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-12%20%E4%B8%8B%E5%8D%885.22.33.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hTViiKFRQq2Sv3tOELHu_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-12%20%E4%B8%8B%E5%8D%885.22.33.png" alt="img"></a></p>
<h3 id="Step-5-git-储存"><a href="#Step-5-git-储存" class="headerlink" title="Step 5: git 储存"></a>Step 5: git 储存</h3><p><code>git add .</code><br><code>git commit -m &quot;implement group relation&quot;</code></p>
<h1 id="7-3-在群组里面判断“是否群组成员”实作"><a href="#7-3-在群组里面判断“是否群组成员”实作" class="headerlink" title="7-3 在群组里面判断“是否群组成员”实作"></a>7-3 在群组里面判断“是否群组成员”实作</h1><h2 id="目标-21"><a href="#目标-21" class="headerlink" title="目标"></a>目标</h2><ul>
<li>会员要可以在社团里面看到自己“是否群组成员”</li>
</ul>
<h2 id="步骤-17"><a href="#步骤-17" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-在-user-model-内实作判断式“是否为群组的一分子”"><a href="#Step-1-在-user-model-内实作判断式“是否为群组的一分子”" class="headerlink" title="Step 1. 在 user model 内实作判断式“是否为群组的一分子”"></a>Step 1. 在 user model 内实作判断式“是否为群组的一分子”</h3><p>让我们修改 app/models/user.rb ，在最后一个end的上面加入这一段 is_member_of?(group)</p>
<p>app/models/user.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class User &lt; ApplicationRecord</div><div class="line">  # 略 ...</div><div class="line"></div><div class="line">  </div><div class="line">+    def is_member_of?(group)</div><div class="line">+      participated_groups.include?(group)</div><div class="line">+    end</div><div class="line">  end</div></pre></td></tr></table></figure>
<p>然后“重开”<code>rails console</code></p>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">u = User.first</div><div class="line">g = Group.first</div><div class="line">u.is_member_of?(g)</div></pre></td></tr></table></figure>
<p>结果会是这样：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DSzAOnmYT86HMFtQov0t_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-12%20%E4%B8%8B%E5%8D%885.55.56.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DSzAOnmYT86HMFtQov0t_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-12%20%E4%B8%8B%E5%8D%885.55.56.png" alt="img"></a></p>
<p>运行 <code>exit</code> 退出console</p>
<p>我们等一下将会使用 is_member_of?(group)来判断“这个使用者是否属于该群组”</p>
<h3 id="Step-2-修改-groups-show-html-erb"><a href="#Step-2-修改-groups-show-html-erb" class="headerlink" title="Step 2. 修改 groups/show.html.erb"></a>Step 2. 修改 groups/show.html.erb</h3><p>我们在 app/views/groups/show.html.erb 加入这一段</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tJ7ki5CfSFWHxNUxJYWX_show_html_erb_%E2%80%94__Users_xdite_projects_rails101.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/tJ7ki5CfSFWHxNUxJYWX_show_html_erb_%E2%80%94__Users_xdite_projects_rails101.png" alt="img"></a></p>
<p>app/views/groups/show.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;span class=&quot;pull-right&quot;&gt;</div><div class="line">  &lt;% if current_user &amp;&amp; current_user.is_member_of?(@group) %&gt;</div><div class="line">    &lt;label class=&quot;label label-success&quot;&gt; 群组成员 &lt;/label&gt;</div><div class="line">  &lt;% else %&gt;</div><div class="line">    &lt;label class=&quot;label label-warning&quot;&gt; 不是群组成员 &lt;/label&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;/span&gt;</div></pre></td></tr></table></figure>
<p>你应该只会看到这两种结果</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/GLfoZDC2Tdqw4VW1lO1u_Screenshot%20at%20Feb%2024%2019-39-26.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/GLfoZDC2Tdqw4VW1lO1u_Screenshot%20at%20Feb%2024%2019-39-26.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DWwg5WhCT9ylag9ZKvaR_Screenshot%20at%20Feb%2024%2019-38-35.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/DWwg5WhCT9ylag9ZKvaR_Screenshot%20at%20Feb%2024%2019-38-35.png" alt="img"></a></p>
<h3 id="Step-3-git-存档-5"><a href="#Step-3-git-存档-5" class="headerlink" title="Step 3. git 存档"></a>Step 3. git 存档</h3><p><code>git add .</code><br><code>git commit -m &quot;implement is_member_of?(group)&quot;</code></p>
<h4 id="本节常见问题-8"><a href="#本节常见问题-8" class="headerlink" title="**本节常见问题"></a>**本节常见问题</h4><h5 id="is-member-of-group-为什么这一段要放在-User-的-model-里？"><a href="#is-member-of-group-为什么这一段要放在-User-的-model-里？" class="headerlink" title="is_member_of?(group) 为什么这一段要放在 User 的 model 里？"></a>is_member_of?(group) 为什么这一段要放在 User 的 model 里？</h5><ul>
<li>因为它是要被 <code>user</code> 所使用的判断式</li>
</ul>
<h5 id="“-”问号在这里有任何意义吗？"><a href="#“-”问号在这里有任何意义吗？" class="headerlink" title="“?”问号在这里有任何意义吗？"></a>“?”问号在这里有任何意义吗？</h5><p>你可以暂时把它视为 “method 名字的一部分”，“暂时”没有意义。</p>
<h1 id="7-4-“加入群组”或“退出群组”"><a href="#7-4-“加入群组”或“退出群组”" class="headerlink" title="7-4 “加入群组”或“退出群组”"></a>7-4 “加入群组”或“退出群组”</h1><h2 id="目标-22"><a href="#目标-22" class="headerlink" title="目标"></a>目标</h2><ul>
<li>实作 model 层 “加入群组”</li>
<li>实作 model 层“退出群组”</li>
</ul>
<h2 id="步骤-18"><a href="#步骤-18" class="headerlink" title="步骤"></a>步骤</h2><h3 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤 1:"></a>步骤 1:</h3><p>app/models/user.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">def join!(group)</div><div class="line">    participated_groups &lt;&lt; group</div><div class="line">  end</div><div class="line"></div><div class="line">  def quit!(group)</div><div class="line">    participated_groups.delete(group)</div><div class="line">  end</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/pIO8ANXRS5i8lSjufnhg_step1.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/pIO8ANXRS5i8lSjufnhg_step1.png" alt="img"></a></p>
<p>打开 <code>rails console</code></p>
<p>输入</p>
<ul>
<li><code>u = User.first</code></li>
<li><code>g = Group.first</code></li>
<li><code>u.join!(g)</code></li>
<li><code>u.is_member_of?(g)</code></li>
<li><code>u.quit!(g)</code></li>
<li><code>u.is_member_of?(g)</code></li>
<li><code>exit</code></li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/JY4GDh1fT2KmOZs7QczT_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-12%20%E4%B8%8B%E5%8D%886.16.38.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/JY4GDh1fT2KmOZs7QczT_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-12%20%E4%B8%8B%E5%8D%886.16.38.png" alt="img"></a></p>
<h3 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤 2:"></a>步骤 2:</h3><p><code>git add .</code><br><code>git commit -m &quot;join or quit group&quot;</code></p>
<h1 id="7-5-实际操作“加入群组”或“退出群组”"><a href="#7-5-实际操作“加入群组”或“退出群组”" class="headerlink" title="7-5 实际操作“加入群组”或“退出群组”"></a>7-5 实际操作“加入群组”或“退出群组”</h1><h2 id="步骤-19"><a href="#步骤-19" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1:"></a>Step 1:</h3><p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">+  def join</div><div class="line">+   @group = Group.find(params[:id])</div><div class="line">+  </div><div class="line">+    if !current_user.is_member_of?(@group)</div><div class="line">+      current_user.join!(@group)</div><div class="line">+      flash[:notice] = &quot;加入本讨论版成功！&quot;</div><div class="line">+    else</div><div class="line">+      flash[:warning] = &quot;你已经是本讨论版成员了！&quot;</div><div class="line">+    end</div><div class="line">+  </div><div class="line">+    redirect_to group_path(@group)</div><div class="line">+  end</div><div class="line">+  </div><div class="line">+  def quit</div><div class="line">+    @group = Group.find(params[:id])</div><div class="line">+  </div><div class="line">+    if current_user.is_member_of?(@group)</div><div class="line">+      current_user.quit!(@group)</div><div class="line">+      flash[:alert] = &quot;已退出本讨论版！&quot;</div><div class="line">+    else</div><div class="line">+      flash[:warning] = &quot;你不是本讨论版成员，怎么退出 XD&quot;</div><div class="line">+    end</div><div class="line">+  </div><div class="line">+    redirect_to group_path(@group)</div><div class="line">+  end</div><div class="line"></div><div class="line">    private</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/8TThycVyTRuE7r434HgM_step1.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/8TThycVyTRuE7r434HgM_step1.png" alt="img"></a></p>
<p>加入与退出群组必须要是登入状态下才行，修改位於第二行的 <code>before_action</code> ，加入 join 和 quit 也需要验证</p>
<p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class GroupsController &lt; ApplicationController</div><div class="line">-  before_action :authenticate_user! , only: [:new, :create, :edit, :update, :destroy]</div><div class="line">+  before_action :authenticate_user! , only: [:new, :create, :edit, :update, :destroy, :join, :quit]</div><div class="line"></div><div class="line">...</div><div class="line">...</div></pre></td></tr></table></figure>
<p>Step 2:</p>
<p>config/routes.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">resources :groups do</div><div class="line">+    member do</div><div class="line">+      post :join</div><div class="line">+      post :quit</div><div class="line">+    end</div><div class="line"></div><div class="line">    resources :posts</div><div class="line">  end</div></pre></td></tr></table></figure>
<p><a href="http://ww4.sinaimg.cn/large/006tNbRwjw1fat1hvbvpxj30i30ekabc.jpg" target="_blank" rel="external"><img src="http://ww4.sinaimg.cn/large/006tNbRwjw1fat1hvbvpxj30i30ekabc.jpg" alt="img"></a></p>
<h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3:"></a>Step 3:</h3><p>加入两行代码，将这个文件修改成这样：</p>
<p>app/views/groups/show.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;span class=&quot;pull-right&quot;&gt;</div><div class="line">  &lt;% if current_user &amp;&amp; current_user.is_member_of?(@group) %&gt;</div><div class="line">    &lt;label class=&quot;label label-success&quot;&gt; 群组成员 &lt;/label&gt;</div><div class="line">+        &lt;%= link_to(&quot;Quit Group&quot;, quit_group_path(@group), method: :post, class: &quot;btn btn-default&quot;) %&gt;</div><div class="line">  &lt;% else %&gt;</div><div class="line">    &lt;label class=&quot;label label-warning&quot;&gt; 不是群组成员 &lt;/label&gt;</div><div class="line">+        &lt;%= link_to(&quot;Join Group&quot;, join_group_path(@group), method: :post, class: &quot;btn btn-default&quot;) %&gt;</div><div class="line">  &lt;% end %&gt;</div><div class="line">&lt;/span&gt;</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/qm7JgV4oT8WUvDozSpAx_Screenshot%20at%20Mar%2028%2016-37-16.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/qm7JgV4oT8WUvDozSpAx_Screenshot%20at%20Mar%2028%2016-37-16.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WhsIyCkUSuigRDg5nJZw_Screenshot%20at%20Mar%2028%2016-37-37.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WhsIyCkUSuigRDg5nJZw_Screenshot%20at%20Mar%2028%2016-37-37.png" alt="img"></a></p>
<h3 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4:"></a>Step 4:</h3><p><code>git add .</code><br><code>git commit -m &quot;join &amp; quit group action&quot;</code></p>
<h1 id="7-6-User-在建立-group-后自动成为-group-的一员"><a href="#7-6-User-在建立-group-后自动成为-group-的一员" class="headerlink" title="7-6 User 在建立 group 后自动成为 group 的一员"></a>7-6 User 在建立 group 后自动成为 group 的一员</h1><h2 id="目标-23"><a href="#目标-23" class="headerlink" title="目标"></a>目标</h2><p>当你创办了 group ，却还要手动再加入这个 group 不会很怪吗？ XD<br>所以在这个步骤我们让 User 在建立 group 后自动成为 group 的一员</p>
<h2 id="步骤-20"><a href="#步骤-20" class="headerlink" title="步骤"></a>步骤</h2><h2 id="Step-1-1"><a href="#Step-1-1" class="headerlink" title="Step 1 :"></a>Step 1 :</h2><p>app/controllers/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">def create</div><div class="line">    @group = Group.new(group_params)</div><div class="line">    @group.user = current_user</div><div class="line">    if @group.save</div><div class="line">+     current_user.join!(@group)</div><div class="line">      redirect_to groups_path</div><div class="line">    else</div><div class="line">      render :new</div><div class="line">    end</div><div class="line"></div><div class="line">  end</div></pre></td></tr></table></figure>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2:"></a>Step 2:</h3><p><code>git add .</code><br><code>git commit -m &quot;when created a group, join it automatically&quot;</code></p>
<h1 id="8-1-本章目标"><a href="#8-1-本章目标" class="headerlink" title="8-1 本章目标"></a>8-1 本章目标</h1><h2 id="目标-24"><a href="#目标-24" class="headerlink" title="目标"></a>目标</h2><ul>
<li>新增一个下拉选单</li>
<li>可以看到自己过去曾经发表的文章</li>
<li>可以看到自己过去曾经参与的社团</li>
</ul>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/euudzpTdaCt2yOzapOHA_Screenshot%20at%20Feb%2024%2020-17-13.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/euudzpTdaCt2yOzapOHA_Screenshot%20at%20Feb%2024%2020-17-13.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/MKi6K2blReyF0gswiy3b_Screenshot%20at%20Feb%2024%2020-17-30.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/MKi6K2blReyF0gswiy3b_Screenshot%20at%20Feb%2024%2020-17-30.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/yd6feSlRWk2yPR2RshPQ_Screenshot%20at%20Feb%2024%2020-18-02.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/yd6feSlRWk2yPR2RshPQ_Screenshot%20at%20Feb%2024%2020-18-02.png" alt="img"></a></p>
<h1 id="8-2-可以看到自己参与的所有群组"><a href="#8-2-可以看到自己参与的所有群组" class="headerlink" title="8-2 可以看到自己参与的所有群组"></a>8-2 可以看到自己参与的所有群组</h1><h2 id="目标-25"><a href="#目标-25" class="headerlink" title="目标"></a>目标</h2><ul>
<li>使用者在下拉选单内，可以看到 “My Groups”</li>
<li>使用者点选 “My Groups” 可以看到自己参与的所有群组</li>
</ul>
<h2 id="步骤-21"><a href="#步骤-21" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-0-git-checkout-b-ch07"><a href="#Step-0-git-checkout-b-ch07" class="headerlink" title="Step 0. git checkout -b ch07"></a>Step 0. git checkout -b ch07</h3><p>因为我们现在要实作第七章的内容，新增一个 branch 把实作内容集中在 ch07 是比较合理的。将来回顾就可以比较清楚 在 ch07 我们做了哪一些练习。</p>
<p><code>git checkout -b ch07</code></p>
<h3 id="Step-1-产生-account-的-namespace-下的-groups-controller"><a href="#Step-1-产生-account-的-namespace-下的-groups-controller" class="headerlink" title="Step 1: 产生 account 的 namespace 下的 groups_controller"></a>Step 1: 产生 account 的 namespace 下的 groups_controller</h3><p>执行</p>
<p><code>rails g controller account/groups</code></p>
<h3 id="Step-2-修改-routing"><a href="#Step-2-修改-routing" class="headerlink" title="Step 2. 修改 routing"></a>Step 2. 修改 routing</h3><p>修改 config/routes.rb 加入：</p>
<p>config/routes.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">namespace :account do</div><div class="line">    resources :groups</div><div class="line">  end</div></pre></td></tr></table></figure>
<p><a href="http://ww4.sinaimg.cn/large/006tNbRwjw1faswmyfo4fj30la0h1dih.jpg" target="_blank" rel="external"><img src="http://ww4.sinaimg.cn/large/006tNbRwjw1faswmyfo4fj30la0h1dih.jpg" alt="img"></a></p>
<h3 id="Step-3-修改下拉选项"><a href="#Step-3-修改下拉选项" class="headerlink" title="Step 3: 修改下拉选项"></a>Step 3: 修改下拉选项</h3><p>然后修改 app/views/common/_navbar.html.erb</p>
<p>在“下拉选单选项”中多加入一个My Groups：</p>
<p>app/views/common/_navbar.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;ul class=&quot;dropdown-menu&quot;&gt;</div><div class="line">+    &lt;li&gt; &lt;%= link_to(&quot;My Groups&quot;, account_groups_path) %&gt;&lt;/li&gt;</div><div class="line">+    &lt;li class=&quot;divider&quot;&gt; &lt;/li&gt;</div><div class="line">     &lt;li&gt; &lt;%= link_to(&quot;退出&quot;, destroy_user_session_path, method: :delete) %&gt; &lt;/li&gt;</div><div class="line">   &lt;/ul&gt;</div></pre></td></tr></table></figure>
<p>成果就会长这样：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/dXEwIjORuWVaCSgz9l17_Screenshot%20at%20Feb%2024%2019-54-56.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/dXEwIjORuWVaCSgz9l17_Screenshot%20at%20Feb%2024%2019-54-56.png" alt="img"></a></p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/mrqvDb7Q0yFfhFrDH9w4_Screenshot%20at%20Feb%2024%2019-56-35.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/mrqvDb7Q0yFfhFrDH9w4_Screenshot%20at%20Feb%2024%2019-56-35.png" alt="img"></a></p>
<h3 id="Step-4-建立-account-groups-controller-rb-下的-index-action"><a href="#Step-4-建立-account-groups-controller-rb-下的-index-action" class="headerlink" title="Step 4. 建立 account/groups_controller.rb 下的 index action"></a>Step 4. 建立 account/groups_controller.rb 下的 index action</h3><p>记得要加入： before_action :authenticate_user!，限制必须要得登录使用者，才能看。</p>
<p>app/controllers/account/groups_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">class Account::GroupsController &lt; ApplicationController</div><div class="line">  before_action :authenticate_user!</div><div class="line"></div><div class="line">  def index</div><div class="line">    @groups = current_user.participated_groups</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<h3 id="Step-5-新增-“参与群组一览表”"><a href="#Step-5-新增-“参与群组一览表”" class="headerlink" title="Step 5. 新增 “参与群组一览表”"></a>Step 5. 新增 “参与群组一览表”</h3><p><code>touch app/views/account/groups/index.html.erb</code></p>
<p>app/views/account/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line"></div><div class="line">  &lt;h2 class=&quot;text-center&quot;&gt; 我加入的讨论版 &lt;/h2&gt;</div><div class="line"></div><div class="line">  &lt;table class=&quot;table&quot;&gt;</div><div class="line">    &lt;thead&gt;</div><div class="line">      &lt;tr&gt;</div><div class="line">        &lt;th&gt; # &lt;/th&gt;</div><div class="line">        &lt;th&gt; Title &lt;/th&gt;</div><div class="line">        &lt;th&gt; Description &lt;/th&gt;</div><div class="line">        &lt;th&gt; Post Count &lt;/th&gt;</div><div class="line">        &lt;th&gt; Last Update &lt;/th&gt;</div><div class="line">      &lt;/tr&gt;</div><div class="line">    &lt;/thead&gt;</div><div class="line"></div><div class="line">    &lt;tbody&gt;</div><div class="line">      &lt;% @groups.each do |group| %&gt;</div><div class="line">        &lt;tr&gt;</div><div class="line">          &lt;td&gt; # &lt;/td&gt;</div><div class="line">          &lt;td&gt; &lt;%= link_to(group.title, group_path(group)) %&gt; &lt;/td&gt;</div><div class="line">          &lt;td&gt; &lt;%= group.description %&gt; &lt;/td&gt;</div><div class="line">          &lt;td&gt; &lt;%= group.posts.count %&gt; &lt;/td&gt;</div><div class="line">          &lt;td&gt; &lt;%= group.updated_at %&gt; &lt;/td&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">      &lt;% end %&gt;</div><div class="line">    &lt;/tbody&gt;</div><div class="line">  &lt;/table&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>成果：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/M9hk6bvQRIaGStPovdQF_Screenshot%20at%20Feb%2024%2020-05-47.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/M9hk6bvQRIaGStPovdQF_Screenshot%20at%20Feb%2024%2020-05-47.png" alt="img"></a></p>
<h3 id="Step-6-git-储存"><a href="#Step-6-git-储存" class="headerlink" title="Step 6: git 储存"></a>Step 6: git 储存</h3><p><code>git add .</code><br><code>git commit -m &quot;implement my groups&quot;</code></p>
<h1 id="8-3-可以看到自己发表的所有文章"><a href="#8-3-可以看到自己发表的所有文章" class="headerlink" title="8-3 可以看到自己发表的所有文章"></a>8-3 可以看到自己发表的所有文章</h1><h2 id="目标-26"><a href="#目标-26" class="headerlink" title="目标"></a>目标</h2><ul>
<li>使用者在下拉选单内，可以看到 “My Posts”</li>
<li>使用者点选 “My Posts” 可以看到自己发表的所有文章</li>
</ul>
<h2 id="步骤-22"><a href="#步骤-22" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-产生-account-的-namespace-下的-posts-controller"><a href="#Step-1-产生-account-的-namespace-下的-posts-controller" class="headerlink" title="Step 1: 产生 account 的 namespace 下的 posts_controller"></a>Step 1: 产生 account 的 namespace 下的 posts_controller</h3><p>执行</p>
<p><code>rails g controller account/posts</code></p>
<h3 id="Step-2-建立-account-posts-controller-rb-下的-index-action"><a href="#Step-2-建立-account-posts-controller-rb-下的-index-action" class="headerlink" title="Step 2. 建立 account/posts_controller.rb 下的 index action"></a>Step 2. 建立 account/posts_controller.rb 下的 index action</h3><p>加入： before_action :authenticate_user!，限制必须要得登入使用者，才能看。</p>
<p>app/controllers/account/posts_controller.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">class Account::PostsController &lt; ApplicationController</div><div class="line">  before_action :authenticate_user!</div><div class="line">  def index</div><div class="line">    @posts = current_user.posts</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>Step 3. 修改 routing</p>
<p>修改 config/routes.rb 加入 resources :posts</p>
<p>config/routes.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">namespace :account do</div><div class="line">     resources :groups</div><div class="line">+    resources :posts</div><div class="line">  end</div></pre></td></tr></table></figure>
<p><a href="http://ww1.sinaimg.cn/large/006tNbRwjw1faswnssqxoj30la0h1acq.jpg" target="_blank" rel="external"><img src="http://ww1.sinaimg.cn/large/006tNbRwjw1faswnssqxoj30la0h1acq.jpg" alt="img"></a></p>
<h3 id="Step-4-修改下拉选项"><a href="#Step-4-修改下拉选项" class="headerlink" title="Step 4: 修改下拉选项"></a>Step 4: 修改下拉选项</h3><p>然后修改 app/views/common/_navbar.html.erb</p>
<p>加入多一个“下拉选单选项”：</p>
<p>app/views/common/_navbar.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;ul class=&quot;dropdown-menu&quot;&gt;</div><div class="line">                     &lt;li&gt; &lt;%= link_to(&quot;My Groups&quot;, account_groups_path) %&gt;&lt;/li&gt;</div><div class="line">+                    &lt;li&gt; &lt;%= link_to(&quot;My Posts&quot;, account_posts_path) %&gt;&lt;/li&gt; </div><div class="line">                     &lt;li class=&quot;divider&quot;&gt; &lt;/li&gt;</div><div class="line">                     &lt;li&gt; &lt;%= link_to(&quot;退出&quot;, destroy_user_session_path, method: :delete) %&gt; &lt;/li&gt;</div><div class="line">                &lt;/ul&gt;</div></pre></td></tr></table></figure>
<p>成果就会长这样：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rxzXs4siTBi4JtHEvbJo_Screenshot%20at%20Feb%2024%2020-09-38.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/rxzXs4siTBi4JtHEvbJo_Screenshot%20at%20Feb%2024%2020-09-38.png" alt="img"></a></p>
<h3 id="Step-5-新增-“发表文章一览表”"><a href="#Step-5-新增-“发表文章一览表”" class="headerlink" title="Step 5. 新增 “发表文章一览表”"></a>Step 5. 新增 “发表文章一览表”</h3><p><code>touch app/views/account/posts/index.html.erb</code></p>
<p>app/views/account/posts/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;div class=&quot;col-md-12&quot;&gt;</div><div class="line"></div><div class="line">  &lt;h2 class=&quot;text-center&quot;&gt; 我发表过的文章 &lt;/h2&gt;</div><div class="line"></div><div class="line">  &lt;table class=&quot;table&quot;&gt;</div><div class="line">    &lt;thead&gt;</div><div class="line">      &lt;tr&gt;</div><div class="line">        &lt;th&gt; Content &lt;/th&gt;</div><div class="line">        &lt;th&gt; Group Name &lt;/th&gt;</div><div class="line">        &lt;th&gt; Last Update &lt;/th&gt;</div><div class="line">        &lt;th colspan=&quot;2&quot;&gt;&lt;/th&gt;</div><div class="line">      &lt;/tr&gt;</div><div class="line">    &lt;/thead&gt;</div><div class="line"></div><div class="line">    &lt;tbody&gt;</div><div class="line">      &lt;% @posts.each do |post| %&gt;</div><div class="line">        &lt;tr&gt;</div><div class="line">          &lt;td&gt; &lt;%= post.content %&gt; &lt;/td&gt;</div><div class="line">          &lt;td&gt; &lt;%= post.group.title %&gt; &lt;/td&gt;</div><div class="line">          &lt;td&gt; &lt;%= post.updated_at %&gt; &lt;/td&gt;</div><div class="line">          &lt;td&gt; &lt;%= link_to(&apos;Edit&apos;, edit_group_post_path(post.group, post), class: &quot;btn btn-default btn-xs&quot;) %&gt;&lt;/td&gt;</div><div class="line">          &lt;td&gt; &lt;%= link_to(&apos;Delete&apos;, group_post_path(post.group, post), method: :delete, data: &#123; confirm: &quot;Are you sure?&quot; &#125;, class: &quot;btn btn-default btn-xs&quot;) %&gt;&lt;/td&gt;</div><div class="line">        &lt;/tr&gt;</div><div class="line">      &lt;% end %&gt;</div><div class="line">    &lt;/tbody&gt;</div><div class="line">  &lt;/table&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>成果：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/ZKq40ff6RCKx2ebf1OU8_Screenshot%20at%20Feb%2024%2020-11-49.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/ZKq40ff6RCKx2ebf1OU8_Screenshot%20at%20Feb%2024%2020-11-49.png" alt="img"></a></p>
<h3 id="Step-6-git-储存-1"><a href="#Step-6-git-储存-1" class="headerlink" title="Step 6: git 储存"></a>Step 6: git 储存</h3><p><code>git add .</code><br><code>git commit -m &quot;implement my posts&quot;</code></p>
<h2 id="额外作业："><a href="#额外作业：" class="headerlink" title="额外作业："></a>额外作业：</h2><p>（这次没有解答）</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/QG1xjgv7STu5bpblRr6G_Screenshot%20at%20Feb%2024%2020-13-11.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/QG1xjgv7STu5bpblRr6G_Screenshot%20at%20Feb%2024%2020-13-11.png" alt="img"></a></p>
<p>练习自己实作“编辑”和“删除”按钮这两个功能！</p>
<h4 id="本节常见问题-9"><a href="#本节常见问题-9" class="headerlink" title="**本节常见问题"></a>**本节常见问题</h4><h5 id="步骤5做了以后，浏览器出现红色报错"><a href="#步骤5做了以后，浏览器出现红色报错" class="headerlink" title="步骤5做了以后，浏览器出现红色报错"></a>步骤5做了以后，浏览器出现红色报错</h5><p>可能是之前的操作，有遗留一些数据，在目前的环境里产生报错。删除它们就好了。</p>
<p>在终端打开 rails console</p>
<p>输入</p>
<p>post = Post.all<br>post.delete_all<br>exit</p>
<h1 id="9-1-本章目标"><a href="#9-1-本章目标" class="headerlink" title="9-1 本章目标"></a>9-1 本章目标</h1><h2 id="目标-27"><a href="#目标-27" class="headerlink" title="目标"></a>目标</h2><ul>
<li>了解 Helper 是什么，怎么使用</li>
<li>了解 Partial 是什么，怎么使用</li>
</ul>
<h1 id="9-2-系统内建-Helper-“simple-format”的使用"><a href="#9-2-系统内建-Helper-“simple-format”的使用" class="headerlink" title="9-2 系统内建 Helper “simple_format”的使用"></a>9-2 系统内建 Helper “simple_format”的使用</h1><h2 id="目标-28"><a href="#目标-28" class="headerlink" title="目标"></a>目标</h2><ul>
<li>让群组叙述能够正确的断行</li>
</ul>
<p>当你开始使用这个系统时，你会发现一件很奇怪的事，输入三行叙述</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/c2KMDQzISdOuusAzzsxn_Screenshot%20at%20Feb%2024%2020-31-33.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/c2KMDQzISdOuusAzzsxn_Screenshot%20at%20Feb%2024%2020-31-33.png" alt="img"></a></p>
<p>却没有断行</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/4MgLunCAQcG8CNBgZBNm_Screenshot%20at%20Feb%2024%2020-32-44.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/4MgLunCAQcG8CNBgZBNm_Screenshot%20at%20Feb%2024%2020-32-44.png" alt="img"></a></p>
<p>我们这一节要讲的就是如何正确的断行</p>
<h2 id="步骤：-3"><a href="#步骤：-3" class="headerlink" title="步骤："></a>步骤：</h2><h3 id="Step-0-git-checkout-b-ch08"><a href="#Step-0-git-checkout-b-ch08" class="headerlink" title="Step 0. git checkout -b ch08"></a>Step 0. git checkout -b ch08</h3><p>因为我们现在要实作第八章的内容，新增一个 branch 把实作内容集中在 ch08 是比较合理的。将来回顾就可以比较清楚 在 ch08 我们做了哪一些练习。</p>
<p><code>git checkout -b ch08</code></p>
<h3 id="Step-1-将-group-description-改成-simple-format-group-description"><a href="#Step-1-将-group-description-改成-simple-format-group-description" class="headerlink" title="Step 1. 将 group.description 改成 simple_format(group.description)"></a>Step 1. 将 group.description 改成 simple_format(group.description)</h3><p>修改 app/views/groups/index.html.erb</p>
<p>app/views/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> &lt;td&gt;&lt;%= link_to(group.title, group_path(group)) %&gt;&lt;/td&gt;</div><div class="line">-     &lt;td&gt;&lt;%= group.description %&gt;&lt;/td&gt;</div><div class="line">+     &lt;td&gt;&lt;%= simple_format(group.description) %&gt;&lt;/td&gt;</div><div class="line">      &lt;td&gt; &lt;%= group.user.email %&gt; &lt;/td&gt;</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/LBd28oG2Rj28vXrnloW2_Screenshot%20at%20Feb%2024%2020-24-46.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/LBd28oG2Rj28vXrnloW2_Screenshot%20at%20Feb%2024%2020-24-46.png" alt="img"></a></p>
<p>然后你就可以看到正确的断行</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WjNnF1gUR8yUCDip7GJq_Screenshot%20at%20Feb%2024%2020-29-35.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/WjNnF1gUR8yUCDip7GJq_Screenshot%20at%20Feb%2024%2020-29-35.png" alt="img"></a></p>
<p><code>git add .</code><br><code>git commit -m &quot;use simple_format helper to decorate&quot;</code></p>
<h4 id="本节常见问题-10"><a href="#本节常见问题-10" class="headerlink" title="**本节常见问题"></a>**本节常见问题</h4><h5 id="为什么会有这样的差别？"><a href="#为什么会有这样的差别？" class="headerlink" title="为什么会有这样的差别？"></a>为什么会有这样的差别？</h5><p>让我们捞出 Log，你可以观察到，其实系统存的是这样的格式，断行是 <code>\r\n</code>。很遗憾的 HTML 并不认得 <code>\r\n</code> 是什么。HTML 只知道断行符号应该叫<code>&lt;br&gt;</code></p>
<p><code>simple_format</code> 是 Rails 内建的 Helper，可以帮忙把 <code>\r\n</code> 翻译成为 <code>&lt;br&gt;</code></p>
<h5 id="什么是-Helper？"><a href="#什么是-Helper？" class="headerlink" title="什么是 Helper？"></a>什么是 Helper？</h5><p>Helper 的意思是“小方法”，View 用的小方法，Rails 内建很多这种有趣的小东西。这里有更多小方法：<a href="http://api.rubyonrails.org/classes/ActionView/Helpers/TextHelper.html" target="_blank" rel="external">http://api.rubyonrails.org/classes/ActionView/Helpers/TextHelper.html</a></p>
<h1 id="9-3-使用自定义-Helper"><a href="#9-3-使用自定义-Helper" class="headerlink" title="9-3 使用自定义 Helper"></a>9-3 使用自定义 Helper</h1><h2 id="目标-29"><a href="#目标-29" class="headerlink" title="目标"></a>目标</h2><ul>
<li>用到 group.description 的地方很多，老是直接写 simple_format(group.description) 不是很好，万一以后产品经理想要加个什么特效，我们可能会改死</li>
<li>我们也想要发明“自己的 Helper”</li>
</ul>
<h2 id="步骤-23"><a href="#步骤-23" class="headerlink" title="步骤"></a>步骤</h2><h3 id="Step-1-自制-render-group-description-group"><a href="#Step-1-自制-render-group-description-group" class="headerlink" title="Step 1. 自制 render_group_description(group)"></a>Step 1. 自制 render_group_description(group)</h3><p>修改 app/helpers/groups_helper.rb</p>
<p>加入：</p>
<p>app/helpers/groups_helper.rb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">module GroupsHelper</div><div class="line">  def render_group_description(group)</div><div class="line">    simple_format(group.description)</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>然后修改 app/views/groups/index.html.erb 与 app/views/account/groups/index.html.erb 里关于 group.description 的部分（最终代码如下）：</p>
<p>app/views/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;td&gt;&lt;%= link_to(group.title, group_path(group)) %&gt;&lt;/td&gt;</div><div class="line">      &lt;td&gt;&lt;%= render_group_description(group) %&gt;&lt;/td&gt;</div><div class="line">      &lt;td&gt; &lt;%= group.user.email %&gt; &lt;/td&gt;</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/5VHVflEWRkOkVpwhh3o3_render_group_desc.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/5VHVflEWRkOkVpwhh3o3_render_group_desc.png" alt="img"></a></p>
<p>app/views/account/groups/index.html.erb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;td&gt;&lt;%= link_to(group.title, group_path(group)) %&gt;&lt;/td&gt;</div><div class="line">      &lt;td&gt;&lt;%= render_group_description(group) %&gt;&lt;/td&gt;</div><div class="line">      &lt;td&gt; &lt;%= group.posts.count %&gt; &lt;/td&gt;</div><div class="line">      &lt;td&gt; &lt;%= group.updated_at %&gt; &lt;/td&gt;</div></pre></td></tr></table></figure>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hTEvvp9kQUe4UvI3lTBS_Screenshot%20at%20Mar%2006%2016-19-41.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/hTEvvp9kQUe4UvI3lTBS_Screenshot%20at%20Mar%2006%2016-19-41.png" alt="img"></a></p>
<h3 id="Step-2-git-储存-1"><a href="#Step-2-git-储存-1" class="headerlink" title="Step 2 : git 储存"></a>Step 2 : git 储存</h3><p><code>git add .</code><br><code>git commit -m &quot;use self delimit helper&quot;</code></p>
<h4 id="本节常见问题-11"><a href="#本节常见问题-11" class="headerlink" title="**本节常见问题"></a>**本节常见问题</h4><h5 id="自制的-Helper-是什么意思？"><a href="#自制的-Helper-是什么意思？" class="headerlink" title="自制的 Helper 是什么意思？"></a>自制的 Helper 是什么意思？</h5><ul>
<li>Helper 就是用 Ruby 写的“View 装饰的小方法”，你也可以自己定义</li>
<li>自制 Helper 都会放在 app/helpers 下</li>
</ul>
<h1 id="10-1-上传到-Github-指南"><a href="#10-1-上传到-Github-指南" class="headerlink" title="10-1 上传到 Github 指南"></a>10-1 上传到 Github 指南</h1><h2 id="目标-30"><a href="#目标-30" class="headerlink" title="目标"></a>目标</h2><ul>
<li>把练习作业上传到 Github</li>
</ul>
<h2 id="步骤：-4"><a href="#步骤：-4" class="headerlink" title="步骤："></a>步骤：</h2><h3 id="Step-1-到-Github-开设-repo"><a href="#Step-1-到-Github-开设-repo" class="headerlink" title="Step 1. 到 Github 开设 repo"></a>Step 1. 到 Github 开设 repo</h3><ul>
<li>如果你是做第一遍，就开 rails101</li>
<li>如果你是做第二遍，就开 rails101-1</li>
<li>如果你是做第三遍，就开 rails101-2</li>
</ul>
<p>像我这样</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Ak1YaMdzRpWprmHSVgQx_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%884.02.53.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/Ak1YaMdzRpWprmHSVgQx_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%884.02.53.png" alt="img"></a></p>
<h3 id="Step-2-上传-Git-进度到-Github"><a href="#Step-2-上传-Git-进度到-Github" class="headerlink" title="Step 2. 上传 Git 进度到 Github"></a>Step 2. 上传 Git 进度到 Github</h3><p>我们每次在github上新建立一个repo后，都要执行以下两条指令：</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/m3p3y1DpRLiXkmfxjxt1_Screenshot%20at%20Feb%2024%2021-01-32.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/m3p3y1DpRLiXkmfxjxt1_Screenshot%20at%20Feb%2024%2021-01-32.png" alt="img"></a></p>
<p>分别在终端输入以上两条指令：<br><code>git remote add origin git@github.com:你的github名字/rails101-1.git</code><br><code>git push -u origin master</code></p>
<h3 id="Step-3-上传“所有进度”"><a href="#Step-3-上传“所有进度”" class="headerlink" title="Step 3. 上传“所有进度”"></a>Step 3. 上传“所有进度”</h3><p>因为我们这一次有做了很多“branch”，但是复制执行step2的两行命令只会让我们 push上去master一个分支而已。当我们新建立其他分支以后，在终端输入以下指令：</p>
<p><code>git push --all origin</code></p>
<p>这样就会把你所有的进度都推上去。</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xVMH02TsSZGgLI4LhTu2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%884.03.42.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xVMH02TsSZGgLI4LhTu2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%884.03.42.png" alt="img"></a></p>
<p>成果：</p>
<p>一切都顺利的话，你可以在 Github 上看到所有的 branch</p>
<p><a href="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xnFDsNdjSCWKdxvCqlw2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%884.09.04.png" target="_blank" rel="external"><img src="https://s3-ap-northeast-1.amazonaws.com/ontrackapp-production/xnFDsNdjSCWKdxvCqlw2_%E8%9E%A2%E5%B9%95%E5%BF%AB%E7%85%A7%202016-07-13%20%E4%B8%8A%E5%8D%884.09.04.png" alt="img"></a></p>
<h1 id="10-2-上传到-Heroku-指南"><a href="#10-2-上传到-Heroku-指南" class="headerlink" title="10-2 上传到 Heroku 指南"></a>10-2 上传到 Heroku 指南</h1><h3 id="Step-1：确认本地运行一切正常"><a href="#Step-1：确认本地运行一切正常" class="headerlink" title="Step 1：确认本地运行一切正常"></a>Step 1：确认本地运行一切正常</h3><p>有bug请先解决掉，否则上传會失败。</p>
<h3 id="Step-2：修改sqlite3加入pg这个gem"><a href="#Step-2：修改sqlite3加入pg这个gem" class="headerlink" title="Step 2：修改sqlite3加入pg这个gem"></a>Step 2：修改sqlite3加入pg这个gem</h3><p>修改 Gemfile 文件<br>把 sqlite3 从第7行搬到约第30到40行的group :development, :test do</p>
<p>这一行里面，置于gem ‘byebug’的下面。</p>
<p><a href="http://ww1.sinaimg.cn/large/006tNbRwjw1fb5t9ep5udj30dc03ydg7.jpg" target="_blank" rel="external"><img src="http://ww1.sinaimg.cn/large/006tNbRwjw1fb5t9ep5udj30dc03ydg7.jpg" alt="img"></a></p>
<p>在末尾新增一个 production group，加上 pg 这个 gem</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">group :production do </div><div class="line">  gem &apos;pg&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<p><a href="http://ww3.sinaimg.cn/large/006tNbRwjw1fb5vm23d6wj30ft03zwex.jpg" target="_blank" rel="external"><img src="http://ww3.sinaimg.cn/large/006tNbRwjw1fb5vm23d6wj30ft03zwex.jpg" alt="img"></a></p>
<p>command+s 存档</p>
<p>修改 Gemfile 后要 <code>bundle install</code></p>
<p>存档</p>
<ul>
<li><code>git add .</code></li>
<li><code>git commit -m &quot;move sqlite3 to dev group &amp; add pg to production group &quot;</code></li>
</ul>
<p>具体可以参考第一课<a href="https://fullstack.xinshengdaxue.com/posts/26" target="_blank" rel="external">相关章节</a>以及<a href="http://docs.qzy.camp/docs/heroku" target="_blank" rel="external">帮助文档</a></p>
<h3 id="Step3：在-Heroku-建立新项目"><a href="#Step3：在-Heroku-建立新项目" class="headerlink" title="Step3：在 Heroku 建立新项目"></a>Step3：在 Heroku 建立新项目</h3><p>首先记得登入<br><code>heroku login</code></p>
<p>创建<br><code>heroku create</code></p>
<p><strong>小提示：因为heroku为远端连结，需要等待一段时间，如果无法连上，可以尝试换一个VPN再操作。</strong></p>
<h3 id="Step-4：上传到-heroku"><a href="#Step-4：上传到-heroku" class="headerlink" title="Step 4：上传到 heroku"></a>Step 4：上传到 heroku</h3><p>在终端输入<br><code>git push heroku ch08:master</code></p>
<p>因为我们的最新进度在 ch08。</p>
<h3 id="Step-5：跑-heroku-run-rake-db-migrate"><a href="#Step-5：跑-heroku-run-rake-db-migrate" class="headerlink" title="Step 5：跑 heroku run rake db:migrate"></a>Step 5：跑 heroku run rake db:migrate</h3><p>执行</p>
<p><code>heroku run rake db:migrate</code></p>
<h3 id="Step-6：大功告成！交作业吧"><a href="#Step-6：大功告成！交作业吧" class="headerlink" title="Step 6：大功告成！交作业吧"></a>Step 6：大功告成！交作业吧</h3><p>恭喜你完成！<br>把你的 heroku 网址贴上作业栏位吧。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>做事的人，才会有敬畏感。</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wx.jpg" alt="邱桂新 WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/zfb.jpg" alt="邱桂新 Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/rails/" rel="tag"># rails</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/12/hello-world/" rel="next" title="Hello World">
                <i class="fa fa-chevron-left"></i> Hello World
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars3.githubusercontent.com/u/16093668?v=3&s=460"
               alt="邱桂新" />
          <p class="site-author-name" itemprop="name">邱桂新</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/qiuguixin" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2720138043/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-1-前言"><span class="nav-number">1.</span> <span class="nav-text">1-1 前言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标"><span class="nav-number">1.1.</span> <span class="nav-text">目标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#时程"><span class="nav-number">1.1.1.</span> <span class="nav-text">时程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#需求"><span class="nav-number">1.1.2.</span> <span class="nav-text">需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何确认一切没问题？"><span class="nav-number">1.1.3.</span> <span class="nav-text">如何确认一切没问题？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#效能！效率！"><span class="nav-number">1.1.4.</span> <span class="nav-text">效能！效率！</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#格式"><span class="nav-number">1.1.5.</span> <span class="nav-text">格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注意"><span class="nav-number">1.1.6.</span> <span class="nav-text">注意</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-1-本章目标"><span class="nav-number">2.</span> <span class="nav-text">2-1 本章目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-2-建立新项目"><span class="nav-number">3.</span> <span class="nav-text">2-2 建立新项目</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-3-帮-Rails-项目穿上衣服“Bootstrap”"><span class="nav-number">4.</span> <span class="nav-text">2-3 帮 Rails 项目穿上衣服“Bootstrap”</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-4-套用-Bootstrap-的-html-样式-（以下内容无需记忆）"><span class="nav-number">5.</span> <span class="nav-text">2-4 套用 Bootstrap 的 html 样式 （以下内容无需记忆）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-1"><span class="nav-number">5.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤"><span class="nav-number">5.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-新增-app-views-common-文件夹"><span class="nav-number">5.2.1.</span> <span class="nav-text">Step 1. 新增 app/views/common 文件夹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-新增-navbar"><span class="nav-number">5.2.2.</span> <span class="nav-text">Step 2. 新增 navbar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-新增-footer"><span class="nav-number">5.2.3.</span> <span class="nav-text">Step 3. 新增 footer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-修改全域-HTML-样式-application-html-erb"><span class="nav-number">5.2.4.</span> <span class="nav-text">Step 4. 修改全域 HTML 样式 application.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-产生一个新的空-Hello-World-页面-（放在-welcome-index"><span class="nav-number">5.2.5.</span> <span class="nav-text">Step 5. 产生一个新的空 Hello World 页面 （放在 welcome#index)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-将首页指到-welcome-下的-index-html-erb-页面"><span class="nav-number">5.2.6.</span> <span class="nav-text">Step 6. 将首页指到 welcome 下的 index.html.erb 页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-7-git-进度存档"><span class="nav-number">5.2.7.</span> <span class="nav-text">Step 7. git 进度存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-8-运行-Rails-Server"><span class="nav-number">5.2.8.</span> <span class="nav-text">Step 8. 运行 Rails Server</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-5-制作漂亮的“提示信息”-（以下内容无需记忆）"><span class="nav-number">6.</span> <span class="nav-text">2-5 制作漂亮的“提示信息” （以下内容无需记忆）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-2"><span class="nav-number">6.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-1"><span class="nav-number">6.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-将-Bootstrap-的-js-提示套件-bootstrap-alert-“挂”进项目里面"><span class="nav-number">6.2.1.</span> <span class="nav-text">Step 1. 将 Bootstrap 的 js 提示套件 bootstrap/alert “挂”进项目里面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-新增-app-views-common-flashes-html-erb"><span class="nav-number">6.2.2.</span> <span class="nav-text">Step 2. 新增 app/views/common/_flashes.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-加入-app-helpers-flashes-helper-rb"><span class="nav-number">6.2.3.</span> <span class="nav-text">Step 3. 加入 app/helpers/flashes_helper.rb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-在-application-html-erb-内加入-flash-这个-partial"><span class="nav-number">6.2.4.</span> <span class="nav-text">Step 4. 在 application.html.erb 内加入 flash 这个 partial</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-git-存档"><span class="nav-number">6.2.5.</span> <span class="nav-text">Step 5. git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-测试-flash-helper-的功能"><span class="nav-number">6.2.6.</span> <span class="nav-text">Step 6: 测试 flash helper 的功能</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-6-参考：git-常用指令教学"><span class="nav-number">7.</span> <span class="nav-text">2-6 参考：git 常用指令教学</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#存档："><span class="nav-number">7.0.1.</span> <span class="nav-text">存档：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#新增一个分支："><span class="nav-number">7.0.2.</span> <span class="nav-text">新增一个分支：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#切换分支："><span class="nav-number">7.0.3.</span> <span class="nav-text">切换分支：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除掉branch的方法："><span class="nav-number">7.0.4.</span> <span class="nav-text">删除掉branch的方法：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-1-建立讨论群的架构"><span class="nav-number">8.</span> <span class="nav-text">3-1 建立讨论群的架构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-3"><span class="nav-number">8.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-2"><span class="nav-number">8.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-0-git-checkout-b-ch02"><span class="nav-number">8.2.1.</span> <span class="nav-text">Step 0. git checkout -b ch02</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-设计-Group-的-model-架构"><span class="nav-number">8.2.2.</span> <span class="nav-text">Step 1. 设计 Group 的 model 架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-产生-groups-controller"><span class="nav-number">8.2.3.</span> <span class="nav-text">Step 2. 产生 groups controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-建立-index-action-以及-index-的-view"><span class="nav-number">8.2.4.</span> <span class="nav-text">Step 3. 建立 index action 以及 index 的 view</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-在-routing-上挂上-groups"><span class="nav-number">8.2.5.</span> <span class="nav-text">Step 4. 在 routing 上挂上 groups</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-添加一些数据。"><span class="nav-number">8.2.6.</span> <span class="nav-text">Step 5. 添加一些数据。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-git-存档"><span class="nav-number">8.2.7.</span> <span class="nav-text">Step 6. git 存档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-2-将首页换成讨论群一览表"><span class="nav-number">9.</span> <span class="nav-text">3-2 将首页换成讨论群一览表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-4"><span class="nav-number">9.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-3"><span class="nav-number">9.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-修改-routing"><span class="nav-number">9.2.1.</span> <span class="nav-text">Step 1. 修改 routing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-git-存档"><span class="nav-number">9.2.2.</span> <span class="nav-text">Step 2. git 存档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-1-本章目标"><span class="nav-number">10.</span> <span class="nav-text">4-1 本章目标</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-5"><span class="nav-number">10.1.</span> <span class="nav-text">目标</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-2-实作讨论群“新增”功能"><span class="nav-number">11.</span> <span class="nav-text">4-2 实作讨论群“新增”功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-6"><span class="nav-number">11.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-4"><span class="nav-number">11.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-0-git-checkout-b-ch03"><span class="nav-number">11.2.1.</span> <span class="nav-text">Step 0. git checkout -b ch03</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-建立-new-action"><span class="nav-number">11.2.2.</span> <span class="nav-text">Step 1. 建立 new action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-建立-new-action-的表单"><span class="nav-number">11.2.3.</span> <span class="nav-text">Step 2. 建立 new action 的表单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-git-存档"><span class="nav-number">11.2.4.</span> <span class="nav-text">Step 3. git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-建立-create-action，接收数据并储存"><span class="nav-number">11.2.5.</span> <span class="nav-text">Step 4. 建立 create action，接收数据并储存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-git-存档-1"><span class="nav-number">11.2.6.</span> <span class="nav-text">Step 5. git 存档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-3-实作讨论群“浏览”功能"><span class="nav-number">12.</span> <span class="nav-text">4-3 实作讨论群“浏览”功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-7"><span class="nav-number">12.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-5"><span class="nav-number">12.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step1-建立-show-action"><span class="nav-number">12.2.1.</span> <span class="nav-text">Step1: 建立 show action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-加入-app-views-groups-show-html-erb"><span class="nav-number">12.2.2.</span> <span class="nav-text">Step 2: 加入 app/views/groups/show.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-git-存档-1"><span class="nav-number">12.2.3.</span> <span class="nav-text">Step 3 : git 存档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-4-实作讨论群“编辑”功能"><span class="nav-number">13.</span> <span class="nav-text">4-4 实作讨论群“编辑”功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-8"><span class="nav-number">13.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤："><span class="nav-number">13.2.</span> <span class="nav-text">步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-建立-edit-action"><span class="nav-number">13.2.1.</span> <span class="nav-text">Step 1. 建立 edit action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-建立-edit-action-的表单"><span class="nav-number">13.2.2.</span> <span class="nav-text">Step 2. 建立 edit action 的表单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-git-存档-2"><span class="nav-number">13.2.3.</span> <span class="nav-text">Step 3. git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-实作-update-action"><span class="nav-number">13.2.4.</span> <span class="nav-text">Step 4. 实作 update action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-git-存档-2"><span class="nav-number">13.2.5.</span> <span class="nav-text">Step 5. git 存档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-5-实作讨论群“删除”功能"><span class="nav-number">14.</span> <span class="nav-text">4-5 实作讨论群“删除”功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-9"><span class="nav-number">14.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤：-1"><span class="nav-number">14.2.</span> <span class="nav-text">步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step1-建立-delete-action"><span class="nav-number">14.2.1.</span> <span class="nav-text">Step1. 建立 delete action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-git-存档-1"><span class="nav-number">14.2.2.</span> <span class="nav-text">Step 2. git 存档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-6-限制“标题为空”的Group，不能被新增"><span class="nav-number">15.</span> <span class="nav-text">4-6 限制“标题为空”的Group，不能被新增</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-10"><span class="nav-number">15.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-6"><span class="nav-number">15.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-在-Group-model-加入“标题限制”"><span class="nav-number">15.2.1.</span> <span class="nav-text">Step 1: 在 Group model 加入“标题限制”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-在-groups-controller-里面加入储存失败的判断"><span class="nav-number">15.2.2.</span> <span class="nav-text">Step 2: 在 groups_controller 里面加入储存失败的判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-git-存档-3"><span class="nav-number">15.2.3.</span> <span class="nav-text">Step 3 : git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-修改-edit-action"><span class="nav-number">15.2.4.</span> <span class="nav-text">Step 4 : 修改 edit action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-git-存档-3"><span class="nav-number">15.2.5.</span> <span class="nav-text">Step 5 : git 存档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题"><span class="nav-number">15.2.5.1.</span> <span class="nav-text">本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#validates-title-presence-true-是什么意思"><span class="nav-number">15.2.5.1.1.</span> <span class="nav-text">validates :title, presence: true 是什么意思</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-7-共用“表单”"><span class="nav-number">16.</span> <span class="nav-text">4-7 共用“表单”</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-11"><span class="nav-number">16.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-7"><span class="nav-number">16.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-产生-app-views-groups-form-html-erb"><span class="nav-number">16.2.1.</span> <span class="nav-text">Step 1: 产生 app/views/groups/_form.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-修改-app-views-groups-new-html-erb"><span class="nav-number">16.2.2.</span> <span class="nav-text">Step 2: 修改 app/views/groups/new.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-修改-app-views-groups-edit-html-erb"><span class="nav-number">16.2.3.</span> <span class="nav-text">Step 3: 修改 app/views/groups/edit.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-git-存档"><span class="nav-number">16.2.4.</span> <span class="nav-text">Step 4: git 存档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-1"><span class="nav-number">16.2.4.1.</span> <span class="nav-text">本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#教材里的render-“form”是什么意思？"><span class="nav-number">16.2.4.1.1.</span> <span class="nav-text">教材里的render “form”是什么意思？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-8-将表单换为-Bootstrap-提供的版型"><span class="nav-number">17.</span> <span class="nav-text">4-8 将表单换为 Bootstrap 提供的版型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-12"><span class="nav-number">17.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-8"><span class="nav-number">17.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-修改-app-views-groups-form-html-erb"><span class="nav-number">17.2.1.</span> <span class="nav-text">Step 1: 修改 app/views/groups/_form.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2：-git-存档"><span class="nav-number">17.2.2.</span> <span class="nav-text">Step 2： git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-使用-SimpleForm-简化"><span class="nav-number">17.2.3.</span> <span class="nav-text">Step 3: 使用 SimpleForm 简化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-安装-simple-form-for-bootstrap-的设定"><span class="nav-number">17.2.4.</span> <span class="nav-text">Step 4: 安装 simple_form for bootstrap 的设定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-修改-app-views-groups-form-html-erb"><span class="nav-number">17.2.5.</span> <span class="nav-text">Step 5: 修改 app/views/groups/_form.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-git-存档-1"><span class="nav-number">17.2.6.</span> <span class="nav-text">Step 6: git 存档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-2"><span class="nav-number">17.2.6.1.</span> <span class="nav-text">本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#为什么装完-gem-后要重开？"><span class="nav-number">17.2.6.1.1.</span> <span class="nav-text">为什么装完 gem 后要重开？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-9（解说）Rails-的-CRUD-与-RESTful"><span class="nav-number">18.</span> <span class="nav-text">4-9（解说）Rails 的 CRUD 与 RESTful</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#HTTP-请求-Request）与-HTTP-动作-Verb）"><span class="nav-number">18.1.</span> <span class="nav-text">HTTP 请求( Request）与 HTTP 动作 ( Verb）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RESTful-的基础概念"><span class="nav-number">18.2.</span> <span class="nav-text">RESTful 的基础概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rails-的基础-RESTful概念"><span class="nav-number">18.3.</span> <span class="nav-text">Rails 的基础 RESTful概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#以下例子以-第三章，-做出-CRUD-功能的讨论版来解释："><span class="nav-number">18.4.</span> <span class="nav-text">以下例子以 第三章， 做出 CRUD 功能的讨论版来解释：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#网址对应关系"><span class="nav-number">18.5.</span> <span class="nav-text">网址对应关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">18.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-1-本章目标"><span class="nav-number">19.</span> <span class="nav-text">5-1 本章目标</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#本章目标"><span class="nav-number">19.1.</span> <span class="nav-text">本章目标:</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-2-安装-devise-gem"><span class="nav-number">20.</span> <span class="nav-text">5-2 安装 devise gem</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-13"><span class="nav-number">20.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-9"><span class="nav-number">20.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-0-git-checkout-b-ch04"><span class="nav-number">20.2.1.</span> <span class="nav-text">Step 0. git checkout -b ch04</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-安装登录系统"><span class="nav-number">20.2.2.</span> <span class="nav-text">Step 1: 安装登录系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-产生会员系统的必要文件"><span class="nav-number">20.2.3.</span> <span class="nav-text">Step 2 : 产生会员系统的必要文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-在-groups-controller-限制-“新增讨论群”必须先登录"><span class="nav-number">20.2.4.</span> <span class="nav-text">Step 3: 在 groups_controller 限制 “新增讨论群”必须先登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-git-存档-1"><span class="nav-number">20.2.5.</span> <span class="nav-text">Step 4: git 存档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-3"><span class="nav-number">20.2.5.1.</span> <span class="nav-text">本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#devise-帮我们做了什么？"><span class="nav-number">20.2.5.1.1.</span> <span class="nav-text">devise 帮我们做了什么？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#before-action-又是什么呢？"><span class="nav-number">20.2.5.1.2.</span> <span class="nav-text">before_action 又是什么呢？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-3-让这个网站有实际“登录”、“退出”的功能"><span class="nav-number">21.</span> <span class="nav-text">5-3 让这个网站有实际“登录”、“退出”的功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-14"><span class="nav-number">21.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-10"><span class="nav-number">21.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-修改-app-views-common-navbar-html-erb"><span class="nav-number">21.2.1.</span> <span class="nav-text">Step 1: 修改 app/views/common/_navbar.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-修改-app-assets-javascripts-application-js"><span class="nav-number">21.2.2.</span> <span class="nav-text">Step 2: 修改 app/assets/javascripts/application.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-git-储存"><span class="nav-number">21.2.3.</span> <span class="nav-text">Step 3: git 储存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-4"><span class="nav-number">21.2.3.1.</span> <span class="nav-text">**本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#current-user-是什么？"><span class="nav-number">21.2.3.1.1.</span> <span class="nav-text">current_user 是什么？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#current-user-又是什么"><span class="nav-number">21.2.3.1.2.</span> <span class="nav-text">!current_user 又是什么</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-4-让“群组”与“使用者”产生关联"><span class="nav-number">22.</span> <span class="nav-text">5-4 让“群组”与“使用者”产生关联</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-15"><span class="nav-number">22.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-11"><span class="nav-number">22.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-新增-user-id-到-group-的-table-里"><span class="nav-number">22.2.1.</span> <span class="nav-text">Step 1: 新增 user_id 到 group 的 table 里</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-连结-user-与-group-的双向关系"><span class="nav-number">22.2.2.</span> <span class="nav-text">Step 2: 连结 user 与 group 的双向关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-git-储存"><span class="nav-number">22.2.3.</span> <span class="nav-text">Step 4 : git 储存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-修改-group-列表，将-user-的名字列上去"><span class="nav-number">22.2.4.</span> <span class="nav-text">Step 5 : 修改 group 列表，将 user 的名字列上去</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-删除所有“无主”的群组"><span class="nav-number">22.2.5.</span> <span class="nav-text">Step 6: 删除所有“无主”的群组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-7-git-存档"><span class="nav-number">22.2.6.</span> <span class="nav-text">Step 7 : git 存档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-5"><span class="nav-number">22.2.6.1.</span> <span class="nav-text">**本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#has-many-与-belongs-to-是什么意思？"><span class="nav-number">22.2.6.1.1.</span> <span class="nav-text">has_many 与 belongs_to 是什么意思？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-5-只有群组的“创始者”可以“编辑”“删除”群组资讯"><span class="nav-number">23.</span> <span class="nav-text">5-5 只有群组的“创始者”可以“编辑”“删除”群组资讯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-16"><span class="nav-number">23.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-12"><span class="nav-number">23.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-路人不应该可以看到“编辑”“删除”按钮"><span class="nav-number">23.2.1.</span> <span class="nav-text">Step 1: 路人不应该可以看到“编辑”“删除”按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-git-存档-2"><span class="nav-number">23.2.2.</span> <span class="nav-text">Step 2: git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-路人不应该也可以“直接输入网址”去存取-edit-update-destroy-action"><span class="nav-number">23.2.3.</span> <span class="nav-text">Step 3: 路人不应该也可以“直接输入网址”去存取 edit / update / destroy action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-必须要是-group-拥有人，才能进入-edit，否则会被重导至首页，并显示错误信息。"><span class="nav-number">23.2.4.</span> <span class="nav-text">Step 4: 必须要是 group 拥有人，才能进入 edit，否则会被重导至首页，并显示错误信息。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-依样画葫芦的把“权限检查”的代码，套用到-update-destroy-上"><span class="nav-number">23.2.5.</span> <span class="nav-text">Step 5: 依样画葫芦的把“权限检查”的代码，套用到 update / destroy 上</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-git-存档-2"><span class="nav-number">23.2.6.</span> <span class="nav-text">Step 6: git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-7-制作-find-group-and-check-permission"><span class="nav-number">23.2.7.</span> <span class="nav-text">Step 7: 制作 find_group_and_check_permission</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-8-把-find-group-and-check-permission-挂到-before-action"><span class="nav-number">23.2.8.</span> <span class="nav-text">Step 8: 把 find_group_and_check_permission 挂到 before_action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-9-git-存档"><span class="nav-number">23.2.9.</span> <span class="nav-text">Step 9: git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-10-修掉-show-里面的-Edit-按钮"><span class="nav-number">23.2.10.</span> <span class="nav-text">Step 10 : 修掉 show 里面的 Edit 按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-11-git-存档"><span class="nav-number">23.2.11.</span> <span class="nav-text">Step 11: git 存档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-6"><span class="nav-number">23.2.11.1.</span> <span class="nav-text">**本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#与-与-他们三者是什么？"><span class="nav-number">23.2.11.1.1.</span> <span class="nav-text">= 与 == 与 != 他们三者是什么？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-1-本章目标"><span class="nav-number">24.</span> <span class="nav-text">6-1 本章目标</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#本章目标："><span class="nav-number">24.1.</span> <span class="nav-text">本章目标：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-2-建立文章的架构"><span class="nav-number">25.</span> <span class="nav-text">6-2 建立文章的架构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-17"><span class="nav-number">25.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-13"><span class="nav-number">25.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-0-git-checkout-b-ch05"><span class="nav-number">25.2.1.</span> <span class="nav-text">Step 0. git checkout -b ch05</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-设计-Post-的-model-架构"><span class="nav-number">25.2.2.</span> <span class="nav-text">Step 1. 设计 Post 的 model 架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-建立-Group-Post-User-三者间的关系"><span class="nav-number">25.2.3.</span> <span class="nav-text">Step 2. 建立 Group / Post / User 三者间的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-git-存档-4"><span class="nav-number">25.2.4.</span> <span class="nav-text">Step 3. git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-建立-Post-Controller"><span class="nav-number">25.2.5.</span> <span class="nav-text">Step 4. 建立 Post Controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-设立-routing"><span class="nav-number">25.2.6.</span> <span class="nav-text">Step 5. 设立 routing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-git-存档-3"><span class="nav-number">25.2.7.</span> <span class="nav-text">Step 6. git 存档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-7-在-groups-show-新增-“发表文章”按钮"><span class="nav-number">25.2.8.</span> <span class="nav-text">Step 7. 在 groups#show 新增 “发表文章”按钮</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-8-git-存档"><span class="nav-number">25.2.9.</span> <span class="nav-text">Step 8. git 存档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-3-实际发表文章"><span class="nav-number">26.</span> <span class="nav-text">6-3 实际发表文章</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标："><span class="nav-number">26.1.</span> <span class="nav-text">目标：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤：-2"><span class="nav-number">26.2.</span> <span class="nav-text">步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-实作-new-create-action"><span class="nav-number">26.2.1.</span> <span class="nav-text">Step 1: 实作 new / create action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-新增-app-views-posts-new-html-erb"><span class="nav-number">26.2.2.</span> <span class="nav-text">Step 2. 新增 app/views/posts/new.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-修改-groups-show-html-erb"><span class="nav-number">26.2.3.</span> <span class="nav-text">Step 4. 修改 groups/show.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-对-Post-加上-validation"><span class="nav-number">26.2.4.</span> <span class="nav-text">Step 5: 对 Post 加上 validation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-git-存档-4"><span class="nav-number">26.2.5.</span> <span class="nav-text">Step 6. git 存档</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-4-文章应该按照发表时间倒序排列"><span class="nav-number">27.</span> <span class="nav-text">6-4 文章应该按照发表时间倒序排列</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-18"><span class="nav-number">27.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-14"><span class="nav-number">27.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-修改-groups-controller"><span class="nav-number">27.2.1.</span> <span class="nav-text">Step 1. 修改 groups_controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-git-储存"><span class="nav-number">27.2.2.</span> <span class="nav-text">Step 2. git 储存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-使用-scope-替代直接-order"><span class="nav-number">27.2.3.</span> <span class="nav-text">Step 3. 使用 scope 替代直接 order</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-git-储存-1"><span class="nav-number">27.2.4.</span> <span class="nav-text">Step 4. git 储存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解说"><span class="nav-number">27.3.</span> <span class="nav-text">解说</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#order-“created-at-DESC”-是什么？"><span class="nav-number">27.3.1.</span> <span class="nav-text">order(“created_at DESC”) 是什么？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scope-又是什么呢？"><span class="nav-number">27.3.2.</span> <span class="nav-text">scope 又是什么呢？</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-5-加入文章分页功能"><span class="nav-number">28.</span> <span class="nav-text">6-5 加入文章分页功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-19"><span class="nav-number">28.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-15"><span class="nav-number">28.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-安装-will-paginate"><span class="nav-number">28.2.1.</span> <span class="nav-text">Step 1: 安装 will_paginate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-修改-groups-controller"><span class="nav-number">28.2.2.</span> <span class="nav-text">Step 2: 修改 groups_controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-修改-groups-show-html-erb"><span class="nav-number">28.2.3.</span> <span class="nav-text">Step 3: 修改 groups/show.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-git-储存-2"><span class="nav-number">28.2.4.</span> <span class="nav-text">Step 4: git 储存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-7"><span class="nav-number">28.2.4.1.</span> <span class="nav-text">**本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#要去哪里才能知道，我想要的功能要用什么-gem-呢？"><span class="nav-number">28.2.4.1.1.</span> <span class="nav-text">要去哪里才能知道，我想要的功能要用什么 gem 呢？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-1-本章目标"><span class="nav-number">29.</span> <span class="nav-text">7-1 本章目标</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#本章目标：-1"><span class="nav-number">29.1.</span> <span class="nav-text">本章目标：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-2-建立“群成员”数据表"><span class="nav-number">30.</span> <span class="nav-text">7-2 建立“群成员”数据表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-20"><span class="nav-number">30.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-16"><span class="nav-number">30.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-0-git-checkout-b-ch06"><span class="nav-number">30.2.1.</span> <span class="nav-text">Step 0. git checkout -b ch06</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-建立-GroupRelationship"><span class="nav-number">30.2.2.</span> <span class="nav-text">Step 1: 建立 GroupRelationship</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-设定-Group-与-User-之间的关系-使用者参与的所有群）"><span class="nav-number">30.2.3.</span> <span class="nav-text">Step 2: 设定 Group 与 User 之间的关系 ( 使用者参与的所有群）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-设定-Group-与-User-之间的关系-群组内的所有会员-）"><span class="nav-number">30.2.4.</span> <span class="nav-text">Step 3: 设定 Group 与 User 之间的关系 ( 群组内的所有会员 ）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-动手测看看"><span class="nav-number">30.2.5.</span> <span class="nav-text">Step 4: 动手测看看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-git-储存"><span class="nav-number">30.2.6.</span> <span class="nav-text">Step 5: git 储存</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-3-在群组里面判断“是否群组成员”实作"><span class="nav-number">31.</span> <span class="nav-text">7-3 在群组里面判断“是否群组成员”实作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-21"><span class="nav-number">31.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-17"><span class="nav-number">31.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-在-user-model-内实作判断式“是否为群组的一分子”"><span class="nav-number">31.2.1.</span> <span class="nav-text">Step 1. 在 user model 内实作判断式“是否为群组的一分子”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-修改-groups-show-html-erb"><span class="nav-number">31.2.2.</span> <span class="nav-text">Step 2. 修改 groups/show.html.erb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-git-存档-5"><span class="nav-number">31.2.3.</span> <span class="nav-text">Step 3. git 存档</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-8"><span class="nav-number">31.2.3.1.</span> <span class="nav-text">**本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#is-member-of-group-为什么这一段要放在-User-的-model-里？"><span class="nav-number">31.2.3.1.1.</span> <span class="nav-text">is_member_of?(group) 为什么这一段要放在 User 的 model 里？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#“-”问号在这里有任何意义吗？"><span class="nav-number">31.2.3.1.2.</span> <span class="nav-text">“?”问号在这里有任何意义吗？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-4-“加入群组”或“退出群组”"><span class="nav-number">32.</span> <span class="nav-text">7-4 “加入群组”或“退出群组”</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-22"><span class="nav-number">32.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-18"><span class="nav-number">32.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-1"><span class="nav-number">32.2.1.</span> <span class="nav-text">步骤 1:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#步骤-2"><span class="nav-number">32.2.2.</span> <span class="nav-text">步骤 2:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-5-实际操作“加入群组”或“退出群组”"><span class="nav-number">33.</span> <span class="nav-text">7-5 实际操作“加入群组”或“退出群组”</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-19"><span class="nav-number">33.1.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1"><span class="nav-number">33.1.1.</span> <span class="nav-text">Step 1:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3"><span class="nav-number">33.1.2.</span> <span class="nav-text">Step 3:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4"><span class="nav-number">33.1.3.</span> <span class="nav-text">Step 4:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-6-User-在建立-group-后自动成为-group-的一员"><span class="nav-number">34.</span> <span class="nav-text">7-6 User 在建立 group 后自动成为 group 的一员</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-23"><span class="nav-number">34.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-20"><span class="nav-number">34.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-1-1"><span class="nav-number">34.3.</span> <span class="nav-text">Step 1 :</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2"><span class="nav-number">34.3.1.</span> <span class="nav-text">Step 2:</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-1-本章目标"><span class="nav-number">35.</span> <span class="nav-text">8-1 本章目标</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-24"><span class="nav-number">35.1.</span> <span class="nav-text">目标</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-2-可以看到自己参与的所有群组"><span class="nav-number">36.</span> <span class="nav-text">8-2 可以看到自己参与的所有群组</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-25"><span class="nav-number">36.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-21"><span class="nav-number">36.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-0-git-checkout-b-ch07"><span class="nav-number">36.2.1.</span> <span class="nav-text">Step 0. git checkout -b ch07</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-产生-account-的-namespace-下的-groups-controller"><span class="nav-number">36.2.2.</span> <span class="nav-text">Step 1: 产生 account 的 namespace 下的 groups_controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-修改-routing"><span class="nav-number">36.2.3.</span> <span class="nav-text">Step 2. 修改 routing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-修改下拉选项"><span class="nav-number">36.2.4.</span> <span class="nav-text">Step 3: 修改下拉选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-建立-account-groups-controller-rb-下的-index-action"><span class="nav-number">36.2.5.</span> <span class="nav-text">Step 4. 建立 account/groups_controller.rb 下的 index action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-新增-“参与群组一览表”"><span class="nav-number">36.2.6.</span> <span class="nav-text">Step 5. 新增 “参与群组一览表”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-git-储存"><span class="nav-number">36.2.7.</span> <span class="nav-text">Step 6: git 储存</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-3-可以看到自己发表的所有文章"><span class="nav-number">37.</span> <span class="nav-text">8-3 可以看到自己发表的所有文章</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-26"><span class="nav-number">37.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-22"><span class="nav-number">37.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-产生-account-的-namespace-下的-posts-controller"><span class="nav-number">37.2.1.</span> <span class="nav-text">Step 1: 产生 account 的 namespace 下的 posts_controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-建立-account-posts-controller-rb-下的-index-action"><span class="nav-number">37.2.2.</span> <span class="nav-text">Step 2. 建立 account/posts_controller.rb 下的 index action</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4-修改下拉选项"><span class="nav-number">37.2.3.</span> <span class="nav-text">Step 4: 修改下拉选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5-新增-“发表文章一览表”"><span class="nav-number">37.2.4.</span> <span class="nav-text">Step 5. 新增 “发表文章一览表”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6-git-储存-1"><span class="nav-number">37.2.5.</span> <span class="nav-text">Step 6: git 储存</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#额外作业："><span class="nav-number">37.3.</span> <span class="nav-text">额外作业：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-9"><span class="nav-number">37.3.0.1.</span> <span class="nav-text">**本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#步骤5做了以后，浏览器出现红色报错"><span class="nav-number">37.3.0.1.1.</span> <span class="nav-text">步骤5做了以后，浏览器出现红色报错</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-1-本章目标"><span class="nav-number">38.</span> <span class="nav-text">9-1 本章目标</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-27"><span class="nav-number">38.1.</span> <span class="nav-text">目标</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-2-系统内建-Helper-“simple-format”的使用"><span class="nav-number">39.</span> <span class="nav-text">9-2 系统内建 Helper “simple_format”的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-28"><span class="nav-number">39.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤：-3"><span class="nav-number">39.2.</span> <span class="nav-text">步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-0-git-checkout-b-ch08"><span class="nav-number">39.2.1.</span> <span class="nav-text">Step 0. git checkout -b ch08</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-将-group-description-改成-simple-format-group-description"><span class="nav-number">39.2.2.</span> <span class="nav-text">Step 1. 将 group.description 改成 simple_format(group.description)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-10"><span class="nav-number">39.2.2.1.</span> <span class="nav-text">**本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#为什么会有这样的差别？"><span class="nav-number">39.2.2.1.1.</span> <span class="nav-text">为什么会有这样的差别？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#什么是-Helper？"><span class="nav-number">39.2.2.1.2.</span> <span class="nav-text">什么是 Helper？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-3-使用自定义-Helper"><span class="nav-number">40.</span> <span class="nav-text">9-3 使用自定义 Helper</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-29"><span class="nav-number">40.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-23"><span class="nav-number">40.2.</span> <span class="nav-text">步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-自制-render-group-description-group"><span class="nav-number">40.2.1.</span> <span class="nav-text">Step 1. 自制 render_group_description(group)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-git-储存-1"><span class="nav-number">40.2.2.</span> <span class="nav-text">Step 2 : git 储存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#本节常见问题-11"><span class="nav-number">40.2.2.1.</span> <span class="nav-text">**本节常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#自制的-Helper-是什么意思？"><span class="nav-number">40.2.2.1.1.</span> <span class="nav-text">自制的 Helper 是什么意思？</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-1-上传到-Github-指南"><span class="nav-number">41.</span> <span class="nav-text">10-1 上传到 Github 指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#目标-30"><span class="nav-number">41.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤：-4"><span class="nav-number">41.2.</span> <span class="nav-text">步骤：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-到-Github-开设-repo"><span class="nav-number">41.2.1.</span> <span class="nav-text">Step 1. 到 Github 开设 repo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-上传-Git-进度到-Github"><span class="nav-number">41.2.2.</span> <span class="nav-text">Step 2. 上传 Git 进度到 Github</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-上传“所有进度”"><span class="nav-number">41.2.3.</span> <span class="nav-text">Step 3. 上传“所有进度”</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-2-上传到-Heroku-指南"><span class="nav-number">42.</span> <span class="nav-text">10-2 上传到 Heroku 指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1：确认本地运行一切正常"><span class="nav-number">42.0.1.</span> <span class="nav-text">Step 1：确认本地运行一切正常</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2：修改sqlite3加入pg这个gem"><span class="nav-number">42.0.2.</span> <span class="nav-text">Step 2：修改sqlite3加入pg这个gem</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step3：在-Heroku-建立新项目"><span class="nav-number">42.0.3.</span> <span class="nav-text">Step3：在 Heroku 建立新项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-4：上传到-heroku"><span class="nav-number">42.0.4.</span> <span class="nav-text">Step 4：上传到 heroku</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-5：跑-heroku-run-rake-db-migrate"><span class="nav-number">42.0.5.</span> <span class="nav-text">Step 5：跑 heroku run rake db:migrate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-6：大功告成！交作业吧"><span class="nav-number">42.0.6.</span> <span class="nav-text">Step 6：大功告成！交作业吧</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">邱桂新</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

  


</body>
</html>
